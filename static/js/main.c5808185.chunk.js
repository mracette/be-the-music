(this["webpackJsonpsoundscape-refactor"]=this["webpackJsonpsoundscape-refactor"]||[]).push([[0],Array(24).concat([function(e,t,n){},,,,,,,,function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/ambient-track.145a3d16.mp3"},function(e,t,n){e.exports=n.p+"static/media/ambient-track.a09963cc.mp3"},function(e,t,n){},,,,,function(e,t,n){e.exports=n.p+"static/media/lily.0b5b2d2b.gltf"},function(e,t,n){e.exports=n.p+"static/media/landscape.5137591c.gltf"},function(e,t,n){e.exports=n.p+"static/media/pine-tree.044015c2.gltf"},function(e,t,n){e.exports=n.p+"static/media/house.67cce723.glb"},function(e,t,n){e.exports=n.p+"static/media/table.fa952078.glb"},function(e,t,n){e.exports=n.p+"static/media/flowers.37c1aabe.glb"},function(e,t,n){e.exports=n.p+"static/media/spiral_plant.413e56fb.glb"},function(e,t,n){e.exports=n.p+"static/media/bookcase.d848d042.glb"},function(e,t,n){e.exports=n.p+"static/media/paintings.33a51d87.glb"},function(e,t,n){e.exports=n.p+"static/media/iconList.3354d128.svg"},,,,,,function(e,t,n){e.exports=n(115)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){var a={"./moonrise/ambient-track.mp3":33,"./moonrise/atmo-crunch[8].mp3":69,"./moonrise/atmo-photay[4].mp3":70,"./moonrise/atmo-swirl[16].mp3":71,"./moonrise/atmo-water[4].mp3":72,"./moonrise/belly-percs[4].mp3":73,"./moonrise/fast-hats[4].mp3":74,"./moonrise/kick-snare[4].mp3":75,"./moonrise/melody-bluesy[8].mp3":76,"./moonrise/melody-soft[8].mp3":77,"./moonrise/melody-trance[4].mp3":78,"./moonrise/rhodes-arps[4].mp3":79,"./moonrise/rhodes-chords[4].mp3":80,"./moonrise/rhodes-sad[8].mp3":81,"./moonrise/rides[4].mp3":82,"./moonrise/sub-bouncey[8].mp3":83,"./moonrise/sub-desc[8].mp3":84,"./moonrise/sub-simple[4].mp3":85,"./moonrise/sub-simple[8].mp3":86,"./mornings/ambient-track.mp3":34,"./mornings/bass-one[8].mp3":87,"./mornings/bass-three[4].mp3":88,"./mornings/bass-two[4].mp3":89,"./mornings/extra-jammy[8].mp3":90,"./mornings/extra-pad[8].mp3":91,"./mornings/extra-sweep[4].mp3":92,"./mornings/harmony-one[4].mp3":93,"./mornings/harmony-three[4].mp3":94,"./mornings/harmony-two[4].mp3":95,"./mornings/melody-one[8].mp3":96,"./mornings/melody-three[4].mp3":97,"./mornings/melody-two[8].mp3":98,"./mornings/rhythm-drums[4].mp3":99,"./mornings/rhythm-kick[8].mp3":100,"./mornings/rhythm-reverse[4].mp3":101,"./mornings/rhythm-tops[8].mp3":102};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=r,e.exports=i,i.id=68},function(e,t,n){e.exports=n.p+"static/media/atmo-crunch[8].3302781f.mp3"},function(e,t,n){e.exports=n.p+"static/media/atmo-photay[4].b5f62d35.mp3"},function(e,t,n){e.exports=n.p+"static/media/atmo-swirl[16].071632ea.mp3"},function(e,t,n){e.exports=n.p+"static/media/atmo-water[4].a3916feb.mp3"},function(e,t,n){e.exports=n.p+"static/media/belly-percs[4].1b33f275.mp3"},function(e,t,n){e.exports=n.p+"static/media/fast-hats[4].d36c7762.mp3"},function(e,t,n){e.exports=n.p+"static/media/kick-snare[4].edf2e08e.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-bluesy[8].517f5198.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-soft[8].9436f5de.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-trance[4].b168cf49.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhodes-arps[4].836e115a.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhodes-chords[4].b93cc73b.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhodes-sad[8].01f304b2.mp3"},function(e,t,n){e.exports=n.p+"static/media/rides[4].3815bc6b.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-bouncey[8].39956256.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-desc[8].89a6665b.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-simple[4].83dfe2b6.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-simple[8].f2c77397.mp3"},function(e,t,n){e.exports=n.p+"static/media/bass-one[8].9c30c4b5.mp3"},function(e,t,n){e.exports=n.p+"static/media/bass-three[4].50569542.mp3"},function(e,t,n){e.exports=n.p+"static/media/bass-two[4].2f424017.mp3"},function(e,t,n){e.exports=n.p+"static/media/extra-jammy[8].cc3705de.mp3"},function(e,t,n){e.exports=n.p+"static/media/extra-pad[8].2ed7e19c.mp3"},function(e,t,n){e.exports=n.p+"static/media/extra-sweep[4].87dcb5ea.mp3"},function(e,t,n){e.exports=n.p+"static/media/harmony-one[4].aecab5c3.mp3"},function(e,t,n){e.exports=n.p+"static/media/harmony-three[4].d644a18d.mp3"},function(e,t,n){e.exports=n.p+"static/media/harmony-two[4].0320af2e.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-one[8].2ed3dabe.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-three[4].f7d05ab9.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-two[8].b5530d7d.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-drums[4].643614ec.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-kick[8].27743ea7.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-reverse[4].4257b53e.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-tops[8].dce46e89.mp3"},function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/impulse-response.5ddb346d.wav"},function(e,t,n){},function(e,t,n){},function(e,t,n){var a={"./moonrise/ambient-track.mp3":33,"./mornings/ambient-track.mp3":34};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=r,e.exports=i,i.id=107},,,,,,function(e){e.exports=JSON.parse('[{"id":"moonrise","audio":{"name":"Moonrise","bpm":120,"timeSignature":4,"keySignature":"G Minor","ambientTrack":true,"ambientTrackLength":"8m","groups":[{"name":"rhythm","polyphony":-1,"analyser":{"power":7,"smoothingTimeConstant":0.3,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"kick-snare[4]","length":"4m","quantizeLength":"4m"},{"name":"fast-hats[4]","length":"4m","quantizeLength":"4m"},{"name":"rides[4]","length":"4m","quantizeLength":"4m"},{"name":"belly-percs[4]","length":"4m","quantizeLength":"4m"}]},{"name":"harmony","polyphony":2,"analyser":{"power":9,"smoothingTimeConstant":0.95,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"rhodes-arps[4]","length":"4m","quantizeLength":"4m"},{"name":"rhodes-chords[4]","length":"4m","quantizeLength":"4m"},{"name":"rhodes-sad[8]","length":"8m","quantizeLength":"4m"}]},{"name":"bass","polyphony":1,"analyser":{"power":5,"smoothingTimeConstant":0.85,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"sub-desc[8]","length":"8m","quantizeLength":"4m"},{"name":"sub-simple[8]","length":"8m","quantizeLength":"8m"},{"name":"sub-bouncey[8]","length":"8m","quantizeLength":"4m"}]},{"name":"melody","polyphony":1,"analyser":{"power":5,"minDecibels":-120,"maxDecibels":0,"smoothingTimeConstant":0},"voices":[{"name":"melody-trance[4]","length":"4m","quantizeLength":"4m"},{"name":"melody-bluesy[8]","length":"8m","quantizeLength":"4m"},{"name":"melody-soft[8]","length":"8m","quantizeLength":"4m"}]},{"name":"atmosphere","polyphony":3,"analyser":{"split":true,"power":5,"smoothingTimeConstant":0.4,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"atmo-water[4]","length":"4m","quantizeLength":"4m"},{"name":"atmo-swirl[16]","length":"16m","quantizeLength":"4m"},{"name":"atmo-crunch[8]","length":"8m","quantizeLength":"4m"},{"name":"atmo-photay[4]","length":"4m","quantizeLength":"4m"}]}]},"themes":{"buttonColor":"rgba(31, 38, 47, 1)","contentPanelColor":"rgba(31, 38, 47, 0.65)","panelResetButton":"rgba(255, 255, 255, 0.3)","panelRandomizeButton":"rgba(255, 255, 255, 0.3)","panelMuteButton":"rgba(255, 255, 255, 0.3)","groupSoloButton":"rgba(90.5, 162.2, 240.8, 0.5)","groupMuteButton":"rgba(777.1, 791, 83.6, 0.5)"},"info":{"credits":[{"type":"Music, Art & Development: ","content":"Mark Racette"},{"type":"Technology: ","content":"React, Three.js, Anime.js, ColorCurves"}]}},{"id":"mornings","audio":{"name":"Mornings","bpm":92,"timeSignature":4,"keySignature":"Eb Major","ambientTrack":true,"ambientTrackLength":"4m","groups":[{"name":"rhythm","polyphony":-1,"analyser":{"power":5,"numBuckets":5,"minFrequency":160,"maxFrequency":13100,"minDecibels":-120,"maxDecibels":-40,"smoothingTimeConstant":0.75},"voices":[{"name":"rhythm-drums[4]","length":"4m","quantizeLength":"4m"},{"name":"rhythm-kick[8]","length":"8m","quantizeLength":"4m"},{"name":"rhythm-reverse[4]","length":"4m","quantizeLength":"4m"},{"name":"rhythm-tops[8]","length":"8m","quantizeLength":"4m"}]},{"name":"harmony","polyphony":2,"analyser":{"power":10,"smoothingTimeConstant":0.95,"minFrequency":115,"maxFrequency":650,"minDecibels":-146,"maxDecibels":-48,"xEasing":"none","yEasing":"polyIn","yExponent":10},"voices":[{"name":"harmony-one[4]","length":"4m","quantizeLength":"4m"},{"name":"harmony-two[4]","length":"4m","quantizeLength":"4m"},{"name":"harmony-three[4]","length":"4m","quantizeLength":"4m"}]},{"name":"bass","polyphony":1,"analyser":{"power":5,"smoothingTimeConstant":0.85},"voices":[{"name":"bass-one[8]","length":"8m","quantizeLength":"4m"},{"name":"bass-two[4]","length":"4m","quantizeLength":"8m"},{"name":"bass-three[4]","length":"4m","quantizeLength":"4m"}]},{"name":"melody","polyphony":1,"analyser":{"power":10,"minFrequency":320,"maxFrequency":1800,"minDecibels":-82,"yEasing":"polyOut","yExponent":2,"numBuckets":32,"smoothingTimeConstant":0.8},"voices":[{"name":"melody-one[8]","length":"8m","quantizeLength":"4m"},{"name":"melody-two[8]","length":"8m","quantizeLength":"4m"},{"name":"melody-three[4]","length":"4m","quantizeLength":"4m"}]},{"name":"extras","polyphony":3,"analyser":{"power":5,"smoothingTimeConstant":0.85},"voices":[{"name":"extra-sweep[4]","length":"4m","quantizeLength":"4m"},{"name":"extra-pad[8]","length":"8m","quantizeLength":"4m"},{"name":"extra-jammy[8]","length":"8m","quantizeLength":"4m"}]}]},"themes":{"buttonColor":"#465648","contentPanelColor":"rgba(55, 55, 55, 0.45)","contentPanelText":"rgba(0, 0, 0, 1)","panelResetButton":"rgba(255, 255, 255, 0.3)","panelRandomizeButton":"rgba(255, 255, 255, 0.3)","panelMuteButton":"rgba(255, 255, 255, 0.3)","groupSoloButton":"rgba(90.5, 162.2, 240.8, 0.5)","groupMuteButton":"rgba(777.1, 791, 83.6, 0.5)"},"info":{"credits":[{"type":"Music, Art & Development: ","content":"Mark Racette"},{"type":"Additional 3D Assets: ","content":"Poly by Google"},{"type":"Technology: ","content":"React, Three.js, Anime.js, ColorCurves"}]}}]')},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(37),s=n.n(r),o=n(8),c=n(119),u=n(11),l=n(26),h=n(2),d=n(21),m=n(18),p=i.a.createContext(),f=i.a.createContext(),g=i.a.createContext(),y=i.a.createContext(),b=i.a.createContext(),v=i.a.createContext(),w=i.a.createContext(),x=n(15),k=n(3),E=n(4),j=n(6),O=n(14),M=n(7),C=n(5),L=n(23),D=n(1),S=n(118),R=function(e,t,n,a){var i=Math.pow(a/t,1/(n-e));return{a:t/Math.pow(i,e),b:i}},P=n(9),q=2*Math.PI,z=function(e,t,n){return Math.max(Math.min(n,e),t)},A=function(e,t,n,a,i){return{x:Math.cos(i)*(e-n)-Math.sin(i)*(t-a)+n,y:Math.sin(i)*(e-n)+Math.cos(i)*(t-a)+a}},B=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=i?e+1:e,c=s?2:3,u=new Float32Array(o*c),l=0;l<o;l++)s?(u[l*c]=n+t*Math.cos(2*l*Math.PI/e),u[l*c+1]=a+t*Math.sin(2*l*Math.PI/e)):(u[l*c]=n+t*Math.cos(2*l*Math.PI/e),u[l*c+1]=r?0:a+t*Math.sin(2*l*Math.PI/e),u[l*c+2]=r?a+t*Math.sin(2*l*Math.PI/e):0);return u},T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(k.a)(this,e),"undefined"===typeof t.baseHeight&&"undefined"===typeof t.canvas||"undefined"===typeof t.baseWidth&&"undefined"===typeof t.canvas)throw new Error("Invalid options. A canvas element must be supplied if baseHeight or baseWidth are not defined.");var n={nxRange:[-1,1],nyRange:[-1,1],padding:0,paddingX:null,paddingY:null,canvas:null,baseHeight:null,baseWidth:null,orientationY:"down"};Object.assign(this,Object(h.a)({},n,{},t)),this.width=this.baseWidth||this.canvas.width,this.height=this.baseHeight||this.canvas.height}return Object(E.a)(e,[{key:"nx",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.clamp&&(e=z(e,this.nxRange[0],this.nxRange[1])),(t="number"===typeof n.padding?n.padding*this.width:(this.paddingX||this.padding)*this.width)+(e-this.nxRange[0])/(this.nxRange[1]-this.nxRange[0])*(this.width-2*t)}},{key:"xn",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e-(t="number"===typeof n.padding?n.padding*this.width:(this.paddingX||this.padding)*this.width))/(this.width-2*t)}},{key:"ny",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.clamp&&(e=z(e,this.nyRange[0],this.nyRange[1])),t="number"===typeof n.paddingY?n.paddingY*this.height:"number"===typeof n.padding?n.padding*this.width:"number"===typeof this.paddingY?this.paddingY*this.height:this.padding*this.width,"down"===this.orientationY?t+(e-this.nyRange[0])/(this.nyRange[1]-this.nyRange[0])*(this.height-2*t):"up"===this.orientationY?this.height-t-(e-this.nyRange[0])/(this.nyRange[1]-this.nyRange[0])*(this.height-2*t):void 0}},{key:"yn",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t="number"===typeof n.paddingY?n.paddingY*this.height:"number"===typeof n.padding?n.padding*this.width:"number"===typeof this.paddingY?this.paddingY*this.height:this.padding*this.width,"down"===this.orientationY?(e-t)/(this.height-2*t):"up"===this.orientationY?(this.height-e-t)/(this.height-2*t):void 0}},{key:"getWidth",value:function(){return this.nx(this.nxRange[1])-this.nx(this.nxRange[0])}},{key:"getHeight",value:function(){return"down"===this.orientationY?this.ny(this.nyRange[1])-this.ny(this.nyRange[0]):"up"===this.orientationY?this.ny(this.nyRange[0])-this.ny(this.nyRange[1]):void 0}}]),e}(),I=n(38),F=n.n(I),N=n(39),W=function(){function e(t){Object(k.a)(this,e),this.object=t,this.target=new D.tb(0,0,0),this.enabled=!0,this.movementSpeed=20,this.lookSpeed=20,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightLock=!1,this.constrainVertical=!0,this.verticalMin=0,this.verticalMax=Math.PI,this.lat=0,this.lon=-90,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.lookUp=!1,this.lookDown=!1,this.lookLeft=!1,this.lookRight=!1,this._onKeyDown=this.bind(this,this.onKeyDown),this._onKeyUp=this.bind(this,this.onKeyUp),window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1)}return Object(E.a)(e,[{key:"onKeyDown",value:function(e){switch(e.keyCode){case 87:this.moveForward=!0;break;case 65:this.moveLeft=!0;break;case 83:this.moveBackward=!0;break;case 68:this.moveRight=!0;break;case 38:this.lookUp=!0;break;case 37:this.lookLeft=!0;break;case 40:this.lookDown=!0;break;case 39:this.lookRight=!0}}},{key:"onKeyUp",value:function(e){switch(e.keyCode){case 87:this.moveForward=!1;break;case 65:this.moveLeft=!1;break;case 83:this.moveBackward=!1;break;case 68:this.moveRight=!1;break;case 38:this.lookUp=!1;break;case 37:this.lookLeft=!1;break;case 40:this.lookDown=!1;break;case 39:this.lookRight=!1}}},{key:"update",value:function(e,t){if(!1!==this.enabled){var n=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-n),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.heightLock&&(this.object.position.y=t||1);var a=e*this.lookSpeed;this.lookUp&&(this.lat+=a),this.lookDown&&(this.lat-=a),this.lookRight&&(this.lon+=a),this.lookLeft&&(this.lon-=a),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=D.H.degToRad(90-this.lat),this.theta=D.H.degToRad(this.lon),this.constrainVertical&&(this.phi=D.H.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var i=this.target,r=this.object.position;i.x=r.x+100*Math.sin(this.phi)*Math.cos(this.theta),i.y=r.y+100*Math.cos(this.phi),i.z=r.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(i),console.log(this.object.position,i)}}},{key:"dispose",value:function(){window.removeEventListener("keydown",this._onKeyDown,!1),window.removeEventListener("keyup",this._onKeyUp,!1)}},{key:"bind",value:function(e,t){return function(){t.apply(e,arguments)}}}]),e}(),V=function(){function e(t){Object(k.a)(this,e),this.canvas=t,this.clock=new D.i(!0),this.screenDimensions={width:window.innerWidth,height:window.innerHeight},this.worldDimensions={width:1e3,height:1e3,depth:1e3},this.currentFrame,this.animate=this.animate.bind(this),this.render=this.render.bind(this),this.onWindowResize=this.onWindowResize.bind(this),this.showStats=!0}return Object(E.a)(e,[{key:"init",value:function(){var e=this;return new Promise((function(t,n){try{e.scene=e.initScene(),e.renderer=e.initRender(),e.camera=e.initCamera("perspective"),e.controls=e.initControls(),e.subjects=e.initSubjects(),e.lights=e.initLights(),e.helpers=e.initHelpers(),t()}catch(a){n(a)}}))}},{key:"stop",value:function(){window.cancelAnimationFrame(this.currentFrame)}},{key:"disposeAll",value:function(e){for(;e.children.length>0;)this.disposeAll(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach((function(t){e.material[t]&&"function"===typeof e.material[t].dispose&&e.material[t].dispose()})),e.material.dispose())}},{key:"animate",value:function(){this.showStats&&this.helpers.stats.begin(),this.render(),this.showStats&&this.helpers.stats.end(),this.currentFrame=requestAnimationFrame(this.animate)}},{key:"initScene",value:function(){return new D.fb}},{key:"initRender",value:function(){var e=new D.wb({alpha:!0,canvas:this.canvas,antialias:!0,powerPreference:"high-performance",outputEncoding:D.xb}),t=window.devicePixelRatio?window.devicePixelRatio:1;return e.setSize(this.screenDimensions.width,this.screenDimensions.height),e.setPixelRatio(t),e}},{key:"initCamera",value:function(e,t){var n,a=this.screenDimensions.width/this.screenDimensions.height;switch(e||"perspective"){case"perspective":n=new D.V(60,1,1,1e4);break;case"orthographic":var i=t||50;n=new D.T(-i,i,i/a,-i/a,1,1e4)}return n.aspect=a,n.position.set(0,10,115),n.lookAt(new D.tb(0,0,0)),n.updateProjectionMatrix(),n}},{key:"initControls",value:function(){var e={};return e.fpc=new W(this.camera),e}},{key:"initSubjects",value:function(){return{}}},{key:"initLights",value:function(){var e={ambient:new D.a(16777215,.1)};this.scene.add(e.ambient),this.lights=e}},{key:"initHelpers",value:function(){var e=null;return this.showStats&&((e=new F.a).showPanel(0),e.dom.style.left=null,e.dom.style.right="0px",document.body.appendChild(e.dom)),{stats:e,gltfLoader:new N.a}}},{key:"onWindowResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.screenDimensions.width=e,this.screenDimensions.height=t;var n=e/t;this.fovAdjust&&(this.camera.fov=this.getNewFov(n)),this.camera.aspect=n,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}}]),e}(),H=function(){function e(t,n,a,i){Object(k.a)(this,e),this.levels=n,this.colorPalette=i.colorPalette,this.width=i.width,this.height=i.height,this.depth=i.depth,this.center=i.center,this.leftGroup=new D.r,this.rightGroup=new D.r,this.group=new D.r;for(var r=0;r<n;r++)this.createStars(i.count,"left",r,a),this.createStars(i.count,"right",r,a);this.group.add(this.leftGroup),this.group.add(this.rightGroup),this.group.position.copy(i.center),t.add(this.group)}return Object(E.a)(e,[{key:"createStars",value:function(e,t,n,a){for(var i,r=new D.f,s=[],o=[],c=0;c<e;c++){var u=("left"===t?this.width/-2*1.35:this.width/2*1.35)*Math.random(),l=n*this.height/this.levels+Math.random()*(this.height/this.levels),h=this.depth*Math.random();s.push(u,l,h),i=new D.j(this.colorPalette(l/this.height));var d=Math.sqrt(u*u+(l-15)*(l-15));i.lerp(a,1/(d/75)),o.push(i.r,i.g,i.b)}r.addAttribute("position",new D.o(s,3)),r.addAttribute("color",new D.o(o,3)),r.setDrawRange(0,e);var m=new D.Z({vertexColors:D.vb,transparent:!0,opacity:0,fog:!1});"left"===t?this.leftGroup.add(new D.Y(r,m)):this.rightGroup.add(new D.Y(r,m))}}]),e}(),G=n(40),_=n.n(G),Q=n(41),Y=n.n(Q),U=n(42),K=n.n(U),X=function(e){function t(e,n,a){var i;return Object(k.a)(this,t),i=Object(j.a)(this,Object(C.a)(t).call(this,e)),console.log(n),i.rhythmAnalyser=n.find((function(e){return"rhythm-analyser"===e.id})),i.atmosphereAnalyser=n.find((function(e){return"atmosphere-analyser"===e.id})),i.harmonyAnalyser=n.find((function(e){return"harmony-analyser"===e.id})),i.melodyAnalyser=n.find((function(e){return"melody-analyser"===e.id})),i.bassAnalyser=n.find((function(e){return"bass-analyser"===e.id})),i.palette={white:16777215,rockGrey:10327950,lightning:15656619,moonYellow:16184021,tropicalGreen:7382161,deepInk:199714},i.prevMelodyVolume=0,i.currentMelodyVolume=0,i.lilyColors=[i.palette.dustyViolet,i.palette.pansyPurple,i.palette.funGreen,i.palette.hibiscus,i.palette.yellow],Object(L.a)(Object(C.a)(t.prototype),"init",Object(O.a)(i)).call(Object(O.a)(i)).then((function(){window.addEventListener("resize",(function(){i.onWindowResize(window.innerWidth,window.innerHeight)})),i.scene.fog=new D.p(16777215,10,470),i.scene.background=new D.j("#1F262F").lerp(new D.j(0),.2),Promise.all([i.initLakeTrees(),i.initLakeScene(),i.initLakeRipples(),i.initLakeStars(),i.initLakeLilies(),i.initLakeMoon()]).then((function(){Object(L.a)(Object(C.a)(t.prototype),"animate",Object(O.a)(i)).call(Object(O.a)(i))}))})),i}return Object(M.a)(t,e),Object(E.a)(t,[{key:"initLakeScene",value:function(){var e=this;return new Promise((function(t,n){try{for(var a=B(6,110,0,0,!0,!1,!0),i=[],r=0;r<a.length;r+=2)i.push(new D.sb(a[r],a[r+1]));var s=new D.ib(i),o=new D.jb(s);o.rotateX(-Math.PI/2),o.translate(0,0,70);var c=new D.K({color:e.palette.deepInk,fog:!1}),u=new D.J(o,c);e.subjects.lake=u,e.scene.add(u);var l=new D.W(550,350);l.rotateX(-Math.PI/2),l.translate(0,-1,0);var h=new D.K({color:141854,fog:!1});h.color.lerp(new D.j(0),.75);var d=new D.J(l,h);e.subjects.ground=d,e.scene.add(d);var m=new D.J(new D.W(60,30),h);m.translateZ(-79),e.scene.add(m);var p=new D.l(16777215,.18);p.position.set(0,10,0),e.scene.add(p);for(var f=new D.r,g=0;g<16;g++){var y=new D.r;y.add(new D.X(e.palette.moonYellow,.1));var b=new D.mb(.25),v=new D.K({color:e.palette.lightning,fog:!1,transparent:!0});y.add(new D.J(b,v)),y.position.set(140*Math.random()-70,5+15*Math.random(),40-70*Math.random()),y.userData.cycle=0,y.userData.state="off",f.add(y)}e.subjects.fireflies=f,e.scene.add(f),e.helpers.gltfLoader.load(Y.a,(function(t){e.subjects.rocks=t.scene.children.find((function(e){return e.name="rockGroup"})),e.subjects.rocks.children.forEach((function(e){e.material.color.setRGB(.06,.06,.06)})),e.scene.add(e.subjects.rocks)}),void 0,(function(e){e&&n(e)})),t()}catch(w){n(w)}}))}},{key:"initLakeMoon",value:function(){var e=this;return new Promise((function(t,n){try{var a=e.bassAnalyser.fftSize,i=new D.g(25,a,a),r=new D.K({color:e.palette.moonYellow,fog:!1}),s=new D.J(i,r);s.userData.radius=25,s.position.set(0,35,-80),e.subjects.moon=s,e.scene.add(s);for(var o=new D.r,c=new D.r,u=0;u<5;u++){var l=new D.f,h=new Float32Array(3*a);l.addAttribute("position",new D.e(h,3)),l.setDrawRange(0,0);var d=new D.Z({color:e.palette.moonYellow,transparent:!0,opacity:.1+u/7}),m=new D.Y(l,d);o.add(m)}for(var p=0;p<8;p++){var f=o.clone();f.translateY(s.position.y),f.rotateZ(2*Math.PI*(p/16)),c.add(f)}e.subjects.moonBeams=c,e.subjects.moonBeams.userData.numMoonRings=5,e.subjects.moonBeams.userData.numVertices=a,e.scene.add(c),t()}catch(g){n(g)}}))}},{key:"initLakeTrees",value:function(){var e=this;return new Promise((function(t,n){e.helpers.gltfLoader.load(K.a,(function(n){for(var a=n.scenes[0].children[0],i=new D.r,r=1;r<=64;r++){var s=r/64*200-100+(5*Math.random()-2.5),o=void 0;s<-55?o=-1*(95/55*s+190)-10*Math.random():s>=-55&&s<55?o=-95-10*Math.random():s>=55&&(o=-1*(-95/55*s+190)-10*Math.random());var c=a.clone(),u=1-.3*Math.random();c.children[0].material=new D.K({color:new D.j(e.palette.tropicalGreen).lerp(new D.j(e.palette.white),-1.5)}),c.position.copy(new D.tb(s,-2,o+70)),c.scale.copy(new D.tb(u,u,u)),c.rotateY(2*Math.random()*Math.PI),i.add(c)}e.subjects.pineTrees=i,e.scene.add(i),t()}),void 0,(function(e){n(e)}))}))}},{key:"initLakeRipples",value:function(){var e=this;return new Promise((function(t,n){try{var a=e.rhythmAnalyser.frequencyBinCount,i=B(6,1,0,0,!0,!0),r=function(e){var t=Math.log(1/e)/(1-e);return{a:e/Math.exp(t*e),b:t}}(100),s=new D.r,o=new D.f;o.addAttribute("position",new D.e(i,3));for(var c=0;c<a;c++){var u=o.clone(),l=1+c/a*100,h=Math.log(l/r.a)/r.b;u.scale(h,h,h),u.translate(0,.05,50),s.add(new D.x(u,new D.y({color:e.palette.moonYellow,transparent:!0,opacity:0})))}e.subjects.ripples=s,e.scene.add(s),t()}catch(d){n(d)}}))}},{key:"initLakeStars",value:function(){var e=this;return new Promise((function(t,n){try{e.subjects.stars=new H(e.scene,8,e.scene.background,{count:150,width:600,height:225,depth:190,center:new D.tb(0,-13,-300),colorPalette:S.a}),t()}catch(a){n(a)}}))}},{key:"initLakeLilies",value:function(){var e=this;return new Promise((function(t,n){e.helpers.gltfLoader.load(_.a,(function(n){var a=n.scene.children[1],i=a.children[0].clone(),r=a.children[1].clone(),s=a.children[2].clone();s.name="sphere";var o=a.children[3].clone();o.name="lilyPad";var u=new D.r,l=new D.r;l.name="petalGroup";for(var h=0;h<18;h++){var d=(new D.r).add(r.clone());d.rotateY(2*Math.PI*(h/8));var m=(new D.r).add(i.clone());m.rotateY(2*Math.PI*(h/8)),l.add(d),l.add(m)}u.add(l,s,o);for(var p=new D.r,f=new D.K({color:new D.j(16777215)}),g=new D.K({color:new D.j(141854).lerp(new D.j(0),1)}),y=function(e){var t=u.clone(),n=new D.j(c.a(Math.random())),a=new D.K({color:n});t.getObjectByName("petalGroup").children.forEach((function(e){e.children[0].material=a})),t.getObjectByName("lilyPad").material=g,t.getObjectByName("sphere").material=f;var i=e%4+1,r=Math.floor(e/4)%4,s=Math.max(2*Math.random(),1.4),o=i/1.3*(7*r-10.5);o*=.2*Math.random()-.2+1;var l=102-e%4/3*18-Math.random()*(10-15*Math.floor(r/2));t.userData.petalColor=n,t.userData.ignited=!1,t.userData.phase="waxing",t.userData.measure=0,t.scale.copy(new D.tb(s,s,s)),t.position.copy(new D.tb(o,1,l)),p.add(t)},b=1;b<=23;b++)y(b);e.subjects.lilies=p,e.scene.add(p),t()}),void 0,(function(e){n(e)}))}))}},{key:"render",value:function(){var e=this;this.rhythmAnalyser.getFrequencyData().forEach((function(t,n){var a=n/e.rhythmAnalyser.frequencyBinCount*180;e.subjects.ripples.children[n].material.opacity=(t-a)/500}));var t=this.atmosphereAnalyser.getFrequencyData("left"),n=this.atmosphereAnalyser.getFrequencyData("right");t.slice(1,9).forEach((function(t,n){e.subjects.stars.leftGroup.children[n].material.opacity=t/125})),n.slice(1,9).forEach((function(t,n){e.subjects.stars.rightGroup.children[n].material.opacity=t/125}));var a=this.harmonyAnalyser.getFrequencyData();this.subjects.pineTrees.children.forEach((function(t,n){var i=Math.floor(n/8),r=a.slice([1+i])[0],s=Math.pow(r,5)/(.06*Math.pow(255,5)),o=new D.j(e.palette.tropicalGreen);o.lerp(new D.j(e.palette.white),-1.5+s),t.children[0].material.color.set(o)}));var i=this.bassAnalyser.getFrequencyData().reduce((function(e,t){return e+t}))/this.bassAnalyser.frequencyBinCount;if(i>0){for(var r=this.bassAnalyser.getFrequencyData().slice(0,this.subjects.moonBeams.userData.numMoonRings),s=.5*this.subjects.moon.userData.radius,o=0;o<this.subjects.moonBeams.userData.numMoonRings;o++)for(var c=0;c<this.subjects.moonBeams.userData.numVertices;c++){var u=1/(.15*(o+1)),l=r[o]/255,h=this.subjects.moonBeams.children[0].children[o];h.geometry.attributes.position.array[3*c]=(s-7+i/3*u)*Math.cos(2*Math.PI*(c/this.bassAnalyser.fftSize+l/12)),h.geometry.attributes.position.array[3*c+1]=(s-7+i/3*u)*Math.sin(2*Math.PI*(c/this.bassAnalyser.fftSize+l/6)),h.geometry.attributes.position.array[3*c+2]=-81}this.subjects.moonBeams.children.forEach((function(t){t.children.forEach((function(t,n){t.geometry.attributes.position.array=e.subjects.moonBeams.children[0].children[n].geometry.attributes.position.array,t.geometry.setDrawRange(0,t.geometry.attributes.position.count),t.geometry.attributes.position.needsUpdate=!0}))}))}for(var d=this.melodyAnalyser.getFrequencyData(),m=0,p=0,f=0;f<d.length;f++)m+=d[f],p++;var g=m/p;this.subjects.lilies.children.forEach((function(e){var t=e.userData;!t.ignited&&0!==g&g*Math.random()>55&&(t.ignited=!0),t.ignited&&"waxing"===t.phase&&t.measure<1?t.measure=Math.min(2,t.measure+7.7):t.ignited&&"waxing"===t.phase&&t.measure>1?(t.phase="waning",t.measure+=-.11):t.ignited&&"waning"===t.phase&&t.measure<0?(t.ignited=!1,t.phase="waxing"):t.ignited&&"waning"===t.phase&&(t.measure+=-.11),e.getObjectByName("petalGroup").children[0].children[0].material.color=e.userData.petalColor.clone().lerp(new D.j(16777215),Math.max(0,g/105*t.measure))})),this.prevMelodyVolume=g;this.subjects.fireflies.children.forEach((function(e){if("off"===e.userData.state&&Math.random()<5e-4&&(e.userData.state="lighting",e.userData.flightPath=new D.tb(-.5+Math.random(),-.5+Math.random(),-.5+Math.random())),"lighting"===e.userData.state&&(e.userData.cycle+=.1,e.userData.cycle>=1&&(e.userData.state="dimming")),"dimming"===e.userData.state&&(e.userData.cycle-=.025,e.userData.cycle<=0&&(e.userData.state="off")),"dimming"===e.userData.state||"lighting"===e.userData.state){var t=Math.min(Math.max(e.position.x+.3*(e.userData.flightPath.x+.005),-70),140),n=Math.min(Math.max(e.position.y+.3*(e.userData.flightPath.x+.005),5),20),a=Math.min(Math.max(e.position.z+.3*(e.userData.flightPath.x+.005),-20),70);e.position.set(t,n,a)}e.children[0].intensity=e.userData.cycle/2,e.children[1].material.opacity=e.userData.cycle})),this.renderer.render(this.scene,this.camera)}}]),t}(V),J=n(43),Z=n.n(J),$=n(44),ee=n.n($),te=n(45),ne=n.n(te),ae=n(46),ie=n.n(ae),re=n(47),se=n.n(re),oe=n(48),ce=n.n(oe),ue=n(116),le=n(20),he=Object(le.a)(2,.2,.3),de=new D.j(3355443),me=Object(le.a)(4,.4,1),pe=function(e){function t(e,n,a){var i;return Object(k.a)(this,t),(i=Object(j.a)(this,Object(C.a)(t).call(this,e))).colors={plant:new D.j(8101459),white:new D.j(16777215)},i.staticObjects=[],i.renderList=["house","plant","table","bookshelf","flower"],i.spectrumFunction=a.spectrumFunction,i.bpm=a.bpm,i.rhythmAnalyser=n.find((function(e){return"rhythm-analyser"===e.id})),i.atmosphereAnalyser=n.find((function(e){return"atmosphere-analyser"===e.id})),i.harmonyAnalyser=n.find((function(e){return"harmony-analyser"===e.id})),i.melodyAnalyser=n.find((function(e){return"melody-analyser"===e.id})),i.bassAnalyser=n.find((function(e){return"bass-analyser"===e.id})),i.fovAdjust=!0,i.fpcControl=!1,Promise.all([Object(L.a)(Object(C.a)(t.prototype),"init",Object(O.a)(i)).call(Object(O.a)(i)),i.loadModels(i.renderList)]).then((function(){i.applySceneSettings(),i.render(i.renderList),i.staticObjects.forEach((function(e){return e.matrixAutoUpdate=!1})),Object(L.a)(Object(C.a)(t.prototype),"animate",Object(O.a)(i)).call(Object(O.a)(i))})).catch((function(e){console.log(e)})),i}return Object(M.a)(t,e),Object(E.a)(t,[{key:"applySceneSettings",value:function(){this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=D.U,this.camera.position.set(-36.792147432025736,12.295984744079584,19.50565058881036),this.camera.lookAt(46.69487932551039,2.382592629313793,-34.638979984916375),this.camera.fov=this.getNewFov(window.innerWidth/window.innerHeight),this.camera.updateProjectionMatrix()}},{key:"getNewFov",value:function(e){return 50-25*(Math.max(.5,Math.min(e,3))-.5)/2.5}},{key:"initControls",value:function(){var e={};return this.fpcControl&&(e.fpc=new W(this.camera)),e}},{key:"initScene",value:function(){var e=new D.fb;return e.background=new D.j(13421772),e}},{key:"initLights",value:function(){var e=10/180*Math.PI,t=-1*Math.sin(e),n={ambient:new D.a(16777215,.35),sunlight:new D.l(16777215,0),pointOne:new D.X(16777215,.1)},a=-100*t;return n.sunlight.position.copy(new D.tb(20,a,-100)),n.sunlight.target.position.copy(new D.tb(20,0,0)),n.sunlight.castShadow=!0,n.sunlight.shadowBias=1e-4,n.sunlight.shadowMapHeight=512,n.sunlight.shadowMapWidth=512,n.sunlight.shadow.camera.top=20,n.sunlight.shadow.camera.bottom=-20,n.sunlight.shadow.camera.left=-20,n.sunlight.shadow.camera.right=20,n.pointOne.position.set(-36.792147432025736,12.295984744079584,19.50565058881036),n.pointOne.castShadow=!0,n.pointOne.shadowBias=1e-4,n.pointOne.shadowMapHeight=512,n.pointOne.shadowMapWidth=512,this.scene.add(n.ambient),this.scene.add(n.sunlight),this.scene.add(n.sunlight.target),this.scene.add(n.pointOne),n}},{key:"loadModels",value:function(e){var t=this;return new Promise((function(n,a){var i=[];-1!==e.indexOf("house")&&i.push(new Promise((function(e,n){t.subjects.godrays={},t.subjects.godrays.materials=[],t.subjects.godrays.meshes=[],t.subjects.godrays.materials.push(new D.K({color:t.colors.white,opacity:.05,transparent:!0,side:D.m})),t.helpers.gltfLoader.load(Z.a,(function(n){n.scene.children.forEach((function(e){t.staticObjects.push(e),"god_rays_top"!==e.name&&"god_rays_bottom"!==e.name||(e.material=t.subjects.godrays.materials[0],t.subjects.godrays.meshes.push(e)),"house_window_structure"!==e.name&&"house_walls"!==e.name||(e.castShadow=!0),"house_floor"!==e.name&&"carpet"!==e.name||(e.receiveShadow=!0)})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("house")&&i.push(new Promise((function(e,n){t.helpers.gltfLoader.load(ce.a,(function(n){console.log(n),n.scene.children.forEach((function(e){t.staticObjects.push(e),"vonnegut_self_portrait"===e.name&&(e.material.side=D.q),"van_gogh"===e.name&&(e.material.side=D.c)})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("table")&&i.push(new Promise((function(e,n){t.helpers.gltfLoader.load(ee.a,(function(n){var a=new D.W(1.9,1.8,64,64);a.rotateX(-Math.PI/2),console.log(a.attributes.position),n.scene.children.forEach((function(e){if("left_page_ref"===e.name||"right_page_ref"===e.name){var n=new Array(4*a.attributes.position.count),i=e.clone();i.geometry=a.clone(),i.geometry.addAttribute("customColor",new D.o(n,4)),i.material=new D.hb({transparent:!0,side:D.m,vertexShader:"\n    attribute vec4 customColor;\n    varying vec4 vColor;\n    void main() {\n        vColor = customColor;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n    }\n",fragmentShader:"\n    varying vec4 vColor;\n    void main() {\n        gl_FragColor = vColor;\n    }\n",vertexColors:D.vb}),t.scene.add(i),"right_page_ref"===e.name&&(t.subjects.rightPage=i),"left_page_ref"===e.name&&(t.subjects.leftPage=i)}"steam"===e.name?(e.material=new D.K({color:t.colors.white,transparent:!0,side:D.m,opacity:.025}),t.subjects.steam=e):t.staticObjects.push(e),e.castShadow=!0,"table"===e.name&&(e.receiveShadow=!0)})),n.scene.children.filter((function(e){return e.name.includes("page")})).forEach((function(e){return n.scene.remove(e)})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("flower")&&i.push(new Promise((function(e,n){var a=[],i=[];t.helpers.gltfLoader.load(ne.a,(function(n){n.scene.children.forEach((function(e){t.staticObjects.push(e),e.name.includes("stick_leaves_one")?(e.material=new D.L({color:t.colors.plant,emissive:t.colors.plant,emissiveIntensity:0}),i.push(e)):e.name.includes("stick_leaves")&&(e.material=new D.L({color:t.colors.plant,emissive:t.colors.plant,emissiveIntensity:0}),a.push(e))})),t.subjects.stickLeaves=a,t.subjects.stickLeavesOne=i,t.scene.add(n.scene),e()}),null,(function(){return n()}))}))),-1!==e.indexOf("plant")&&i.push(new Promise((function(e,n){t.helpers.gltfLoader.load(ie.a,(function(n){var a=[];n.scene.children.filter((function(e){return e.name.includes("spiral_plant_leaf")})).forEach((function(e){e.material=new D.L({color:t.colors.plant,emissive:t.colors.plant,emissiveIntensity:0}),a.push(e)})),t.subjects.spiralPlantLeaves=a,t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("bookshelf")&&i.push(new Promise((function(e,n){t.subjects.books=new Array(4).fill(null).map((function(e){return new Array(5).fill(null).map((function(e){return[]}))})),t.helpers.gltfLoader.load(se.a,(function(n){var a=new D.L({color:15194826,side:D.m});n.scene.children.forEach((function(e){if(t.staticObjects.push(e),e.name.includes("book")&&!e.name.includes("bookcase")&&"Group"===e.type){var n=e.name,i=parseInt(n.slice(n.length-1,n.length)),r=parseInt(n.slice(n.length-2,n.length-1)),s=parseInt(n.slice(n.length-3,n.length-2)),o=.2*Math.random()-.1,c=new D.j(t.spectrumFunction(1-(o+r+.5)/5)),u=e.children.find((function(e){return e.material.name.includes("book")}));e.children.find((function(e){return e.material.name.includes("page")})).material=a,u.material=new D.L({color:c,side:D.m,emissive:c,emissiveIntensity:.1}),t.subjects.books[s][r][i]=u}})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),Promise.all(i).then((function(){n()})).catch((function(e){a("Error loading models: ".concat(e))}))}))}},{key:"render",value:function(){this.elapsedBeats=this.bpm*this.clock.getElapsedTime()/60,this.fpcControl&&this.controls.fpc.update(this.clock.getDelta()),this.subjects.steam.rotateY(-.05),-1!==this.renderList.indexOf("table")&&function(e,t,n){for(var a=t.getFrequencyData(),i=e.leftPage.geometry.attributes.customColor,r=e.rightPage.geometry.attributes.customColor,s=0,o=i.count;s<o;s++){var c=s%65,u=Math.floor(s/65),l=me(n.beats-u/65*(c/65)*4),h=de.clone().lerp(new D.j(n.spectrumFunction(1-c/65)),a[Math.ceil(c)]/255);c%4===0?(i.array[4*s]=h.r,i.array[4*s+1]=h.g,i.array[4*s+2]=h.b,i.array[4*s+3]=1*l):(i.array[4*s]=h.r,i.array[4*s+1]=h.g,i.array[4*s+2]=h.b,i.array[4*s+3]=0),c%4===0?(r.array[4*s]=h.r,r.array[4*s+1]=h.g,r.array[4*s+2]=h.b,r.array[4*s+3]=1*l):(r.array[4*s]=h.r,r.array[4*s+1]=h.g,r.array[4*s+2]=h.b,r.array[4*s+3]=0)}i.needsUpdate=!0,r.needsUpdate=!0}({leftPage:this.subjects.leftPage,rightPage:this.subjects.rightPage},this.melodyAnalyser,{spectrumFunction:this.spectrumFunction,beats:this.elapsedBeats}),-1!==this.renderList.indexOf("house")&&function(e,t,n){for(var a=0,i=t.getFrequencyData(),r=0,s=t.frequencyBinCount;r<s;r++)a+=i[r];var o=ue.a(3e-4*a);e.materials[0].opacity=.025+o*(.2-.025),n.sunlight.intensity=.25+.75*o}(this.subjects.godrays,this.bassAnalyser,{sunlight:this.lights.sunlight}),-1!==this.renderList.indexOf("bookshelf")&&function(e,t,n){for(var a=t.getFrequencyBuckets(),i=0;i<e.length;i++)for(var r=e[i],s=0;s<r.length;s++)for(var o=r[s],c=0;c<o.length;c++){var u=(i+c)%4/4,l=he(n.beats+2*u/4);o[c].material.emissiveIntensity=l*a[s]/255}}(this.subjects.books,this.rhythmAnalyser,{spectrumFunction:this.spectrumFunction,beats:this.elapsedBeats}),-1!==this.renderList.indexOf("plant")&&function(e,t,n){for(var a=t.getFrequencyData(),i=0;i<e.leaves.length;i++){var r=t.binMin+Math.round(i/e.leaves.length*(t.binMax-t.binMin));e.leaves[i].material.emissiveIntensity=a[r]/255}for(var s=0;s<e.stickLeaves.length;s++){var o=t.binMin+Math.round(s/e.stickLeaves.length*(t.binMax-t.binMin));e.stickLeaves[s].material.emissiveIntensity=a[o]/255}for(var c=0;c<e.stickLeavesOne.length;c++){var u=t.binMin+Math.round(c/e.stickLeavesOne.length*(t.binMax-t.binMin));e.stickLeavesOne[c].material.emissiveIntensity=a[u]/255}}({leaves:this.subjects.spiralPlantLeaves,stickLeaves:this.subjects.stickLeaves,stickLeavesOne:this.subjects.stickLeavesOne,group:this.subjects.spiralPlantGroup,box:this.subjects.spiralPlantBox},this.harmonyAnalyser,this.elapsedBeats),this.renderer.render(this.scene,this.camera)}}]),t}(V),fe=function(e){var t=i.a.useRef(null);return i.a.useEffect((function(){var n="undefined"!==typeof document?window.devicePixelRatio:1,a=function(){0!==t.current.clientWidth&&(t.current.width=n*t.current.clientWidth),e.makeSquare?0!==t.current.clientHeight&&(t.current.height=n*t.current.clientWidth):0!==t.current.clientHeight&&(t.current.height=n*t.current.clientHeight),!1!==e.resize&&void 0!==e.onResize&&e.onResize(t.current)};return a(),!1!==e.resize&&window.addEventListener("resize",a),void 0!==e.onLoad&&e.onLoad(t.current),function(){return!1!==e.resize&&window.removeEventListener("resize",a)}}),[e]),i.a.createElement("canvas",{id:e.id,className:e.className,ref:t})},ge=(n(60),function(){var e=i.a.useContext(b).spectrumFunction,t=i.a.useContext(v),n=t.id,a=t.groups,r=t.bpm,s=i.a.useContext(g).analysers,o=i.a.useContext(y).flags.showVisuals,c=i.a.useRef(null),u=i.a.useRef(null);return i.a.useEffect((function(){if(a.length===s.length){var t;switch(n){case"moonrise":o&&(t=new X(c.current,s),u.current=t);break;case"mornings":o&&(t=new pe(c.current,s,{spectrumFunction:e,bpm:r}),u.current=t);break;default:throw new Error("Song not found")}return o&&(window.addEventListener("resize",u.current.onWindowResize),window.addEventListener("orientationchange",u.current.onWindowResize),window.addEventListener("fullscreenchange",u.current.onWindowResize)),function(){t.stop(),t.disposeAll(t.scene)}}}),[r,a,e,o,n,s]),i.a.createElement(fe,{id:"canvas-viz",className:"fullscreen",onLoad:function(e){return c.current=e}})}),ye=(n(61),function(e){var t=i.a.useRef(),n=i.a.useRef(),a=i.a.useRef(),r=i.a.useContext(g),s=r.dispatch,o=r.randomizeEffects,c=i.a.useCallback((function(){t.current.value=1,s({type:"setHighpass",payload:{value:1}}),n.current.value=100,s({type:"setLowpass",payload:{value:100}}),a.current.value=1,s({type:"setAmbience",payload:{value:1}})}),[s]);return i.a.useEffect((function(){return c()}),[c]),i.a.createElement("div",{id:"effects-panel",className:"flex-panel"},i.a.createElement("h2",null,"Effects"),i.a.createElement("div",{className:"flex-row"},i.a.createElement("button",{className:"button-white grouped-buttons",id:"effects-panel-reset",onClick:function(){return c()}},"Reset"),i.a.createElement("button",{className:"button-white grouped-buttons",id:"effects-panel-randomize",onClick:function(){var e=1+99*Math.random(),i=1+99*Math.random(),r=1+99*Math.random();s({type:"setHighpass",payload:{value:e}}),s({type:"setLowpass",payload:{value:i}}),s({type:"setAmbience",payload:{value:r}}),t.current.value=e,n.current.value=i,a.current.value=r}},"Randomize")),i.a.createElement("div",{className:"flex-row effect-panel-row"},i.a.createElement("h3",{className:"slider-label"},"highpass filter")),i.a.createElement("div",{className:"flex-row effect-panel-row"},i.a.createElement("input",{type:"range",min:"1",max:"100",disabled:o,className:"slider",id:"hp-slider",ref:t,onInput:function(e){s({type:"setHighpass",payload:{value:e.target.value}})}})),i.a.createElement("div",{className:"flex-row effect-panel-row"},i.a.createElement("h3",{className:"slider-label"},"lowpass filter")),i.a.createElement("div",{className:"flex-row effect-panel-row"},i.a.createElement("input",{type:"range",min:"1",max:"100",disabled:o,className:"slider",id:"lp-slider",ref:n,onInput:function(e){s({type:"setLowpass",payload:{value:e.target.value}})}})),i.a.createElement("div",{className:"flex-row effect-panel-row"},i.a.createElement("h3",{className:"slider-label"},"ambience")),i.a.createElement("div",{className:"flex-row effect-panel-row"},i.a.createElement("input",{type:"range",min:"1",max:"100",disabled:o,className:"slider",id:"spaciousness-slider",ref:a,onChange:function(e){s({type:"setAmbience",payload:{value:e.target.value}})}})))}),be=function(e){var t=i.a.useRef(),n=i.a.useRef();i.a.useEffect((function(){return t.current=window.requestAnimationFrame((function a(i){if(void 0!==n.current){var r=i-n.current;e({delta:r,time:i})}n.current=i,t.current=window.requestAnimationFrame(a)})),function(){return window.cancelAnimationFrame(t.current)}}),[e])},ve=(n(62),function(e){var t=i.a.useContext(b).spectrumFunction,n=i.a.useContext(v),a=60/n.bpm*n.timeSignature,r=i.a.useRef(null),s=i.a.useRef(null),o=i.a.useCallback((function(n,i,r){var s=n.height/2-n.height/e.premasterAnalyser.frequencyBinCount,o=r/1e3/(4*a);i.clearRect(0,0,n.height,n.height),e.premasterAnalyser.getFrequencyData().forEach((function(a,r){var c=a/255,u=n.width/2+s*Math.cos(r/e.premasterAnalyser.frequencyBinCount*2*Math.PI+o*Math.PI*2),l=n.height/2+s*Math.sin(r/e.premasterAnalyser.frequencyBinCount*2*Math.PI+o*Math.PI*2);i.beginPath(),i.fillStyle=t(r/e.premasterAnalyser.frequencyBinCount),i.globalAlphs=c,i.moveTo(u,l),i.arc(u,l,n.height/e.premasterAnalyser.frequencyBinCount*c,0,2*Math.PI),i.fill()}))}),[e,t,a]);return be((function(e){return o(r.current,s.current,e.time)})),i.a.useMemo((function(){return i.a.createElement("div",{id:"freq-bands"},i.a.createElement(fe,{id:"freq-bands-canvas",onLoad:function(e){r.current=e,s.current=e.getContext("2d")}}))}),[])}),we=(n(63),function(e){var t=Object(a.useContext)(f),n=t.vw,r=t.vh,s=Object(a.useContext)(b).contentPanelColor;return i.a.createElement("div",{className:"menu-button-content",style:{background:s,display:!e.parentIsOpen&&"none",marginTop:e.marginTop,minWidth:e.minWidth,maxHeight:82*r,maxWidth:95*n,padding:4*r}},e.content)}),xe=n(49),ke=n.n(xe),Ee=(n(32),function(e){var t=i.a.useRef(null);return e.handleAddIconRef&&e.handleAddIconRef(t),i.a.createElement("div",{id:"scale-div",className:e.divClassList?"icon ".concat(e.divClassList):"icon"},i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:e.svgClassList?"icon ".concat(e.svgClassList):"icon",style:e.style,id:e.name},i.a.createElement("use",{ref:t,xlinkHref:"".concat(ke.a,"#").concat(e.name)})))}),je=(n(64),function(e){var t=e.autoOpen,n=e.setOpenChildIndex,a=e.index,r=i.a.useContext(b),s=r.buttonColor,c=r.contentPanelColor,u=i.a.useState(!1),l=Object(o.a)(u,2),h=l[0],d=l[1];i.a.useEffect((function(){e.openChildIndex!==e.index&&d(!1)}),[e.openChildIndex,e.index]),i.a.useEffect((function(){t&&(n(a),d(!0))}),[t,n,a]);var m=(e.parentWidth+e.width)/2+e.separation+2*e.separation*(e.index-1),p="menu-button-child";return e.parentIsOpen&&(p+=" ".concat("menu-button-child","-expand")),h&&(p+=" ".concat("menu-button-child","-open")),i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{className:p,onClick:function(t){t.preventDefault(),h?e.setOpenChildIndex(-1):e.setOpenChildIndex(e.index),d(!h)},style:{background:s,width:e.width,height:e.height,top:(e.parentHeight-e.height)/2,left:(e.parentWidth-e.width)/2,marginLeft:"right"===e.direction&&e.parentIsOpen?m:0,marginRight:"left"===e.direction&&e.parentIsOpen?m:0,marginTop:"down"===e.direction&&e.parentIsOpen?m:0,marginBottom:"down"===e.direction&&e.parentIsOpen?m:0,zIndex:e.zIndex}},e.name,i.a.createElement(Ee,{divClassList:"icon-white",svgClassList:"icon-white",name:e.iconName})),i.a.createElement("div",{className:"arrow",style:{borderBottomColor:c,display:!h&&"none",top:e.height+(e.parentHeight-e.height)/2,left:(e.parentWidth-e.width)/2-e.parentHeight/8,marginLeft:"right"===e.direction&&e.parentIsOpen?m:0,marginRight:"left"===e.direction&&e.parentIsOpen?m:0,marginTop:"down"===e.direction&&e.parentIsOpen?m:0,marginBottom:"down"===e.direction&&e.parentIsOpen?m:0,borderRightWidth:e.parentHeight/4+(e.parentHeight-e.height)/2,borderBottomWidth:e.parentHeight/4+(e.parentHeight-e.height)/2,borderLeftWidth:e.parentHeight/4+(e.parentHeight-e.height)/2}}),i.a.createElement(we,{content:e.content,config:e.config,parentIsOpen:h,minWidth:e.menuWidth+e.width,marginTop:e.parentHeight/4}))}),Oe=(n(65),function(e){var t=Object(a.useContext)(f).vh,n=Object(a.useContext)(b).buttonColor,r=7*t,s=r,c=2.5*t,u=c,l=.6*r,h=l,d=h,m=Object(a.useRef)(),p=Object(a.useState)(!0),g=Object(o.a)(p,2),y=g[0],v=g[1],w=Object(a.useState)(-1),x=Object(o.a)(w,2),k=x[0],E=x[1],j=e.childButtonProps.length;return Object(a.useEffect)((function(){var e=function(e){if(!m.current.contains(e.target)){if(-1!==k)return void E(-1);if(y)return void v(!1)}};return y?document.addEventListener("mousedown",e):document.removeEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[y,k]),i.a.createElement("div",{className:"menu-button",style:{top:c,left:u},ref:m},i.a.createElement("button",{className:y?"menu-button-parent menu-button-parent-open":"menu-button-parent",style:{zIndex:j+1,width:s,height:r,background:n},onClick:function(t){t.preventDefault(),y&&E(-1),e.clickToOpen&&v(!y)}},i.a.createElement(Ee,{divClassList:y?"icon-white rotate45":"icon-white",svgClassList:"icon-white",name:"icon-plus"})),e.childButtonProps.map((function(t,n){return i.a.createElement(je,{id:t.id,key:t.id,content:e.childButtonProps[n].content,iconName:t.iconName,autoOpen:t.autoOpen,icon:t.icon,direction:e.direction,index:n+1,openChildIndex:k,setOpenChildIndex:E,zIndex:j-n,separation:d,width:h,height:l,parentWidth:s,parentHeight:r,menuWidth:s+(h+d)*(j-1),parentIsOpen:y})})))}),Me=(n(66),function(e){var t=i.a.useContext(v),n=t.name,a=t.bpm,r=t.keySignature,s=t.timeSignature,o=i.a.useContext(w).credits;return i.a.createElement("div",{id:"song-info-panel"},i.a.createElement("p",null,"We're looking for 3D artists to partner with. Interested? Know someone who might be? Please get in touch."),i.a.createElement("h2",null,"Song"),i.a.createElement("p",null,"Title: ",n),i.a.createElement("p",null,"BPM: ",a),i.a.createElement("p",null,"Key Signature: ",r),i.a.createElement("p",null,"Time Signature: ",s,"/4 "),i.a.createElement("h2",null,"Credits"),o.map((function(e){return i.a.createElement("p",null,e.type,e.content)})),i.a.createElement("h2",null,"Connect"),i.a.createElement("div",{className:"flex-row"},i.a.createElement("a",{className:"social-link",href:"mailto:markracette@gmail.com"},"Email"),"\xa0|\xa0",i.a.createElement("a",{className:"social-link",href:"https://instagram.com/rgb.ig"},"Instagram"),"\xa0|\xa0",i.a.createElement("a",{className:"social-link",href:"https://twitter.com/markracette"}," Twitter"),"\xa0|\xa0",i.a.createElement("a",{className:"social-link",href:"https://github.com/mracette"}," Github")))}),Ce=function(e){return new Promise((function(t,n){var a=new XMLHttpRequest;a.responseType="arraybuffer",a.addEventListener("load",(function(){200===a.status&&t(a.response)})),a.addEventListener("error",(function(e){n(e)})),a.open("GET",e,!0),a.send()}))},Le=function(){function e(t,n,a){Object(k.a)(this,e),this.context=t,this.bufferSource=n;var i={bpm:120,loopLengthBeats:16,destination:t.destination,fades:!1,loop:!0};Object.assign(this,Object(h.a)({},i,{},a)),this.secondsPerBeat=60/this.bpm,this.loopLengthSeconds=this.loopLengthBeats*this.secondsPerBeat,this.bufferSource.loop=this.loop,this.bufferSource.loopStart=0,this.bufferSource.loopEnd=n.buffer.duration,this.bufferSource.connect(this.destination)}return Object(E.a)(e,[{key:"start",value:function(e){var t=this;this.bufferSource.start(e),this.bufferSource.onended=function(){return t.reload()}}},{key:"stop",value:function(e){try{this.bufferSource.stop(e)}catch(t){console.log(t)}}},{key:"reload",value:function(){console.log("reloading");var e=this.context.createBufferSource();e.buffer=this.bufferSource.buffer,e.connect(this.destination),this.bufferSource=e}}]),e}(),De=function(){function e(t){Object(k.a)(this,e),this.audioCtx=t,this.queue=[],this.repeatingQueue=[],this.eventId=0}return Object(E.a)(e,[{key:"scheduleOnce",value:function(e,t,n){var a=this.eventId;this.eventId++;var i=this.audioCtx.createBuffer(1,1,44100),r=this.audioCtx.createBufferSource();if(r.buffer=i,this.queue.push({id:a,name:t||null,time:e,type:"single",source:r}),n)return r.onended=n,r.start(e-i.duration),a;var s=new Promise((function(e){return r.onended=function(){e(a)}}));return r.start(e-i.duration),s}},{key:"scheduleRepeating",value:function(e,t,n){var a=this,i=this.eventId;this.eventId++;var r=this.audioCtx.createBuffer(1,1,44100),s=this.audioCtx.createBufferSource();s.buffer=r,s.onended=n;var o=window.setInterval((function(){a.updateQueue()}),t/4*1e3);return s.start(Math.max(0,e-r.duration)),this.repeatingQueue.push({id:i,time:e,type:"repeating",frequency:t,timer:o,source:s}),i}},{key:"updateCallback",value:function(e,t){var n;(n=this.queue.find((function(t){return t.id===e})))||(n=this.repeatingQueue.find((function(t){return t.id===e}))),n&&(n.source.onended=t)}},{key:"updateQueue",value:function(){for(var e=this.repeatingQueue.length-1;e>=0;e--){var t=this.repeatingQueue[e];if(t.time<this.audioCtx.currentTime){this.repeatingQueue.splice(e,1);var n=this.audioCtx.createBuffer(1,1,44100),a=this.audioCtx.createBufferSource();a.buffer=n,a.onended=t.source.onended,a.start(Math.max(0,t.time+t.frequency-n.duration)),this.repeatingQueue.push({id:t.id,time:t.time+t.frequency,type:"repeating",frequency:t.frequency,timer:t.timer,source:a})}}}},{key:"getEvent",value:function(e){var t=this.queue.find((function(t){return t.id===e}));if(t)return t;var n=this.repeatingQueue.find((function(t){return t.id===e}));return n||!1}},{key:"clear",value:function(){this.queue.forEach((function(e){e.source.onended=null,e.source.stop()})),this.repeatingQueue.forEach((function(e){window.clearInterval(e.timer),e.source.onended=null,e.source.stop()})),this.queue=[],this.repeatingQueue=[]}},{key:"cancel",value:function(e){if("undefined"!==typeof e){var t=this.getEvent(e);t.source.onended=null,t.source.stop(),this.queue=this.queue.filter((function(e){return e.id!==t.id})),this.repeatingQueue=this.repeatingQueue.filter((function(e){return e.id!==t.id}))}}}]),e}(),Se=(n(67),function(e){var t=i.a.useRef(),a=i.a.useRef(),r=i.a.useRef(),s=i.a.useRef(),c=i.a.useContext(f).vh,u=i.a.useContext(v),l=u.id,h=u.timeSignature,d=u.bpm,m=i.a.useContext(g),p=m.dispatch,b=m.audioCtx,w=m.audioCtxInitTime,k=m.sampleRate,E=i.a.useContext(y).flags,j=e.handleUpdatePlayerOrder,O=e.handleUpdateOverrides,M=e.name,C=e.groupName,L=e.groupNode,D=e.override,S=e.length,R=i.a.useState("stopped"),P=Object(o.a)(R,2),q=P[0],z=P[1],A=E.quantizeSamples?4*h:1,B=c?3.5*c:0,T=c?3.5*c/15:0,I=i.a.useCallback((function(e){s.current.clear();var t="active"===e?"pending-start":"pending-stop";z(t),j(M,t),p({type:"updatePlayerState",payload:{id:M,newState:t}});var n=function(e,t,n,a){var i=(e.currentTime-t)/(60/n),r=t+(Math.floor(i/a)+1)*a*(60/n);return r}(b,w,d,A);switch(e){case"active":a.current.start(n);break;case"stopped":a.current.stop(n)}s.current.scheduleOnce(n).then((function(){z(e),p({type:"updatePlayerState",payload:{id:M,newState:e}})}));var i=1e3*(n-b.currentTime);!function(e,t){var n,a,i,s;x.a.remove(r.current.circleSvg),x.a.remove(r.current.iconPoly),x.a.remove(r.current.iconDiv),x.a.remove(r.current.iconDiv.children),x.a.remove(r.current.button),"start"===e?(s="-180",i="rgba(255, 255, 255, .3)",n=[0,2*Math.PI*(B-T/2)],a=[{value:"6.69872981 6.69872981 93.01270188 6.69872981 93.01270188 50 93.01270188 93.01270188 6.69872981 93.01270188"}]):"stop"===e&&(s="0",i="rgba(255, 255, 255, 0)",n=[r.current.circleSvg.style.strokeDashoffset,0],a=[{value:"6.69872981 0 6.69872981 0 93.01270188 50 6.69872981 100 6.69872981 100"}]),Object(x.a)({targets:r.current.circleSvg,strokeDashoffset:n,duration:t,easing:"linear"}),Object(x.a)({targets:r.current.iconPoly,points:a,duration:t,easing:"linear"}),Object(x.a)({targets:[r.current.iconDiv,r.current.iconDiv.children],rotateZ:s,duration:t,easing:"linear"}),Object(x.a)({targets:r.current.button,backgroundColor:i,duration:t,easing:"easeInCubic"})}("stopped"===e?"stop":"start",i)}),[b,w,d,T,B,p,A,j,M]);return i.a.useEffect((function(){s.current=new De(b);var e=n(68)("./".concat(l,"/").concat(M,".mp3"));Object(le.b)(b,e,{offlineRendering:!0,renderLength:k*parseInt(S)*h*60/d}).then((function(e){a.current=new Le(b,e,{destination:L,loop:!0}),p({type:"addPlayer",payload:{player:{id:M,groupName:C,playerState:q,buttonRef:t.current}}})})),r.current={button:t.current,circleSvg:t.current.children[0],iconDiv:t.current.children[1],iconSvg:t.current.children[1].children[0],iconPoly:t.current.children[1].children[0].children[0]}}),[]),i.a.useEffect((function(){!D||"active"!==q&&"pending-start"!==q||(I("stopped"),O(M))}),[q,I,O,M,D]),i.a.createElement("button",{type:"button",className:"toggle-button",ref:t,onClick:function(){switch(q){case"stopped":I("active");break;case"active":case"pending-start":I("stopped")}},style:{height:2*B,width:2*B}},i.a.createElement("svg",{className:"svg",width:2*B,height:2*B,style:{strokeDashoffset:"active"===q?2*Math.PI*(B-T/2):0}},i.a.createElement("circle",{className:"svg-circle",cx:B,cy:B,r:B-T/2,style:{strokeWidth:T,strokeDasharray:2*Math.PI*(B-T/2)}})),i.a.createElement("div",{id:"scale-div-morph",className:"icon"},i.a.createElement("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:"icon icon-white"},i.a.createElement("polygon",{id:"icon-play3-poly",className:"icon icon-white",points:"6.69872981 0 46.650635094 25 93.01270188 50 46.650635094 75 6.69872981 100"}))))}),Re=(n(35),function(e){var t=i.a.useRef(null),n=i.a.useRef(null),a=i.a.useContext(b).spectrumFunction,r=i.a.useCallback((function(t,i){n.current.lineWidth=t.height/20,i.clearRect(0,0,t.width,t.height);var r,s,o=e.analyser.getTimeData(),c=t.width/(o.length-1),u=0;o.forEach((function(n,l){i.beginPath(),e.gradient&&(i.strokeStyle=a(e.index/e.groupCount+l/(o.length*e.groupCount)));var h=n/128*t.height/2;0===u?i.moveTo(u,h):i.moveTo(r,s),i.lineTo(u,h),r=u,s=h,u+=c,i.stroke()}))}),[e,a]);return be((function(){return r(t.current,n.current)})),i.a.useMemo((function(){return i.a.createElement("div",{id:"oscilloscope"},i.a.createElement(fe,{id:"oscilloscope-canvas",onLoad:function(e){t.current=e,n.current=e.getContext("2d")}}))}),[])}),Pe=n(117),qe=function(){function e(t,n,a){Object(k.a)(this,e),this.input=n,this.context=t;var i={id:null,power:13,minDecibels:-130,maxDecibels:0,minFrequency:20,maxFrequency:16500,smoothingTimeConstant:.8,numBuckets:10,split:!1,aWeighted:!1,xEasing:void 0,yEasing:void 0,binMethod:"center"};if(Object.assign(this,Object(h.a)({},i,{},a)),this.fftSize=Math.pow(2,this.power),this.frequencyBinCount=this.fftSize/2,this.nyquist=this.context.sampleRate/2,this.binSize=this.nyquist/this.frequencyBinCount,this.adj="center"===this.binMethod?.5:"start"===this.binMethod?0:"end"===this.binMethod?1:.5,this.binMin=Math.floor(this.minFrequency/this.binSize),this.binMax=this.frequencyBinCount-Math.floor((this.nyquist-this.maxFrequency)/this.binSize),this.bucketCounts=new Array(this.numBuckets).fill(0,0,this.numBuckets),this.bucketData=new Array(this.numBuckets).fill(0,0,this.numBuckets),this.minFrequency=(this.binMin+this.adj)*this.binSize,this.maxFrequency=(this.binMax+this.adj)*this.binSize,"string"===typeof this.xEasing)switch(this.xEasing){case"polyIn":this.xEasing=Pe.a.exponent(this.xExponent);break;case"polyOut":this.xEasing=Pe.c.exponent(this.xExponent);break;case"polyInOut":this.xEasing=Pe.b.exponent(this.xExponent);break;default:this.xEasing=function(e){return e}}if("string"===typeof this.yEasing)switch(this.yEasing){case"polyIn":this.yEasing=Pe.a.exponent(this.yExponent);break;case"polyOut":this.yEasing=Pe.c.exponent(this.yExponent);break;case"polyInOut":this.yEasing=Pe.b.exponent(this.yExponent);break;default:this.yEasing=function(e){return e}}this.createAudioNodes(),this.createDataStructure(),this.aWeighted&&this.createAWeights()}return Object(E.a)(e,[{key:"createAudioNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.split;if(e){var t=this.context.createChannelSplitter(2);this.input.connect(t),this.analyser={},this.analyser.left=this.context.createAnalyser(),this.analyser.right=this.context.createAnalyser(),t.connect(this.analyser.left,0),t.connect(this.analyser.right,1),this.analyser.left.fftSize=Math.pow(2,this.power),this.analyser.left.minDecibels=this.minDecibels,this.analyser.left.maxDecibels=this.maxDecibels,this.analyser.left.smoothingTimeConstant=this.smoothingTimeConstant,this.analyser.right.fftSize=Math.pow(2,this.power),this.analyser.right.minDecibels=this.minDecibels,this.analyser.right.maxDecibels=this.maxDecibels,this.analyser.right.smoothingTimeConstant=this.smoothingTimeConstant}else this.analyser=this.context.createAnalyser(),this.analyser.fftSize=Math.pow(2,this.power),this.analyser.minDecibels=this.minDecibels,this.analyser.maxDecibels=this.maxDecibels,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,this.input.connect(this.analyser)}},{key:"createDataStructure",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.split;e?(this.fftData={},this.timeData={},this.fftData.left=new Uint8Array(this.analyser.left.frequencyBinCount),this.fftData.right=new Uint8Array(this.analyser.right.frequencyBinCount),this.timeData.left=new Uint8Array(this.analyser.left.fftSize),this.timeData.right=new Uint8Array(this.analyser.right.fftSize)):(this.fftData=new Uint8Array(this.analyser.frequencyBinCount),this.timeData=new Uint8Array(this.analyser.fftSize))}},{key:"createAWeights",value:function(){for(var e=[],t=this.nyquist/this.frequencyBinCount,n=0;n<this.frequencyBinCount;n++)e[n]=(n+.5)*t;this.aWeights=e.map((function(e){return function(e){var t=e*e;return 1.2588966*14884e4*t*t/((t+424.36)*Math.sqrt((t+11599.29)*(t+544496.41))*(t+14884e4))}(e)}))}},{key:"getFrequencyData",value:function(e){var t=this;return"left"===e||"right"===e?(this.analyser[e].getByteFrequencyData(this.fftData[e]),this.yEasing&&this.fftData[e].forEach((function(e,n,a){return a[n]=255*t.yEasing(e/255)})),this.aWeights&&this.fftData[e].forEach((function(e,n,a){return a[n]=t.aWeights[n]*e})),this.fftData[e]):(this.analyser.getByteFrequencyData(this.fftData),this.yEasing&&this.fftData.forEach((function(e,n,a){return a[n]=255*t.yEasing(e/255)})),this.aWeighted&&this.fftData.forEach((function(e,n,a){return a[n]=t.aWeights[n]*e})),this.fftData)}},{key:"getFrequencyBins",value:function(e){var t=this,n=[];return this.getFrequencyData(e).slice(this.binMin,this.binMax+1).forEach((function(e,a){n.push({data:e,freq:(t.binMin+a+t.adj)*t.binSize})})),n}},{key:"getFrequencyBuckets",value:function(e){var t=this,n=this.getFrequencyData(e);this.bucketData.forEach((function(e,n,a){a[n]=0,t.bucketCounts[n]=0}));for(var a=this.binMin;a<=this.binMax;a++){var i=this.xEasing?Math.floor(this.xEasing(a/(this.binMax-this.binMin+1))*this.numBuckets):Math.floor(a/(this.binMax-this.binMin+1)*this.numBuckets);this.bucketData[i]+=n[a],this.bucketCounts[i]+=1}return this.bucketData.forEach((function(e,n,a){return a[n]=e/t.bucketCounts[n]})),this.bucketData}},{key:"getTimeData",value:function(e){return"left"===e||"right"===e?(this.analyser[e].getByteTimeDomainData(this.timeData[e]),this.timeData[e]):(this.analyser.getByteTimeDomainData(this.timeData),this.timeData)}},{key:"reconnect",value:function(e){this.input.disconnect(),e.connect(this.analyser)}}]),e}(),ze=(n(103),function(e){var t=i.a.useContext(b),a=t.groupMuteButton,r=t.groupSoloButton,s=i.a.useContext(g),c=s.dispatch,u=s.audioCtx,l=s.premaster,d=i.a.useRef(u.createGain()),m=i.a.useState(null),p=Object(o.a)(m,2),f=p[0],y=p[1],v=i.a.useState(!1),w=Object(o.a)(v,2),x=w[0],k=w[1],E=i.a.useState(!1),j=Object(o.a)(E,2),O=j[0],M=j[1],C=i.a.useState([]),L=Object(o.a)(C,2),D=L[0],S=L[1],R=i.a.useState([]),P=Object(o.a)(R,2),q=P[0],z=P[1];i.a.useEffect((function(){var t=u.createBiquadFilter();t.type="lowshelf",t.frequency.value=120,t.gain.value=-12,d.current.connect(t);var a=u.createGain();a.gain.value=1;var i=u.createGain();i.gain.value=1;var r=u.createBiquadFilter();r.type="highpass",r.frequency.value=20,r.Q.value=.71;var s=u.createBiquadFilter();s.type="lowpass",s.frequency.value=2e4,s.Q.value=.71;var o=u.createGain();o.gain.value=1;var m=u.createGain();m.gain.value=0;var p=u.createConvolver(),f=n(104);Ce(f).then((function(e){u.decodeAudioData(e,(function(e){p.buffer=e,c({type:"impulseResponse",payload:{name:"standard",buffer:e}})}))})),d.current.connect(a),a.connect(s),s.connect(r),r.connect(o),r.connect(m),o.connect(i),m.connect(p),p.connect(i),i.connect(l);var g=new qe(u,t,{id:"".concat(e.name,"-oscilloscope-analyser"),power:5,minDecibels:-120,maxDecibels:0,smoothingTimeConstant:0}),b=new qe(u,i,Object(h.a)({id:"".concat(e.name,"-analyser")},e.analyserParams));y(g),c({type:"addAnalyser",payload:{analyser:b}}),c({type:"addEffect",payload:{effectType:"reverb-dry",effect:o}}),c({type:"addEffect",payload:{effectType:"reverb-wet",effect:m}}),c({type:"addEffect",payload:{effectType:"lowpass",effect:s}}),c({type:"addEffect",payload:{effectType:"highpass",effect:r}})}),[u,c,l,e.analyserParams,e.name]),i.a.useEffect((function(){O&&!x?d.current.gain.value=0:O||e.soloOverride||(d.current.gain.value=1),x&&(e.handleAddSolo(e.name),d.current.gain.value=1),e.soloOverride!==e.name||x||(e.handleAddSolo(!1),O&&(d.current.gain.value=0))}),[O,x,e]),i.a.useEffect((function(){e.soloOverride&&e.soloOverride!==e.name&&(k(!1),d.current.gain.value=0),e.soloOverride||O||(d.current.gain.value=1)}),[e.soloOverride,O,e.name]);var A=i.a.useCallback((function(t,n){"pending-start"===n?e.currentPolyphony<e.polyphony||-1===e.polyphony?S(D.concat([t])):(z(q.concat(D[0])),S(D.slice(1).concat([t]))):"pending-stop"===n&&S(D.filter((function(e){return e!==t})))}),[e.currentPolyphony,e.polyphony,D,q]),B=i.a.useCallback((function(e){z(q.filter((function(t){return t!==e})))}),[q]);return i.a.createElement("div",{className:"toggle-button-group flex-col"},i.a.createElement("div",{className:"flex-row"},i.a.createElement("h3",null,e.name," (",e.currentPolyphony," / ",-1===e.polyphony?e.voices.length:e.polyphony,")"),f&&i.a.createElement(Re,{index:e.index,groupCount:e.groupCount,gradient:!0,name:e.name,analyser:f}),i.a.createElement("button",{className:"solo-button",style:x?{background:r}:void 0,onClick:function(){return k(!x)}},"S"),i.a.createElement("button",{className:"mute-button",style:O?{background:a}:void 0,onClick:function(){return M(!O)}},"M")),i.a.createElement("div",{className:"toggle-buttons flex-row"},e.voices.map((function(t){return i.a.createElement(Se,{key:t.name,name:t.name,groupName:e.name,length:t.length,quantizeLength:t.quantizeLength,handleUpdatePlayerOrder:A,handleUpdateOverrides:B,override:-1!==q.indexOf(t.name),groupNode:d.current})}))))}),Ae=(n(105),function(e){var t=i.a.useContext(b),n=t.panelMuteButton,a=t.panelRandomizeButton,r=i.a.useContext(g),s=r.dispatch,c=r.randomize,u=r.mute,l=i.a.useContext(v).groups,h=i.a.useState(!1),d=Object(o.a)(h,2),m=d[0],p=d[1],f=function(e){p(e)};return i.a.createElement("div",{id:"toggle-button-panel",className:"flex-panel"},i.a.createElement("h2",null,"Voices"),i.a.createElement("div",{className:"flex-row"},i.a.createElement("button",{className:"button-white grouped-buttons",id:"toggle-button-panel-reset",onClick:e.handleReset},"Reset"),i.a.createElement("button",{id:"toggle-button-panel-randomize",className:"button-white grouped-buttons",style:c?{background:a}:void 0,onClick:function(){return s(c?{type:"stopRandomize"}:{type:"startRandomize"})}},"Randomize"),i.a.createElement("button",{id:"toggle-button-panel-mute",className:"button-white grouped-buttons",style:u?{background:n}:void 0,onClick:function(){return s(u?{type:"stopMute"}:{type:"startMute"})}},"Mute")),l.map((function(t,n){return i.a.createElement(ze,{index:n,handleAddSolo:f,soloOverride:m,key:t.name,name:t.name,groupCount:l.length,currentPolyphony:e.players.filter((function(e){return e.groupName===t.name&&("active"===e.playerState||"pending-start"===e.playerState)})).length,polyphony:t.polyphony,voices:t.voices,analyserParams:t.analyser})})))}),Be=function(e,t){switch(t.type){case"startRandomize":return Object(h.a)({},e,{randomize:!0});case"stopRandomize":return Object(h.a)({},e,{randomize:!1});case"setRandomizeEffects":return Object(h.a)({},e,{randomizeEffects:t.payload});case"resetPlayers":return e.players.forEach((function(e){"active"===e.instance.state.playerState&&e.instance.stopPlayer(!1,!0),"pending-start"===e.instance.state.playerState&&e.instance.pendingStop(!1,!0)})),e;case"addPlayer":return Object(h.a)({},e,{players:[].concat(Object(P.a)(e.players),[t.payload.player])});case"addButton":return Object(h.a)({},e,{buttons:[].concat(Object(P.a)(e.buttons),[t.payload.button])});case"addAnalyser":return Object(h.a)({},e,{analysers:[].concat(Object(P.a)(e.analysers),[t.payload.analyser])});case"updatePlayerState":return Object(h.a)({},e,{players:[].concat(Object(P.a)(e.players.filter((function(e){return e.id!==t.payload.id}))),[Object(h.a)({},e.players.find((function(e){return e.id===t.payload.id})),{playerState:t.payload.newState})])});case"startMute":return Object(h.a)({},e,{mute:!0});case"stopMute":return Object(h.a)({},e,{mute:!1});case"addImpulseResponse":return Object(h.a)({},e,{impulseResponses:[].concat(Object(P.a)(e.impulseResponses),[t.payload.impulseResponse])});case"addEffect":switch(t.payload.effectType){case"highpass":return Object(h.a)({},e,{groupEffects:Object(h.a)({},e.groupEffects,{highpass:[].concat(Object(P.a)(e.groupEffects.highpass),[t.payload.effect])})});case"lowpass":return Object(h.a)({},e,{groupEffects:Object(h.a)({},e.groupEffects,{lowpass:[].concat(Object(P.a)(e.groupEffects.lowpass),[t.payload.effect])})});case"reverb-dry":return Object(h.a)({},e,{groupEffects:Object(h.a)({},e.groupEffects,{reverbDry:[].concat(Object(P.a)(e.groupEffects.reverbDry),[t.payload.effect])})});case"reverb-wet":return Object(h.a)({},e,{groupEffects:Object(h.a)({},e.groupEffects,{reverbWet:[].concat(Object(P.a)(e.groupEffects.reverbWet),[t.payload.effect])})});default:return e}case"incrementHighpass":return Object(h.a)({},e,{effectValues:Object(h.a)({},e.effectValues,{highpass:e.effectValues.highpass+t.payload.value})});case"incrementLowpass":return Object(h.a)({},e,{effectValues:Object(h.a)({},e.effectValues,{lowpass:e.effectValues.lowpass+t.payload.value})});case"incrementAmbience":return Object(h.a)({},e,{effectValues:Object(h.a)({},e.effectValues,{ambience:e.effectValues.ambience+t.payload.value})});case"setHighpass":return Object(h.a)({},e,{effectValues:Object(h.a)({},e.effectValues,{highpass:t.payload.value})});case"setLowpass":return Object(h.a)({},e,{effectValues:Object(h.a)({},e.effectValues,{lowpass:t.payload.value})});case"setAmbience":return Object(h.a)({},e,{effectValues:Object(h.a)({},e.effectValues,{ambience:t.payload.value})});default:return e}},Te=function(){function e(t,n,a){Object(k.a)(this,e),this.bpm=a.bpm||120,this.secondsPerBeat=60/this.bpm,this.snapToGrid=a.snapToGrid||!0,this.loopLengthBeats=a.loopLengthBeats||16,this.loopLengthSeconds=this.loopLengthBeats*this.secondsPerBeat,this.refreshRate=a.refreshRate||this.loopLengthSeconds/4*1e3,this.fadeInTime=a.fadeInTime||this.secondsPerBeat/32,this.fadeOutTime=a.fadeOutTime||this.secondsPerBeat/32,this.audioCtx=t,this.destination=a.destination||t.destination,this.buffer=n,this.queue=[],this.garbage=[],this.intervalTimer=void 0,this.activeEventTime=void 0,this.prevEventTime=void 0,this.scheduledEvents=[]}return Object(E.a)(e,[{key:"addEventToQueue",value:function(e,t){var n=this.audioCtx.createGain();n.connect(this.destination);var a=this.audioCtx.createBufferSource();if(a.buffer=this.buffer,a.connect(n),t){var i=this.audioCtx.createBuffer(1,1,44100),r=this.audioCtx.createBufferSource();r.buffer=i,r.onended=t,r.start(e-i.duration)}a.start(e,0,this.loopLengthSeconds),n.gain.setValueAtTime(.001,e),n.gain.exponentialRampToValueAtTime(1,e+this.fadeInTime),n.gain.setValueAtTime(1,e+this.loopLengthSeconds-this.fadeOutTime),n.gain.exponentialRampToValueAtTime(.001,e+this.loopLengthSeconds),this.queue.push({bufferSource:a,gainNode:n,time:e})}},{key:"updateQueue",value:function(){for(var e=this.queue.length-1;e>=0;e--)this.queue[e].time<this.audioCtx.currentTime&&(this.prevEventTime=this.queue[e].time,this.garbage.push(this.queue.splice(e,1)[0]));for(var t=this.garbage.length-1;t>=0;t--)this.garbage[t].time+this.loopLengthSeconds<this.audioCtx.currentTime&&(this.garbage[t].bufferSource.disconnect(),this.garbage[t].gainNode.disconnect(),this.garbage.splice(t,1));for(;this.queue.length<1;){var n=this.prevEventTime+this.loopLengthSeconds;this.addEventToQueue(n)}}},{key:"start",value:function(e,t){var n=this;this.activeEventTime=this.snapToGrid&&e?e:this.audioCtx.currentTime,this.addEventToQueue(this.activeEventTime,t),this.intervalTimer=window.setInterval((function(){n.updateQueue()}),this.refreshRate)}},{key:"stop",value:function(e){var t=this;return new Promise((function(n,a){try{t.intervalTimer&&window.clearInterval(t.intervalTimer),t.queue.map((function(t){e?t.bufferSource.stop(e):t.bufferSource.stop()})),t.garbage.map((function(t){e?t.bufferSource.stop(e):t.bufferSource.stop()}));var i=t.audioCtx.createBuffer(1,1,44100),r=t.audioCtx.createBufferSource();r.buffer=i,r.onended=function(){t.queue.map((function(e){e.bufferSource.disconnect(),e.gainNode.disconnect(),e.bufferSource.stop()})),t.garbage.map((function(e){e.bufferSource.disconnect(),e.gainNode.disconnect(),e.bufferSource.stop()})),n()},e?r.start(e-i.duration):r.start()}catch(s){a(s)}}))}},{key:"schedule",value:function(e){var t=this;return new Promise((function(n,a){try{var i=t.audioCtx.createBuffer(1,1,44100),r=t.audioCtx.createBufferSource();r.buffer=i,r.onended=function(){return n()},r.start(e-i.duration),t.scheduledEvents.push(r)}catch(s){a(s)}}))}},{key:"cancel",value:function(){this.scheduledEvents.map((function(e){e.onended=null,e.stop()})),this.scheduledEvents=[]}}]),e}(),Ie=(n(106),{lpFilter:{minFreq:320,maxFreq:2e4,minQ:.71,maxQ:3,expFreqParams:R(1,320,100,2e4),expQParams:R(1,.71,100,3)},hpFilter:{minFreq:20,maxFreq:4500,minQ:.71,maxQ:1.5,expFreqParams:R(1,20,100,4500),expQParams:R(1,.71,100,1.5)},ambience:{minWet:0,maxWet:.55}}),Fe=function(e){var t=i.a.useContext(y).playAmbientTrack,a=i.a.useContext(v),r=a.id,s=a.timeSignature,c=a.bpm,u=a.ambientTrack,l=a.ambientTrackLength,d=i.a.useState(null),m=Object(o.a)(d,2),p=m[0],f=m[1],b=i.a.useReducer(Be,{randomize:!1,randomizeEffects:!1,mute:!1,players:[],buttons:[],analysers:[],groups:[],groupEffects:{highpass:[],lowpass:[],reverbDry:[],reverbWet:[]},effectValues:{highpass:1,lowpass:100,ambience:1}}),w=Object(o.a)(b,2),x=w[0],k=w[1],E=i.a.useRef(),j=(i.a.useRef(),i.a.useRef(),i.a.useRef()),O=i.a.useRef(new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100,latencyHint:"interactive"})),M=i.a.useRef(O.current.currentTime),C=i.a.useRef(new De(O.current)),L=i.a.useRef(O.current.createGain()),D=i.a.useCallback((function(){x.players.filter((function(e){return"active"===e.playerState||"pending-start"===e.playerState})).forEach((function(e){return e.buttonRef.click()}))}),[x.players]),S=i.a.useCallback((function(){var e=x.players.filter((function(e){return!e.playerState.includes("pending")})),t=Math.floor(Math.random()*e.length);if(x.players[t].buttonRef.click(),e.length>=x.players.length){var n=e.filter((function(e,n){return n!==t})),a=Math.floor(Math.random()*n.length);x.players[a].buttonRef.click()}}),[x.players]);return i.a.useEffect((function(){var e=Ie.hpFilter.expFreqParams,t=Ie.hpFilter.expQParams;x.groupEffects.highpass.forEach((function(n){n.frequency.value=e.a*Math.pow(e.b,x.effectValues.highpass),n.Q.value=t.a*Math.pow(t.b,x.effectValues.highpass)}))}),[x.effectValues.highpass,x.groupEffects.highpass]),i.a.useEffect((function(){var e=Ie.lpFilter.expFreqParams,t=Ie.lpFilter.expQParams;x.groupEffects.lowpass.forEach((function(n){n.frequency.value=e.a*Math.pow(e.b,x.effectValues.lowpass),n.Q.value=t.a*Math.pow(t.b,x.effectValues.lowpass)}))}),[x.effectValues.lowpass,x.groupEffects.lowpass]),i.a.useEffect((function(){var e=Ie.ambience.minWet+(Ie.ambience.maxWet-Ie.ambience.minWet)*(x.effectValues.ambience-1)/99;x.groupEffects.reverbDry.forEach((function(t){t.gain.value=1-e})),x.groupEffects.reverbWet.forEach((function(t){t.gain.value=e}))}),[x.effectValues.ambience,x.groupEffects.reverbDry,x.groupEffects.reverbWet]),i.a.useEffect((function(){var e=O.current;if(e.resume(),f(new qe(O.current,L.current,{power:6,minDecibels:-120,maxDecibels:0,smoothingTimeConstanct:.25})),L.current.connect(O.current.destination),t&&u){var a=n(107)("./".concat(r,"/ambient-track.mp3"));(function(e,t){return new Promise((function(n,a){Ce(t).then((function(t){e.decodeAudioData(t,(function(t){var a=e.createBufferSource();a.buffer=t,n(a)}),(function(e){console.error(e),a(e)}))})).catch((function(e){console.error(e),a(e)}))}))})(O.current,a).then((function(e){j.current=new Te(O.current,e.buffer,{bpm:c,loopLengthBeats:l*s,snapToGrid:!1,fadeInTime:1e-7,fadeOutTime:1e-7,audioCtxInitTime:M.current,destination:L.current}),j.current.start()}))}return function(){t&&j.current.stop(),e.close()}}),[c,r,t,u,l,s]),i.a.useEffect((function(){x.randomize&&!C.current.repeatingQueue.find((function(e){return e.id===E.current}))?E.current=C.current.scheduleRepeating(O.current.currentTime+60/c,1920/c,S):x.randomize?C.current.updateCallback(E.current,S):x.randomize||C.current.cancel(E.current)}),[c,x.randomize,S]),i.a.useEffect((function(){x.mute?L.current.gain.value=0:L.current.gain.value=1}),[x.mute]),i.a.createElement(g.Provider,{value:Object(h.a)({},x,{sampleRate:44100,audioCtx:O.current,audioCtxInitTime:M.current,schedulerRef:C.current,premaster:L.current,dispatch:k})},p&&i.a.createElement(ve,{premasterAnalyser:p}),i.a.createElement(Oe,{name:"Menu",direction:"right",separation:"6rem",parentSize:"5rem",clickToOpen:!0,childButtonProps:[{autoOpen:!0,id:"toggles",iconName:"icon-music",content:i.a.createElement(Ae,{handleReset:D,players:x.players})},{id:"effects",iconName:"icon-equalizer",content:i.a.createElement(ye,{impulseResponse:x.impulseResponse,dispatch:k})},{id:"song-info",iconName:"icon-info",content:i.a.createElement(Me,null)}]}),i.a.createElement(ge,null))};n(24);function Ne(e){var t=i.a.useRef(null),n=i.a.useRef(),a=i.a.useRef(0),r=i.a.useRef(0),s=i.a.useRef(),o=i.a.useRef(),c=i.a.useContext(p).dispatch,u=e.animate,l=e.id;return i.a.useEffect((function(){var i=function e(t,i,c){var l=c?0:t-r.current;a.current+=.001*l,r.current=t,n.current.clearRect(0,0,o.current.getWidth(),o.current.getHeight()),n.current.lineWidth=o.current.getWidth()/128,n.current.strokeStyle="#f6f2d5",u(n.current,a.current,o.current),i&&(s.current=window.requestAnimationFrame((function(t){return e(t,!0)})))},l=function(){return c({type:e.name})},h=function(){return c({type:null})},d=function(){s.current=window.requestAnimationFrame((function(e){return i(e,!0,!0)}))},m=function(){window.cancelAnimationFrame(s.current)};return t.current.addEventListener("mouseover",d),t.current.addEventListener("mouseover",l),t.current.addEventListener("mouseout",m),t.current.addEventListener("mouseout",h),o.current=new T({canvas:t.current,padding:.02}),n.current=t.current.getContext("2d"),i(0,!1,!1),function(){m(),t.current.removeEventListener("mouseover",d),t.current.removeEventListener("mouseover",l),t.current.removeEventListener("mouseout",m),t.current.removeEventListener("mouseout",h)}}),[c,e.name,u]),i.a.useMemo((function(){return i.a.createElement(fe,{id:l,className:"custom-song-icon",onLoad:function(e){return t.current=e},resize:!1})}),[l])}var We=function(e,t,n){for(var a=0;a<5;a++)e.beginPath(),e.arc(n.nx(A(.2,0,0,0,t+q*a/5).x),n.ny(A(.2,0,0,0,t+q*a/5).y),n.getWidth()/4,0,q),e.stroke()};function Ve(e){return i.a.createElement(Ne,{name:e.name,id:"custom-moonrise-icon",animate:We})}var He=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return function(s){return t+(n-t)*(.5+(r?-1:1)*Math.sin(-a+Math.PI*s/(e/2))/2)+i}}(2,0,1,-1.5),Ge=function(e,t,n){for(var a=n.getWidth()/8,i=n.nx(0)-a/2,r=0;r<5;r++){var s=n.getHeight()*(.6-.1*Math.abs(2-r));e.beginPath(),e.strokeRect(i-(2-r)*a*He(t),n.ny(.1*Math.abs(2-r)-.6),a,s)}};function _e(e){return i.a.createElement(Ne,{name:e.name,id:"custom-mornings-icon",animate:Ge})}var Qe=function(e,t,n){for(var a=0;a<4;a++)e.beginPath(),e.arc(n.nx(A(-.5,0,0,0,t+q*a/4).x),n.ny(A(0,0,0,0,t+q*a/4).y),n.getWidth()/48,0,q),e.stroke()};function Ye(e){return i.a.createElement(Ne,{name:e.name,id:"coming-soon-icon",animate:Qe})}var Ue=function(){function e(t,n,a,i){Object(k.a)(this,e),this.scene=t,this.center=n,this.number=a,Object.assign(this,{color:16777215,colorPalette:null,intensityMap:[[0,1,1,1]],radiusSpread:0,minOrbitRadius:500,maxOrbitRadius:1e3,orbitSpeed:.1,rotateVector:new D.tb(1,1,1)},i),this.group=new D.r,this.starField=this.createSpheres(this.number),this.group.position.copy(this.center),this.scene.add(this.group)}return Object(E.a)(e,[{key:"guassianRand",value:function(){for(var e=0,t=0;t<6;t+=1)e+=Math.random();return e/6}},{key:"normalize",value:function(e,t,n,a){return{x:a*e/Math.sqrt(e*e+t*t+n*n),y:a*t/Math.sqrt(e*e+t*t+n*n),z:a*n/Math.sqrt(e*e+t*t+n*n)}}},{key:"createSpheres",value:function(e){for(var t,n=new D.f,a=[],i=[],r=[],s=0;s<e;s++){var o=this.normalize(2*this.guassianRand()-1,2*this.guassianRand()-1,2*this.guassianRand()-1,this.minOrbitRadius+Math.random()*(this.maxOrbitRadius-this.minOrbitRadius));a.push(o.x),a.push(o.y),a.push(o.z),i.push(1),t=this.colorPalette?new D.j(this.colorPalette(Math.random())):new D.j(this.color),r.push(t.r,t.g,t.b,1)}n.addAttribute("position",new D.o(a,3)),n.addAttribute("color",new D.o(r,4)),n.addAttribute("intensity",new D.o(i,1)),n.setDrawRange(0,e);var c=new D.Z({vertexColors:D.vb,transparent:!0,opacity:1}),u=new D.Y(n,c);return u.geometry.attributes.position.needsUpdate=!0,this.group.add(u),u}},{key:"update",value:function(e){this.group.rotateOnAxis(this.rotateVector.normalize(),e*this.orbitSpeed*2*Math.PI/60)}},{key:"lerp",value:function(e,t,n){return e*(1-n)+t*n}}]),e}(),Ke=function(e){function t(){return Object(k.a)(this,t),Object(j.a)(this,Object(C.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(E.a)(t,[{key:"initScene",value:function(){var e=new D.fb;return e.background=new D.j("#1f262f"),e}},{key:"initCamera",value:function(){var e,t=this.screenDimensions.width/this.screenDimensions.height;return(e=new D.V(60,1,1,1e3)).aspect=t,e.position.set(0,0,0),e.lookAt(new D.tb(0,1,0)),e.updateProjectionMatrix(),e}},{key:"initSubjects",value:function(){var e=new l.a('{"type":"arc","overflow":"clamp","reverse":false,"translation":{"x":-0.182,"y":-0.138},"scale":{"x":1,"y":1},"rotation":0,"angleStart":2.105,"angleEnd":6.283,"angleOffset":0,"radius":0.5}','{"type":"linear","overflow":"clamp","reverse":false,"translation":{"x":-0.003,"y":0.758},"scale":{"x":1.053,"y":-0.13},"rotation":0}','{"start":0,"end":1}'),t={};return t.stars=new Ue(this.scene,new D.tb(0,0,0),1e3,{colorPalette:function(t){return e.rgbValueAt(t)},minOrbitRadius:200,maxOrbitRadius:1e3}),t}},{key:"render",value:function(){this.subjects.stars.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera)}}]),t}(V),Xe=function(e,t){switch(t.type){case"moonrise":return{name:"Moonrise",bpm:"60",key:"G Minor"};case"mornings":return{name:"Mornings",bpm:"92",key:"Eb Major"};case"coming-soon":return{name:"Coming soon...",bpm:null,key:null};default:return{name:null,bpm:null,key:null}}},Je=function(){var e=i.a.useReducer(Xe,{name:null,bpm:null,key:null}),t=Object(o.a)(e,2),n=t[0],a=t[1],r=i.a.useRef(null);return i.a.useEffect((function(){var e;return r.current&&((e=new Ke(r.current)).init().then((function(){return e.animate()})),window.addEventListener("resize",e.onWindowResize),window.addEventListener("orientationchange",e.onWindowResize),window.addEventListener("fullscreenchange",e.onWindowResize)),function(){e.stop(),e.disposeAll(e.scene),window.removeEventListener("resize",e.onWindowResize),window.removeEventListener("orientationchange",e.onWindowResize),window.removeEventListener("fullscreenchange",e.onWindowResize)}}),[]),i.a.createElement(p.Provider,{value:{dispatch:a}},i.a.createElement(fe,{id:"star-canvas",className:"fullscreen",onLoad:function(e){return r.current=e}}),i.a.createElement("div",{id:"landing-page"},i.a.createElement("div",{id:"landing-page-header"},i.a.createElement("div",{className:"flex-row"},i.a.createElement("h1",{id:"landing-page-soundscape-title"},"Soundscape")),i.a.createElement("div",{className:"flex-row"},i.a.createElement("span",null,"This application uses audio.")),i.a.createElement("div",{className:"flex-row"},i.a.createElement("span",null,"Use speakers or headphones for the best experience.")),i.a.createElement("div",{className:"flex-row"},i.a.createElement("p",null,i.a.createElement("span",{id:n.name?"landing-page-song-title":"choose-a-song"},n.name||"Choose a song to begin."),n.bpm&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,"\xa0|\xa0")," ",i.a.createElement("span",{id:"landing-page-bpm"}," ".concat(n.bpm," bpm"))),n.key&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,"\xa0|\xa0")," ",i.a.createElement("span",{id:"landing-page-key"},n.key))))),i.a.createElement("div",{id:"song-selection-panel"},i.a.createElement(d.b,{className:"song-link",id:"song-link-moonrise",to:"/play/moonrise"},i.a.createElement(Ve,{name:"moonrise"})),i.a.createElement(d.b,{className:"song-link",id:"song-link-mornings",to:"/play/mornings"},i.a.createElement(_e,{name:"mornings"})),i.a.createElement(d.b,{className:"song-link",id:"song-link-coming-soon",to:"/coming-soon"},i.a.createElement(Ye,{name:"coming-soon"})))))},Ze=function(e){return i.a.createElement(d.a,null,i.a.createElement(m.d,null,i.a.createElement(m.b,{exact:!0,path:"/",component:Je}),i.a.createElement(m.b,{exact:!0,path:"/play/:songId",render:function(t){return i.a.createElement(b.Provider,{value:Object(h.a)({id:t.match.params.songId,spectrumFunction:e.spectrumFunctions[t.match.params.songId]},e.appConfig.find((function(e){return e.id===t.match.params.songId})).themes)},i.a.createElement(v.Provider,{value:Object(h.a)({id:t.match.params.songId},e.appConfig.find((function(e){return e.id===t.match.params.songId})).audio)},i.a.createElement(w.Provider,{value:Object(h.a)({id:t.match.params.songId},e.appConfig.find((function(e){return e.id===t.match.params.songId})).info)},i.a.createElement(Fe,null))))}}),i.a.createElement(m.a,{to:"/"})))},$e=new l.a('{"type":"arc","overflow":"clamp","reverse":false,"translation":{"x":-0.125,"y":-0.081},"scale":{"x":1,"y":1},"rotation":0,"angleStart":0,"angleEnd":3.142,"angleOffset":5.781,"radius":0.5}','{"type":"arc","overflow":"clamp","reverse":false,"translation":{"x":0.5,"y":0.5},"scale":{"x":1,"y":1},"rotation":0,"angleStart":0,"angleEnd":3.424,"angleOffset":0.628,"radius":0.25}','{"start":0,"end":1}'),et=n(113),tt={quantizeSamples:!1,showVisuals:!0,playAmbientTrack:!1},nt={moonrise:function(e){return new u.e(c.a(e)).brighter(1.5)},mornings:function(e){return $e.rgbValueAt(e)}},at=function(){var e=window.innerWidth,t=window.innerHeight;document.documentElement.style.setProperty("--vw","".concat(e/100,"px")),document.documentElement.style.setProperty("--vh","".concat(t/100,"px"));var n=i.a.useState(e/100),a=Object(o.a)(n,2),r=a[0],s=a[1],c=i.a.useState(t/100),u=Object(o.a)(c,2),l=u[0],h=u[1];return i.a.useEffect((function(){var e=function(){var e=window.innerWidth,t=window.innerHeight;document.documentElement.style.setProperty("--vw","".concat(e/100,"px")),document.documentElement.style.setProperty("--vh","".concat(t/100,"px")),s(e/100),h(t/100)};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),window.addEventListener("fullscreenchange",e),function(){window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e),window.removeEventListener("fullscreenchange",e)}}),[]),i.a.createElement(y.Provider,{value:{flags:tt}},i.a.createElement(f.Provider,{value:{vw:r,vh:l}},i.a.createElement(Ze,{appConfig:et,spectrumFunctions:nt})))},it=function(){var e=window.WebGLRenderingContext?"graphics card":"browser";return i.a.createElement("div",null,i.a.createElement("p",null,"Your ",e," does not seem to support ",i.a.createElement("a",{href:"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation"},"WebGL"),"."),i.a.createElement("p",null,"In order to access this application, you will need to use a supported device."))},rt=n(52);n(114);s.a.render(i.a.createElement((function(){return rt.a.isWebGLAvailable()?i.a.createElement("div",{id:"app-container",className:"fullscreen"},i.a.createElement(at,null)):i.a.createElement(it,null)}),null),document.getElementById("app"))}]),[[55,1,2]]]);
//# sourceMappingURL=main.c5808185.chunk.js.map