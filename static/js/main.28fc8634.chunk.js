(this["webpackJsonpsoundscape-refactor"]=this["webpackJsonpsoundscape-refactor"]||[]).push([[0],Array(23).concat([function(e,t,n){},,,function(e,t,n){},,,,function(e,t,n){e.exports=n.p+"static/media/iconList.2bc4ff09.svg"},,,,function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/ambient-track.145a3d16.mp3"},function(e,t,n){e.exports=n.p+"static/media/ambient-track.18f7bd51.mp3"},function(e,t,n){},,,,,function(e,t,n){e.exports=n.p+"static/media/house.70659559.glb"},function(e,t,n){e.exports=n.p+"static/media/table.bb57dcdb.glb"},function(e,t,n){e.exports=n.p+"static/media/flowers.37c1aabe.glb"},function(e,t,n){e.exports=n.p+"static/media/spiral_plant.413e56fb.glb"},function(e,t,n){e.exports=n.p+"static/media/bookcase.aea805c1.glb"},function(e,t,n){e.exports=n.p+"static/media/paintings.7d1b8755.glb"},,,,,,function(e,t,n){e.exports=n(124)},,,,,function(e,t,n){e.exports=n.p+"static/media/lily.28308e22.glb"},function(e,t,n){e.exports=n.p+"static/media/lily.0b5b2d2b.gltf"},function(e,t,n){e.exports=n.p+"static/media/lily-draco.4be61731.gltf"},function(e,t,n){e.exports=n.p+"static/media/pine-tree.688b2ebb.glb"},function(e,t,n){e.exports=n.p+"static/media/pine-tree.044015c2.gltf"},function(e,t,n){e.exports=n.p+"static/media/pine-tree-draco.daefb4bd.gltf"},function(e,t,n){e.exports=n.p+"static/media/landscape.b828c5c9.glb"},function(e,t,n){e.exports=n.p+"static/media/landscape.5137591c.gltf"},function(e,t,n){e.exports=n.p+"static/media/landscape-draco.6e92cff0.gltf"},function(e,t,n){e.exports=n.p+"static/media/swamp.21a17705.glb"},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){var a={"./moonrise/ambient-track.mp3":35,"./moonrise/atmo-crunch[8].mp3":77,"./moonrise/atmo-photay[4].mp3":78,"./moonrise/atmo-swirl[16].mp3":79,"./moonrise/atmo-water[4].mp3":80,"./moonrise/belly-percs[4].mp3":81,"./moonrise/fast-hats[4].mp3":82,"./moonrise/kick-snare[4].mp3":83,"./moonrise/melody-bluesy[8].mp3":84,"./moonrise/melody-soft[8].mp3":85,"./moonrise/melody-trance[4].mp3":86,"./moonrise/rhodes-arps[4].mp3":87,"./moonrise/rhodes-chords[4].mp3":88,"./moonrise/rhodes-sad[8].mp3":89,"./moonrise/rides[4].mp3":90,"./moonrise/sub-bouncey[8].mp3":91,"./moonrise/sub-desc[8].mp3":92,"./moonrise/sub-simple[4].mp3":93,"./moonrise/sub-simple[8].mp3":94,"./mornings/ambient-track.mp3":36,"./mornings/bass-one[8].mp3":95,"./mornings/bass-three[4].mp3":96,"./mornings/bass-two[4].mp3":97,"./mornings/extra-jammy[8].mp3":98,"./mornings/extra-pad[8].mp3":99,"./mornings/extra-sweep[4].mp3":100,"./mornings/harmony-one[4].mp3":101,"./mornings/harmony-three[4].mp3":102,"./mornings/harmony-two[4].mp3":103,"./mornings/melody-one[8].mp3":104,"./mornings/melody-three[4].mp3":105,"./mornings/melody-two[8].mp3":106,"./mornings/rhythm-drums[4].mp3":107,"./mornings/rhythm-kick[8].mp3":108,"./mornings/rhythm-reverse[4].mp3":109,"./mornings/rhythm-tops[8].mp3":110};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id=76},function(e,t,n){e.exports=n.p+"static/media/atmo-crunch[8].3302781f.mp3"},function(e,t,n){e.exports=n.p+"static/media/atmo-photay[4].b5f62d35.mp3"},function(e,t,n){e.exports=n.p+"static/media/atmo-swirl[16].071632ea.mp3"},function(e,t,n){e.exports=n.p+"static/media/atmo-water[4].a3916feb.mp3"},function(e,t,n){e.exports=n.p+"static/media/belly-percs[4].1b33f275.mp3"},function(e,t,n){e.exports=n.p+"static/media/fast-hats[4].d36c7762.mp3"},function(e,t,n){e.exports=n.p+"static/media/kick-snare[4].edf2e08e.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-bluesy[8].517f5198.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-soft[8].9436f5de.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-trance[4].b168cf49.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhodes-arps[4].836e115a.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhodes-chords[4].b93cc73b.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhodes-sad[8].01f304b2.mp3"},function(e,t,n){e.exports=n.p+"static/media/rides[4].3815bc6b.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-bouncey[8].39956256.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-desc[8].89a6665b.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-simple[4].83dfe2b6.mp3"},function(e,t,n){e.exports=n.p+"static/media/sub-simple[8].f2c77397.mp3"},function(e,t,n){e.exports=n.p+"static/media/bass-one[8].9c30c4b5.mp3"},function(e,t,n){e.exports=n.p+"static/media/bass-three[4].50569542.mp3"},function(e,t,n){e.exports=n.p+"static/media/bass-two[4].2f424017.mp3"},function(e,t,n){e.exports=n.p+"static/media/extra-jammy[8].cc3705de.mp3"},function(e,t,n){e.exports=n.p+"static/media/extra-pad[8].2ed7e19c.mp3"},function(e,t,n){e.exports=n.p+"static/media/extra-sweep[4].87dcb5ea.mp3"},function(e,t,n){e.exports=n.p+"static/media/harmony-one[4].aecab5c3.mp3"},function(e,t,n){e.exports=n.p+"static/media/harmony-three[4].d644a18d.mp3"},function(e,t,n){e.exports=n.p+"static/media/harmony-two[4].0320af2e.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-one[8].2ed3dabe.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-three[4].f7d05ab9.mp3"},function(e,t,n){e.exports=n.p+"static/media/melody-two[8].b5530d7d.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-drums[4].643614ec.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-kick[8].27743ea7.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-reverse[4].4257b53e.mp3"},function(e,t,n){e.exports=n.p+"static/media/rhythm-tops[8].dce46e89.mp3"},function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/impulse-response.5ddb346d.wav"},function(e,t,n){},,,,,,function(e,t,n){},function(e,t,n){var a={"./moonrise/ambient-track.mp3":35,"./mornings/ambient-track.mp3":36};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id=120},function(e,t,n){},function(e){e.exports=JSON.parse('[{"id":"moonrise","audio":{"name":"Moonrise","bpm":120,"timeSignature":4,"keySignature":"G Minor","ambientTrack":true,"ambientTrackLength":"8m","groups":[{"name":"rhythm","polyphony":-1,"analyser":{"power":7,"smoothingTimeConstant":0.3,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"kick-snare[4]","length":"4m","quantizeLength":"4m"},{"name":"fast-hats[4]","length":"4m","quantizeLength":"4m"},{"name":"rides[4]","length":"4m","quantizeLength":"4m"},{"name":"belly-percs[4]","length":"4m","quantizeLength":"4m"}]},{"name":"harmony","polyphony":2,"analyser":{"power":9,"smoothingTimeConstant":0.95,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"rhodes-arps[4]","length":"4m","quantizeLength":"4m"},{"name":"rhodes-chords[4]","length":"4m","quantizeLength":"4m"},{"name":"rhodes-sad[8]","length":"8m","quantizeLength":"4m"}]},{"name":"bass","polyphony":1,"analyser":{"power":5,"smoothingTimeConstant":0.85,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"sub-desc[8]","length":"8m","quantizeLength":"4m"},{"name":"sub-simple[8]","length":"8m","quantizeLength":"8m"},{"name":"sub-bouncey[8]","length":"8m","quantizeLength":"4m"}]},{"name":"melody","polyphony":1,"analyser":{"power":5,"minDecibels":-120,"maxDecibels":0,"smoothingTimeConstant":0},"voices":[{"name":"melody-trance[4]","length":"4m","quantizeLength":"4m"},{"name":"melody-bluesy[8]","length":"8m","quantizeLength":"4m"},{"name":"melody-soft[8]","length":"8m","quantizeLength":"4m"}]},{"name":"atmosphere","polyphony":3,"analyser":{"split":true,"power":5,"smoothingTimeConstant":0.4,"minDecibels":-100,"maxDecibels":0},"voices":[{"name":"atmo-water[4]","length":"4m","quantizeLength":"4m"},{"name":"atmo-swirl[16]","length":"16m","quantizeLength":"4m"},{"name":"atmo-crunch[8]","length":"8m","quantizeLength":"4m"},{"name":"atmo-photay[4]","length":"4m","quantizeLength":"4m"}]}]},"themes":{"buttonColor":"rgba(31, 38, 47, 1)","openButtonColor":"rgba(255, 255, 255, 0.15)","contentPanelColor":"rgba(31, 38, 47, 0.65)","panelResetButton":"rgba(255, 255, 255, 0.3)","panelRandomizeButton":"rgba(255, 255, 255, 0.3)","panelMuteButton":"rgba(255, 255, 255, 0.3)","groupSoloButton":"rgba(90.5, 162.2, 240.8, 0.5)","groupMuteButton":"rgba(777.1, 791, 83.6, 0.5)"},"info":{"credits":[{"type":"Music, Art & Development:","content":"Mark Racette"},{"type":"Technology:","content":"React, Three.js, Anime.js, ColorCurves"}]}},{"id":"mornings","audio":{"name":"Mornings","bpm":92,"timeSignature":4,"keySignature":"Eb Major","ambientTrack":true,"ambientTrackLength":"8m","groups":[{"name":"rhythm","polyphony":-1,"analyser":{"power":5,"numBuckets":5,"minFrequency":160,"maxFrequency":13100,"minDecibels":-120,"maxDecibels":-40,"smoothingTimeConstant":0.75},"voices":[{"name":"rhythm-drums[4]","length":"4m","quantizeLength":"4m"},{"name":"rhythm-kick[8]","length":"8m","quantizeLength":"4m"},{"name":"rhythm-reverse[4]","length":"4m","quantizeLength":"4m"},{"name":"rhythm-tops[8]","length":"8m","quantizeLength":"4m"}]},{"name":"harmony","polyphony":2,"analyser":{"power":10,"smoothingTimeConstant":0.95,"minFrequency":115,"maxFrequency":650,"minDecibels":-146,"maxDecibels":-48,"xEasing":"none","yEasing":"polyIn","yExponent":10},"voices":[{"name":"harmony-one[4]","length":"4m","quantizeLength":"4m"},{"name":"harmony-two[4]","length":"4m","quantizeLength":"4m"},{"name":"harmony-three[4]","length":"4m","quantizeLength":"4m"}]},{"name":"bass","polyphony":1,"analyser":{"power":5,"smoothingTimeConstant":0.85},"voices":[{"name":"bass-one[8]","length":"8m","quantizeLength":"4m"},{"name":"bass-two[4]","length":"4m","quantizeLength":"8m"},{"name":"bass-three[4]","length":"4m","quantizeLength":"4m"}]},{"name":"melody","polyphony":1,"analyser":{"power":10,"minFrequency":320,"maxFrequency":1800,"minDecibels":-82,"yEasing":"polyOut","yExponent":2,"numBuckets":32,"smoothingTimeConstant":0.8},"voices":[{"name":"melody-one[8]","length":"8m","quantizeLength":"4m"},{"name":"melody-two[8]","length":"8m","quantizeLength":"4m"},{"name":"melody-three[4]","length":"4m","quantizeLength":"4m"}]},{"name":"extras","polyphony":3,"analyser":{"power":5,"smoothingTimeConstant":0.85},"voices":[{"name":"extra-sweep[4]","length":"4m","quantizeLength":"4m"},{"name":"extra-pad[8]","length":"8m","quantizeLength":"4m"},{"name":"extra-jammy[8]","length":"8m","quantizeLength":"4m"}]}]},"themes":{"buttonColor":"rgba(55, 55, 55, 0.45)","openButtonColor":"rgba(255, 255, 255, 0.15)","contentPanelColor":"rgba(55, 55, 55, 0.45)","contentPanelText":"rgba(0, 0, 0, 1)","panelResetButton":"rgba(255, 255, 255, 0.3)","panelRandomizeButton":"rgba(255, 255, 255, 0.3)","panelMuteButton":"rgba(255, 255, 255, 0.3)","groupSoloButton":"rgba(90.5, 162.2, 240.8, 0.5)","groupMuteButton":"rgba(777.1, 791, 83.6, 0.5)"},"info":{"credits":[{"type":"Music, Art & Development:","content":"Mark Racette"},{"type":"Additional 3D Assets:","content":"Don Carson, Tiff Eidmann, Poly by Google"},{"type":"Paintings:","content":"Kurt Vonnegut, Vincent Van Gogh"},{"type":"Technology:","content":"React, Three.js, Anime.js, ColorCurves"}]}},{"id":"swamp","audio":{"name":"Swamp","bpm":95,"timeSignature":4,"keySignature":"A Minor","ambientTrack":false,"ambientTrackLength":"8m","groups":[]},"themes":{"buttonColor":"rgba(31, 38, 47, 1)","openButtonColor":"rgba(255, 255, 255, 0.15)","contentPanelColor":"rgba(31, 38, 47, 0.65)","panelResetButton":"rgba(255, 255, 255, 0.3)","panelRandomizeButton":"rgba(255, 255, 255, 0.3)","panelMuteButton":"rgba(255, 255, 255, 0.3)","groupSoloButton":"rgba(90.5, 162.2, 240.8, 0.5)","groupMuteButton":"rgba(777.1, 791, 83.6, 0.5)"},"info":{"credits":[]}}]')},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(39),s=n.n(i),o=n(9),c=n(128),l=n(12),u=n(27),m=n(2),h=n(17),d=n(21),p=(r.a.createContext(),r.a.createContext()),f=r.a.createContext(),g=r.a.createContext(),b=r.a.createContext(),y=r.a.createContext(),v=r.a.createContext(),w=(r.a.createContext(),n(3)),E=n(5),x=n(7),k=n(11),j=n(8),M=n(4),C=n(20),L=n(1),O=n(127),D=function(e,t,n,a){var r=Math.pow(a/t,1/(n-e));return{a:t/Math.pow(r,e),b:r}},S=n(6),P=n(40),R=n.n(P),N=n(41),q=function(){function e(t){Object(w.a)(this,e),this.object=t,this.target=new L.tb(0,0,0),this.enabled=!0,this.movementSpeed=200,this.lookSpeed=200,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightLock=!1,this.constrainVertical=!0,this.verticalMin=0,this.verticalMax=Math.PI,this.lat=0,this.lon=-90,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.lookUp=!1,this.lookDown=!1,this.lookLeft=!1,this.lookRight=!1,this._onKeyDown=this.bind(this,this.onKeyDown),this._onKeyUp=this.bind(this,this.onKeyUp),window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1)}return Object(E.a)(e,[{key:"onKeyDown",value:function(e){switch(e.keyCode){case 87:this.moveForward=!0;break;case 65:this.moveLeft=!0;break;case 83:this.moveBackward=!0;break;case 68:this.moveRight=!0;break;case 38:this.lookUp=!0;break;case 37:this.lookLeft=!0;break;case 40:this.lookDown=!0;break;case 39:this.lookRight=!0}}},{key:"onKeyUp",value:function(e){switch(e.keyCode){case 87:this.moveForward=!1;break;case 65:this.moveLeft=!1;break;case 83:this.moveBackward=!1;break;case 68:this.moveRight=!1;break;case 38:this.lookUp=!1;break;case 37:this.lookLeft=!1;break;case 40:this.lookDown=!1;break;case 39:this.lookRight=!1}}},{key:"update",value:function(e,t){if(!1!==this.enabled){var n=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-n),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.heightLock&&(this.object.position.y=t||1);var a=e*this.lookSpeed;this.lookUp&&(this.lat+=a),this.lookDown&&(this.lat-=a),this.lookRight&&(this.lon+=a),this.lookLeft&&(this.lon-=a),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=L.H.degToRad(90-this.lat),this.theta=L.H.degToRad(this.lon),this.constrainVertical&&(this.phi=L.H.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var r=this.target,i=this.object.position;r.x=i.x+100*Math.sin(this.phi)*Math.cos(this.theta),r.y=i.y+100*Math.cos(this.phi),r.z=i.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(r)}}},{key:"dispose",value:function(){window.removeEventListener("keydown",this._onKeyDown,!1),window.removeEventListener("keyup",this._onKeyUp,!1)}},{key:"bind",value:function(e,t){return function(){t.apply(e,arguments)}}}]),e}(),z=function(){function e(t){Object(w.a)(this,e),this.canvas=t,this.clock=new L.i(!0),this.screenDimensions={width:window.innerWidth,height:window.innerHeight},this.worldDimensions={width:1e3,height:1e3,depth:1e3},this.pauseVisuals=!1,this.animate=this.animate.bind(this),this.render=this.render.bind(this),this.onWindowResize=this.onWindowResize.bind(this),this.showStats=!1}return Object(E.a)(e,[{key:"init",value:function(){var e=this;return new Promise((function(t,n){try{e.scene=e.initScene(),e.renderer=e.initRender(),e.camera=e.initCamera("perspective"),e.controls=e.initControls(),e.subjects=e.initSubjects(),e.lights=e.initLights(),e.helpers=e.initHelpers(),t()}catch(a){n(a)}}))}},{key:"stop",value:function(){window.cancelAnimationFrame(this.currentFrame)}},{key:"applyAll",value:function(e,t,n){var a=this;e.children.forEach((function(e){e.children.length>0?a.applyAll(e,t,n):n.find((function(t){return e.name.includes(t)}))||t(e)}))}},{key:"disposeAll",value:function(e){for(;e.children.length>0;)this.disposeAll(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach((function(t){e.material[t]&&"function"===typeof e.material[t].dispose&&e.material[t].dispose()})),e.material.dispose())}},{key:"animate",value:function(){this.showStats&&this.helpers.stats.begin(),this.render(),this.showStats&&this.helpers.stats.end(),this.currentFrame=requestAnimationFrame(this.animate)}},{key:"initScene",value:function(){return new L.fb}},{key:"initRender",value:function(){var e=new L.wb({alpha:!0,autoClear:!1,canvas:this.canvas,antialias:!0,outputEncoding:L.xb}),t=Math.min(this.DPRMax||1.5,window.devicePixelRatio?window.devicePixelRatio:1);return e.setPixelRatio(t),e.setSize(this.screenDimensions.width,this.screenDimensions.height),e}},{key:"initCamera",value:function(e,t){var n,a=this.screenDimensions.width/this.screenDimensions.height;switch(e||"perspective"){case"perspective":n=new L.V(60,1,1,1e4);break;case"orthographic":var r=t||50;n=new L.T(-r,r,r/a,-r/a,1,1e4)}return n.aspect=a,n.position.set(0,10,115),n.lookAt(new L.tb(0,0,0)),n.updateProjectionMatrix(),n}},{key:"initControls",value:function(){var e={};return e.fpc=new q(this.camera),e}},{key:"initSubjects",value:function(){return{}}},{key:"initLights",value:function(){var e={ambient:new L.a(16777215,.1)};this.scene.add(e.ambient),this.lights=e}},{key:"initHelpers",value:function(){var e=null;return this.showStats&&((e=new R.a).showPanel(0),e.dom.style.left=null,e.dom.style.right="0px",document.body.appendChild(e.dom)),{stats:e,gltfLoader:new N.a}}},{key:"onWindowResize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.screenDimensions.width=e,this.screenDimensions.height=t;var n=e/t;this.fovAdjust&&(this.camera.fov=this.getNewFov(n)),this.camera.aspect=n,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.render(!0)}},{key:"loadModel",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.name,r=n.format;n.index;return e="glb"===r?".glb":".gltf",new Promise((function(n,i){var s;s="https://soundscape-public.s3.us-east-2.amazonaws.com/app/models/".concat(t.songId,"/").concat(r,"/").concat(a).concat(e),t.helpers.gltfLoader.load(s,(function(e){return n(e)}),null,(function(e){return i(e)}))}))}}]),e}(),A=function(){function e(t,n,a,r){Object(w.a)(this,e),this.levels=n,this.colorPalette=r.colorPalette,this.width=r.width,this.height=r.height,this.depth=r.depth,this.center=r.center,this.leftGroup=new L.r,this.rightGroup=new L.r,this.group=new L.r;for(var i=0;i<n;i++)this.createStars(r.count,"left",i,a),this.createStars(r.count,"right",i,a);this.group.add(this.leftGroup),this.group.add(this.rightGroup),this.group.position.copy(r.center),t.add(this.group)}return Object(E.a)(e,[{key:"createStars",value:function(e,t,n,a){for(var r,i=new L.f,s=[],o=[],c=0;c<e;c++){var l=("left"===t?this.width/-2*1.35:this.width/2*1.35)*Math.random(),u=n*this.height/this.levels+Math.random()*(this.height/this.levels),m=this.depth*Math.random();s.push(l,u,m),r=new L.j(this.colorPalette(u/this.height));var h=Math.sqrt(l*l+(u-15)*(u-15));r.lerp(a,1/(h/75)),o.push(r.r,r.g,r.b)}i.addAttribute("position",new L.o(s,3)),i.addAttribute("color",new L.o(o,3)),i.setDrawRange(0,e);var d=new L.Z({vertexColors:L.vb,transparent:!0,opacity:0,fog:!1});"left"===t?this.leftGroup.add(new L.Y(i,d)):this.rightGroup.add(new L.Y(i,d))}}]),e}(),B={glb:n(58),gltf:n(59),draco:n(60)},I={glb:n(61),gltf:n(62),draco:n(63)},F={glb:n(64),gltf:n(65),draco:n(66)},T={glb:n(67)},W=function(e){function t(e,n,a,r){var i;return Object(w.a)(this,t),(i=Object(x.a)(this,Object(M.a)(t).call(this,e))).songId="moonrise",i.DPRMax=2.5,i.rhythmAnalyser=n.find((function(e){return"rhythm-analyser"===e.id})),i.atmosphereAnalyser=n.find((function(e){return"atmosphere-analyser"===e.id})),i.harmonyAnalyser=n.find((function(e){return"harmony-analyser"===e.id})),i.melodyAnalyser=n.find((function(e){return"melody-analyser"===e.id})),i.bassAnalyser=n.find((function(e){return"bass-analyser"===e.id})),i.palette={white:16777215,rockGrey:10327950,lightning:15656619,moonYellow:16184021,tropicalGreen:7382161,deepInk:199714},i.prevMelodyVolume=0,i.currentMelodyVolume=0,i.lilyColors=[i.palette.dustyViolet,i.palette.pansyPurple,i.palette.funGreen,i.palette.hibiscus,i.palette.yellow],Object(C.a)(Object(M.a)(t.prototype),"init",Object(k.a)(i)).call(Object(k.a)(i)).then((function(){window.addEventListener("resize",(function(){i.onWindowResize(window.innerWidth,window.innerHeight)})),i.scene.fog=new L.p(16777215,10,470),i.scene.background=new L.j("#1F262F").lerp(new L.j(0),.2),Promise.all([i.initLakeTrees(),i.initLakeScene(),i.initLakeRipples(),i.initLakeStars(),i.initLakeLilies(),i.initLakeMoon()]).then((function(){a(),Object(C.a)(Object(M.a)(t.prototype),"animate",Object(k.a)(i)).call(Object(k.a)(i))}))})),i}return Object(j.a)(t,e),Object(E.a)(t,[{key:"initLakeScene",value:function(){var e=this;return new Promise((function(t,n){try{for(var a=Object(S.f)(6,110,0,0,!0,!1,!0),r=[],i=0;i<a.length;i+=2)r.push(new L.sb(a[i],a[i+1]));var s=new L.ib(r),o=new L.jb(s);o.rotateX(-Math.PI/2),o.translate(0,0,70);var c=new L.K({color:e.palette.deepInk,fog:!1}),l=new L.J(o,c);e.subjects.lake=l,e.scene.add(l);var u=new L.W(550,350);u.rotateX(-Math.PI/2),u.translate(0,-1,0);var m=new L.K({color:141854,fog:!1});m.color.lerp(new L.j(0),.75);var h=new L.J(u,m);e.subjects.ground=h,e.scene.add(h);var d=new L.J(new L.W(60,30),m);d.translateZ(-79),e.scene.add(d);var p=new L.l(16777215,.18);p.position.set(0,10,0),e.scene.add(p);for(var f=new L.r,g=0;g<16;g++){var b=new L.r;b.add(new L.X(e.palette.moonYellow,.1));var y=new L.mb(.25),v=new L.K({color:e.palette.lightning,fog:!1,transparent:!0});b.add(new L.J(y,v)),b.position.set(140*Math.random()-70,5+15*Math.random(),40-70*Math.random()),b.userData.cycle=0,b.userData.state="off",f.add(b)}e.subjects.fireflies=f,e.scene.add(f),e.loadModel({name:"landscape",index:F,format:"glb"}).then((function(t){e.subjects.rocks=t.scene.children.find((function(e){return e.name="rockGroup"})),e.subjects.rocks.children.forEach((function(e){e.material.color.setRGB(.06,.06,.06)})),e.scene.add(e.subjects.rocks)})).catch((function(e){n(e)})),t()}catch(w){n(w)}}))}},{key:"initLakeMoon",value:function(){var e=this;return new Promise((function(t,n){try{var a=e.bassAnalyser.fftSize,r=new L.g(25,a,a),i=new L.K({color:e.palette.moonYellow,fog:!1}),s=new L.J(r,i);s.userData.radius=25,s.position.set(0,35,-80),e.subjects.moon=s,e.scene.add(s);for(var o=new L.r,c=new L.r,l=0;l<5;l++){var u=new L.f,m=new Float32Array(3*a);u.addAttribute("position",new L.e(m,3)),u.setDrawRange(0,0);var h=new L.Z({color:e.palette.moonYellow,transparent:!0,opacity:.1+l/7}),d=new L.Y(u,h);o.add(d)}for(var p=0;p<8;p++){var f=o.clone();f.translateY(s.position.y),f.rotateZ(2*Math.PI*(p/16)),c.add(f)}e.subjects.moonBeams=c,e.subjects.moonBeams.userData.numMoonRings=5,e.subjects.moonBeams.userData.numVertices=a,e.scene.add(c),t()}catch(g){n(g)}}))}},{key:"initLakeTrees",value:function(){var e=this;return new Promise((function(t,n){e.loadModel({name:"pine-tree",index:I,format:"glb"}).then((function(n){console.log(n);for(var a=n.scenes[0].children[0],r=new L.r,i=1;i<=64;i++){var s=i/64*200-100+(5*Math.random()-2.5),o=void 0;s<-55?o=-1*(95/55*s+190)-10*Math.random():s>=-55&&s<55?o=-95-10*Math.random():s>=55&&(o=-1*(-95/55*s+190)-10*Math.random());var c=a.clone(),l=1-.3*Math.random();c.children[0].material=new L.K({color:new L.j(e.palette.tropicalGreen).lerp(new L.j(e.palette.white),-1.5)}),c.position.copy(new L.tb(s,-2,o+70)),c.scale.copy(new L.tb(l,l,l)),c.rotateY(2*Math.random()*Math.PI),r.add(c)}e.subjects.pineTrees=r,e.scene.add(r),t()})).catch((function(e){n(e)}))}))}},{key:"initLakeRipples",value:function(){var e=this;return new Promise((function(t,n){try{var a=e.rhythmAnalyser.frequencyBinCount,r=Object(S.f)(6,1,0,0,!0,!0),i=function(e){var t=Math.log(1/e)/(1-e);return{a:e/Math.exp(t*e),b:t}}(100),s=new L.r,o=new L.f;o.addAttribute("position",new L.e(r,3));for(var c=0;c<a;c++){var l=o.clone(),u=1+c/a*100,m=Math.log(u/i.a)/i.b;l.scale(m,m,m),l.translate(0,.05,50),s.add(new L.x(l,new L.y({color:e.palette.moonYellow,transparent:!0,opacity:0})))}e.subjects.ripples=s,e.scene.add(s),t()}catch(h){n(h)}}))}},{key:"initLakeStars",value:function(){var e=this;return new Promise((function(t,n){try{e.subjects.stars=new A(e.scene,8,e.scene.background,{count:150,width:600,height:225,depth:190,center:new L.tb(0,-13,-300),colorPalette:O.a}),t()}catch(a){n(a)}}))}},{key:"initLakeLilies",value:function(){var e=this;return new Promise((function(t,n){e.loadModel({name:"lily",index:B,format:"glb"}).then((function(n){var a=n.scene.children.find((function(e){return"Group"===e.name})),r=a.children[0].clone(),i=a.children[1].clone(),s=a.children[2].clone();s.name="sphere";var o=a.children[3].clone();o.name="lilyPad";var l=new L.r,u=new L.r;u.name="petalGroup";for(var m=0;m<18;m++){var h=(new L.r).add(i.clone());h.rotateY(2*Math.PI*(m/8));var d=(new L.r).add(r.clone());d.rotateY(2*Math.PI*(m/8)),u.add(h),u.add(d)}l.add(u,s,o);for(var p=new L.r,f=new L.K({color:new L.j(16777215)}),g=new L.K({color:new L.j(141854).lerp(new L.j(0),1)}),b=function(e){var t=l.clone(),n=new L.j(c.a(Math.random())),a=new L.K({color:n});t.getObjectByName("petalGroup").children.forEach((function(e){e.children[0].material=a})),t.getObjectByName("lilyPad").material=g,t.getObjectByName("sphere").material=f;var r=e%4+1,i=Math.floor(e/4)%4,s=Math.max(2*Math.random(),1.4),o=r/1.3*(7*i-10.5);o*=.2*Math.random()-.2+1;var u=102-e%4/3*18-Math.random()*(10-15*Math.floor(i/2));t.userData.petalColor=n,t.userData.ignited=!1,t.userData.phase="waxing",t.userData.measure=0,t.scale.copy(new L.tb(s,s,s)),t.position.copy(new L.tb(o,1,u)),p.add(t)},y=1;y<=23;y++)b(y);e.subjects.lilies=p,e.scene.add(p),t()})).catch((function(e){n(e)}))}))}},{key:"render",value:function(e){var t=this;if(!this.pauseVisuals||e){if(this.playerState.rhythm&&(this.rhythmAnalyser.getFrequencyData(),this.rhythmAnalyser.fftData.forEach((function(e,n){var a=n/t.rhythmAnalyser.frequencyBinCount*180;t.subjects.ripples.children[n].material.opacity=(e-a)/500}))),this.playerState.atmosphere&&(this.atmosphereAnalyser.getFrequencyData("left"),this.atmosphereAnalyser.getFrequencyData("right"),this.atmosphereAnalyser.fftData.left.slice(1,9).forEach((function(e,n){t.subjects.stars.leftGroup.children[n].material.opacity=e/125})),this.atmosphereAnalyser.fftData.right.slice(1,9).forEach((function(e,n){t.subjects.stars.rightGroup.children[n].material.opacity=e/125}))),this.playerState.harmony&&(this.harmonyAnalyser.getFrequencyData(),this.subjects.pineTrees.children.forEach((function(e,n){var a=Math.floor(n/8),r=t.harmonyAnalyser.fftData.slice([1+a])[0],i=Math.pow(r,5)/(.06*Math.pow(255,5)),s=new L.j(t.palette.tropicalGreen);s.lerp(new L.j(t.palette.white),-1.5+i),e.children[0].material.color.set(s)}))),this.playerState.bass){this.bassAnalyser.getFrequencyData();for(var n=this.bassAnalyser.fftData.reduce((function(e,t){return e+t}))/this.bassAnalyser.frequencyBinCount,a=this.bassAnalyser.fftData.slice(0,this.subjects.moonBeams.userData.numMoonRings),r=.5*this.subjects.moon.userData.radius,i=0;i<this.subjects.moonBeams.userData.numMoonRings;i++)for(var s=0;s<this.subjects.moonBeams.userData.numVertices;s++){var o=1/(.15*(i+1)),c=a[i]/255,l=this.subjects.moonBeams.children[0].children[i];l.geometry.attributes.position.array[3*s]=(r-7+n/3*o)*Math.cos(2*Math.PI*(s/this.bassAnalyser.fftSize+c/12)),l.geometry.attributes.position.array[3*s+1]=(r-7+n/3*o)*Math.sin(2*Math.PI*(s/this.bassAnalyser.fftSize+c/6)),l.geometry.attributes.position.array[3*s+2]=-81}this.subjects.moonBeams.children.forEach((function(e){e.children.forEach((function(e,n){e.geometry.attributes.position.array=t.subjects.moonBeams.children[0].children[n].geometry.attributes.position.array,e.geometry.setDrawRange(0,e.geometry.attributes.position.count),e.geometry.attributes.position.needsUpdate=!0}))}))}if(this.playerState.melody){this.melodyAnalyser.getFrequencyData();for(var u=0,m=0,h=0;h<this.melodyAnalyser.fftData.length;h++)u+=this.melodyAnalyser.fftData[h],m++;var d=u/m;this.subjects.lilies.children.forEach((function(e){var t=e.userData;!t.ignited&&0!==d&d*Math.random()>55&&(t.ignited=!0),t.ignited&&"waxing"===t.phase&&t.measure<1?t.measure=Math.min(2,t.measure+7.7):t.ignited&&"waxing"===t.phase&&t.measure>1?(t.phase="waning",t.measure+=-.11):t.ignited&&"waning"===t.phase&&t.measure<0?(t.ignited=!1,t.phase="waxing"):t.ignited&&"waning"===t.phase&&(t.measure+=-.11),e.getObjectByName("petalGroup").children[0].children[0].material.color=e.userData.petalColor.clone().lerp(new L.j(16777215),Math.max(0,d/105*t.measure))})),this.prevMelodyVolume=d}this.subjects.fireflies.children.forEach((function(e){if("off"===e.userData.state&&Math.random()<5e-4&&(e.userData.state="lighting",e.userData.flightPath=new L.tb(-.5+Math.random(),-.5+Math.random(),-.5+Math.random())),"lighting"===e.userData.state&&(e.userData.cycle+=.1,e.userData.cycle>=1&&(e.userData.state="dimming")),"dimming"===e.userData.state&&(e.userData.cycle-=.025,e.userData.cycle<=0&&(e.userData.state="off")),"dimming"===e.userData.state||"lighting"===e.userData.state){var t=Math.min(Math.max(e.position.x+.3*(e.userData.flightPath.x+.005),-70),140),n=Math.min(Math.max(e.position.y+.3*(e.userData.flightPath.x+.005),5),20),a=Math.min(Math.max(e.position.z+.3*(e.userData.flightPath.x+.005),-20),70);e.position.set(t,n,a)}e.children[0].intensity=e.userData.cycle/2,e.children[1].material.opacity=e.userData.cycle})),this.renderer.render(this.scene,this.camera)}}}]),t}(z),V=n(42),_=n.n(V),H=n(43),G=n.n(H),U=n(44),Q=n.n(U),K=n(45),Y=n.n(K),X=n(46),J=n.n(X),Z=n(47),$=n.n(Z),ee=n(125),te=Object(S.c)(2,.2,.3),ne=new L.j(3355443),ae=Object(S.c)(4,.4,1),re=Object(S.c)(4,0,2,0,0,!0),ie=function(e){function t(e,n,a,r){var i;return Object(w.a)(this,t),(i=Object(x.a)(this,Object(M.a)(t).call(this,e))).canvas.style="\n            background-color: none; background: \n            linear-gradient(\n                to top, \n                #F0A9B3 45%, \n                #D8B7B6 55%,\n                #BEBDC3 70%,\n                #A1BCD4 85%,\n                #80BDE8 100%\n            );\n        ",i.DPRMax=2.25,i.spectrumFunction=r.spectrumFunction,i.songId="mornings",i.colors={morningLight:new L.j(15772083),plant:new L.j(8101459),white:new L.j(16777215),paleBlue:new L.j(14610175),coffee:new L.j(2493952),deepBlue:new L.j(2175064),blueGrey:new L.j(11579830)},i.renderList=["house","plant","table","bookshelf","flower"],i.bpm=r.bpm,i.rhythmAnalyser=n.find((function(e){return"rhythm-analyser"===e.id})),i.atmosphereAnalyser=n.find((function(e){return"extras-analyser"===e.id})),i.harmonyAnalyser=n.find((function(e){return"harmony-analyser"===e.id})),i.melodyAnalyser=n.find((function(e){return"melody-analyser"===e.id})),i.bassAnalyser=n.find((function(e){return"bass-analyser"===e.id})),i.fovAdjust=!0,i.fpcControl=!1,Promise.all([Object(C.a)(Object(M.a)(t.prototype),"init",Object(k.a)(i)).call(Object(k.a)(i)),i.loadModels(i.renderList)]).then((function(){a(),i.applySceneSettings(),i.render(i.renderList),i.applyAll(i.scene,(function(e){if(e.matrixAutoUpdates=!1,e.material&&"MeshStandardMaterial"===e.material.type){var t=new L.L({color:e.material.color,side:L.m,emissive:e.material.emissive,emissiveIntensity:e.material.emissiveIntensity});e.material.dispose(),e.material=t}}),["steam","van_gogh","vonnegut","carpet","god_rays_top","god_rays_bottom"]),Object(C.a)(Object(M.a)(t.prototype),"animate",Object(k.a)(i)).call(Object(k.a)(i))})).catch((function(e){console.log(e)})),i}return Object(j.a)(t,e),Object(E.a)(t,[{key:"applySceneSettings",value:function(){this.renderer.shadowMap.enabled=!1,this.renderer.shadowMap.type=L.U,this.renderer.setClearColor(0,0),this.camera.position.set(-36.792147432025736,12.295984744079584,19.50565058881036),this.camera.lookAt(46.69487932551039,2.382592629313793,-34.638979984916375),this.camera.fov=this.getNewFov(window.innerWidth/window.innerHeight),this.camera.updateProjectionMatrix()}},{key:"getNewFov",value:function(e){return 50-25*(Math.max(.5,Math.min(e,3))-.5)/2.5}},{key:"initControls",value:function(){var e={};return this.fpcControl&&(e.fpc=new q(this.camera)),e}},{key:"initScene",value:function(){return new L.fb}},{key:"initLights",value:function(){var e={ambient:new L.a(this.colors.morningLight.clone().lerp(this.colors.white,.65),.35),sunlight:new L.l(this.colors.white,0),pointOne:new L.X(16777215,.1)};return e.pointOne.position.set(-36.792147432025736,12.295984744079584,19.50565058881036),this.scene.add(e.ambient),this.scene.add(e.sunlight),this.scene.add(e.sunlight.target),this.scene.add(e.pointOne),e}},{key:"loadModels",value:function(e){var t=this;return new Promise((function(n,a){var r=[];-1!==e.indexOf("house")&&r.push(new Promise((function(e,n){t.subjects.stringLights=[],t.subjects.godRays=[],t.helpers.gltfLoader.load(_.a,(function(n){n.scene.children.forEach((function(e){"Group"===e.type&&e.name.includes("string_light")&&(e.children[1].material.emissive=e.children[1].material.color,t.subjects.stringLights.push(e.children[1])),"bushes"===e.name&&(e.material.emissive=e.material.color,e.material.emissiveIntensity=.5),"god_rays_top"!==e.name&&"god_rays_bottom"!==e.name||(e.material=new L.K({color:t.colors.white,transparent:!0,side:L.m,opacity:.025}),t.subjects.godRays.push(e))})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("house")&&r.push(new Promise((function(e,n){t.helpers.gltfLoader.load($.a,(function(n){n.scene.children.forEach((function(e){"vonnegut_self_portrait"===e.name&&(e.material.side=L.q),"van_gogh"===e.name&&(e.material.side=L.c)})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("table")&&r.push(new Promise((function(e,n){t.helpers.gltfLoader.load(G.a,(function(n){var a=new L.W(1.9,1.8,64,64);a.rotateX(-Math.PI/2),n.scene.children.forEach((function(e){if(e.name.includes("mug_coffee")&&(e.material=new L.K({color:t.colors.coffee})),e.name.includes("mug_top")&&(e.material.color=new L.j(6710886)),"left_page_ref"===e.name||"right_page_ref"===e.name){var n=new Array(4*a.attributes.position.count),r=e.clone();r.geometry=a.clone(),r.geometry.addAttribute("customColor",new L.o(n,4)),r.material=new L.hb({transparent:!0,side:L.m,vertexShader:"\n    attribute vec4 customColor;\n    varying vec4 vColor;\n    void main() {\n        vColor = customColor;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n    }\n",fragmentShader:"\n    varying vec4 vColor;\n    void main() {\n        gl_FragColor = vColor;\n    }\n",vertexColors:L.vb}),t.scene.add(r),"right_page_ref"===e.name&&(t.subjects.rightPage=r),"left_page_ref"===e.name&&(t.subjects.leftPage=r)}"steam"===e.name&&(e.material=new L.K({color:t.colors.white,transparent:!0,side:L.m,opacity:.025}),t.subjects.steam=e)})),n.scene.children.filter((function(e){return e.name.includes("page")})).forEach((function(e){return n.scene.remove(e)})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("flower")&&r.push(new Promise((function(e,n){var a=[],r=[];t.subjects.innerPetals=[],t.subjects.outerPetals=[],t.helpers.gltfLoader.load(Q.a,(function(n){n.scene.children.forEach((function(e){e.name.includes("Inner_Petals")&&(e.material.emissive=e.material.color,e.material.emissiveIntensity=0,t.subjects.innerPetals.push(e)),e.name.includes("Outer_Petals")&&(e.material.emissive=e.material.color,e.material.emissiveIntensity=0,t.subjects.outerPetals.push(e)),e.name.includes("stick_leaves_one")?(e.material=new L.L({color:t.colors.plant,emissive:t.colors.plant,emissiveIntensity:0}),r.push(e)):e.name.includes("stick_leaves")&&(e.material=new L.L({color:t.colors.plant,emissive:t.colors.plant,emissiveIntensity:0}),a.push(e))})),t.subjects.stickLeaves=a,t.subjects.stickLeavesOne=r,t.scene.add(n.scene),e()}),null,(function(){return n()}))}))),-1!==e.indexOf("plant")&&r.push(new Promise((function(e,n){t.helpers.gltfLoader.load(Y.a,(function(n){var a=[];n.scene.children.filter((function(e){return e.name.includes("spiral_plant_leaf")})).forEach((function(e){e.material=new L.L({color:t.colors.plant,emissive:t.colors.plant,emissiveIntensity:0}),a.push(e)})),t.subjects.spiralPlantLeaves=a,t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),-1!==e.indexOf("bookshelf")&&r.push(new Promise((function(e,n){t.subjects.books=new Array(4).fill(null).map((function(e){return new Array(5).fill(null).map((function(e){return[]}))})),t.helpers.gltfLoader.load(J.a,(function(n){var a=new L.L({color:15194826,side:L.m});n.scene.children.forEach((function(e){if(e.name.includes("book")&&!e.name.includes("bookcase")&&"Group"===e.type){var n=e.name,r=parseInt(n.slice(n.length-1,n.length)),i=parseInt(n.slice(n.length-2,n.length-1)),s=parseInt(n.slice(n.length-3,n.length-2)),o=.2*Math.random()-.1,c=new L.j(t.spectrumFunction(1-(o+i+.5)/5)),l=e.children.find((function(e){return e.material.name.includes("book")}));e.children.find((function(e){return e.material.name.includes("page")})).material=a,l.material=new L.L({color:c,side:L.m,emissive:c,emissiveIntensity:.1}),t.subjects.books[s][i][r]=l}})),t.scene.add(n.scene),e()}),null,(function(e){return n(e)}))}))),Promise.all(r).then((function(){n()})).catch((function(e){a("Error loading models: ".concat(e))}))}))}},{key:"render",value:function(e){this.pauseVisuals&&!e||(this.elapsedBeats=this.bpm*this.clock.getElapsedTime()/60,this.fpcControl&&this.controls.fpc.update(this.clock.getDelta()),this.subjects.steam.rotateY(-.05),(this.playerState.melody||e)&&function(e,t,n){t.getFrequencyData();for(var a=t.fftData.reduce((function(e,t){return e+t}))/t.fftData.length/255,r=e.leftPage.geometry.attributes.customColor,i=e.rightPage.geometry.attributes.customColor,s=0,o=r.count;s<o;s++){var c=s%65,l=Math.floor(s/65),u=ae(n.beats-l/65*(c/65)*4),m=ne.clone().lerp(new L.j(n.spectrumFunction(1-c/65)),t.fftData[Math.ceil(c)]/255);c%4===0?(r.array[4*s]=m.r,r.array[4*s+1]=m.g,r.array[4*s+2]=m.b,r.array[4*s+3]=1*u):(r.array[4*s]=m.r,r.array[4*s+1]=m.g,r.array[4*s+2]=m.b,r.array[4*s+3]=0),c%4===0?(i.array[4*s]=m.r,i.array[4*s+1]=m.g,i.array[4*s+2]=m.b,i.array[4*s+3]=1*u):(i.array[4*s]=m.r,i.array[4*s+1]=m.g,i.array[4*s+2]=m.b,i.array[4*s+3]=0)}r.needsUpdate=!0,i.needsUpdate=!0;for(var h=0;h<e.innerPetals.length;h++){e.innerPetals[h].material.emissiveIntensity=5*a}for(var d=0;d<e.outerPetals.length;d++){e.outerPetals[d].material.emissiveIntensity=5*a}}({innerPetals:this.subjects.innerPetals,outerPetals:this.subjects.outerPetals,leftPage:this.subjects.leftPage,rightPage:this.subjects.rightPage},this.melodyAnalyser,{spectrumFunction:this.spectrumFunction,beats:this.elapsedBeats}),(this.playerState.bass||e)&&function(e,t,n){var a=0;t.getFrequencyData();for(var r=0,i=t.frequencyBinCount;r<i;r++)a+=t.fftData[r];var s=ee.a(3e-4*a);e[0].material.opacity=.025+.125*s,e[1].material.opacity=.025+.125*s,n.sunlight.intensity=.25+s*(.7-.25)}(this.subjects.godRays,this.bassAnalyser,{sunlight:this.lights.sunlight}),(this.playerState.rhythm||e)&&function(e,t,n){t.getFrequencyBuckets();for(var a=0;a<e.length;a++)for(var r=e[a],i=0;i<r.length;i++)for(var s=r[i],o=0;o<s.length;o++){var c=(a+o)%4/4,l=te(n.beats+2*c/4);s[o].material.emissiveIntensity=l*t.bucketData[i]/255}}(this.subjects.books,this.rhythmAnalyser,{spectrumFunction:this.spectrumFunction,beats:this.elapsedBeats}),(this.playerState.harmony||e)&&function(e,t,n){t.getFrequencyData();for(var a=0;a<e.leaves.length;a++){var r=t.binMin+Math.round(a/e.leaves.length*(t.binMax-t.binMin));e.leaves[a].material.emissiveIntensity=t.fftData[r]/255}for(var i=0;i<e.stickLeaves.length;i++){var s=t.binMin+Math.round(i/e.stickLeaves.length*(t.binMax-t.binMin));e.stickLeaves[i].material.emissiveIntensity=t.fftData[s]/255}for(var o=0;o<e.stickLeavesOne.length;o++){var c=t.binMin+Math.round(o/e.stickLeavesOne.length*(t.binMax-t.binMin));e.stickLeavesOne[o].material.emissiveIntensity=t.fftData[c]/255}}({leaves:this.subjects.spiralPlantLeaves,stickLeaves:this.subjects.stickLeaves,stickLeavesOne:this.subjects.stickLeavesOne,group:this.subjects.spiralPlantGroup,box:this.subjects.spiralPlantBox},this.harmonyAnalyser,this.elapsedBeats),(this.playerState.extras||e)&&function(e,t,n){for(var a=0;a<e.length;a++){var r=a%e.length*4/e.length;e[a].material.emissiveIntensity=re(-n.beats+r)*(n.enabled?.25:0)}}(this.subjects.stringLights,this.atmosphereAnalyser,{beats:this.elapsedBeats,enabled:this.playerState.extras}),this.renderer.render(this.scene,this.camera))}}]),t}(z),se=function(e){function t(e,n,a,r){var i;return Object(w.a)(this,t),(i=Object(x.a)(this,Object(M.a)(t).call(this,e))).DPRMax=5,i.songId="swamp",i.fovAdjust=!0,i.fpcControl=!0,i.renderList=["swamp"],Promise.all([Object(C.a)(Object(M.a)(t.prototype),"init",Object(k.a)(i)).call(Object(k.a)(i)),i.loadModels(i.renderList)]).then((function(){a(),i.applySceneSettings(),Object(C.a)(Object(M.a)(t.prototype),"animate",Object(k.a)(i)).call(Object(k.a)(i))})).catch((function(e){console.log(e)})),i}return Object(j.a)(t,e),Object(E.a)(t,[{key:"applySceneSettings",value:function(){this.renderer.outputEncoding=L.xb,this.renderer.physicallyCorrectLights=!0,this.renderer.setClearColor(0,0),this.onWindowResize()}},{key:"getNewFov",value:function(e){return 50-25*(Math.max(.5,Math.min(e,3))-.5)/2.5}},{key:"initControls",value:function(){var e={};return this.fpcControl&&(e.fpc=new q(this.camera)),e}},{key:"initScene",value:function(){return new L.fb}},{key:"initLights",value:function(){}},{key:"loadModels",value:function(e){var t=this;return new Promise((function(n,a){var r=[];-1!==e.indexOf("swamp")&&r.push(new Promise((function(e,n){t.loadModel({name:"swamp",index:T,format:"glb"}).then((function(n){console.log(n),t.scene.add(n.scene),t.camera=n.cameras[0],e()}))}))),Promise.all(r).then((function(){n()})).catch((function(e){a("Error loading models: ".concat(e))}))}))}},{key:"render",value:function(e){this.controls.fpc.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera)}}]),t}(z),oe=function(e){var t=r.a.useRef(null);return r.a.useEffect((function(){var n="undefined"!==typeof document?window.devicePixelRatio:1,a=function(){0!==t.current.clientWidth&&(t.current.width=n*t.current.clientWidth),e.makeSquare?0!==t.current.clientHeight&&(t.current.height=n*t.current.clientWidth):0!==t.current.clientHeight&&(t.current.height=n*t.current.clientHeight),!1!==e.resize&&void 0!==e.onResize&&e.onResize(t.current)};return a(),!1!==e.resize&&window.addEventListener("resize",a),void 0!==e.onLoad&&e.onLoad(t.current),function(){return!1!==e.resize&&window.removeEventListener("resize",a)}}),[e]),r.a.createElement("canvas",{id:e.id,className:e.className,ref:t})};n(23);function ce(e){var t=r.a.useRef(null),n=r.a.useRef(),a=r.a.useRef(0),i=r.a.useRef(0),s=r.a.useRef(),o=r.a.useRef(),c=e.animate,l=e.id,u=e.listen,m=e.setCustomStyles,h=e.dispatch;return r.a.useEffect((function(){var r=function e(t,r,l){var u=l?0:t-i.current;a.current+=.001*u,i.current=t,n.current.clearRect(o.current.nx(-1),o.current.ny(-1),o.current.getWidth(),o.current.getHeight()),c(n.current,a.current,o.current),r&&(s.current=window.requestAnimationFrame((function(t){return e(t,!0)})))},l=function(){return h({type:e.name})},d=function(){return h({type:null})},p=function(){n.current.lineWidth=o.current.getWidth()/128,n.current.strokeStyle="#f6f2d5",n.current.fillStyle="#f6f2d5",m&&m(n.current)},f=function(){p(),s.current=window.requestAnimationFrame((function(e){return r(e,!0,!0)}))},g=function(){window.cancelAnimationFrame(s.current)};return u&&(t.current.addEventListener("touchstart",f),t.current.addEventListener("touchstart",l),t.current.addEventListener("touchstart",g),t.current.addEventListener("touchstart",d),t.current.addEventListener("mouseover",f),t.current.addEventListener("mouseover",l),t.current.addEventListener("mouseout",g),t.current.addEventListener("mouseout",d)),o.current=new S.a({canvas:t.current,padding:.02}),n.current=t.current.getContext("2d"),p(),r(0,!1,!1),u||f(),function(){g(),u&&(t.current.removeEventListener("touchstart",f),t.current.removeEventListener("touchstart",l),t.current.removeEventListener("touchstart",g),t.current.removeEventListener("touchstart",d),t.current.removeEventListener("mouseover",f),t.current.removeEventListener("mouseover",l),t.current.removeEventListener("mouseout",g),t.current.removeEventListener("mouseout",d))}}),[h,e.name,c,u,m]),r.a.useMemo((function(){return r.a.createElement(oe,{id:l,className:"custom-song-icon",onLoad:function(e){return t.current=e},resize:!1})}),[l])}n(68);var le=Object(S.c)(2,0,1,0),ue=function(e,t,n){var a=n.getHeight()/64;e.fillStyle="#f6f2d5",e.globalCompositeOperation="source-over";for(var r=0;r<16;r++)for(var i=0;i<16;i++){var s=[2*(r+.5)/16-1,2*(i+.5)/16-1];e.beginPath(),e.arc(n.nx(s[0]),n.ny(s[1]),le(t-r/16*1.75*(i/16)*2)*a,0,S.b),e.fill()}e.globalCompositeOperation="destination-atop",e.beginPath(),e.fillStyle="#1f262f",e.arc(n.nx(0),n.ny(0),n.getHeight()/2.5,0,S.b),e.fill(),e.globalCompositeOperation="source-over",e.stroke()},me=function(e,t,n){e.fillStyle="#1f262f",e.globalCompositeOperation="source-over",e.beginPath(),e.arc(n.nx(0),n.ny(0),n.getHeight()/2.5,0,S.b),e.fill(),e.stroke()};function he(e){return r.a.createElement("div",{id:"loading-button-wrapper"},!e.isLoading&&r.a.createElement("button",{id:"loading-button",disabled:e.isLoading,style:{cursor:e.isLoading?"none":"pointer"}}," ",r.a.createElement("h2",null,"Enter")," "),r.a.createElement(ce,{name:e.name,id:"custom-loading-icon",animate:e.isLoading?ue:me}))}var de=function(){var e=r.a.useContext(f).isLoading;return r.a.createElement("div",{id:"loading-screen",className:"front-most off-black fullscreen"},r.a.createElement("div",{className:"landing-page-header"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("h1",{id:"landing-page-soundscape-title"},"Soundscape")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",null,"Loading...")),r.a.createElement(he,{isLoading:e})))},pe=(n(69),function(){var e=r.a.useContext(b).spectrumFunction,t=r.a.useContext(y),n=t.id,a=t.groups,i=t.bpm,s=r.a.useContext(f),o=s.players,c=s.analysers,l=s.dispatch,u=s.isLoading,m=s.pauseVisuals,h=r.a.useContext(g).flags,d=r.a.useRef(null),p=r.a.useRef(null);return r.a.useEffect((function(){p.current&&(p.current.pauseVisuals=m)}),[m]),r.a.useEffect((function(){if(p.current){var e={};a.forEach((function(t){e[t.name]=o.filter((function(e){return e.groupName===t.name&&"active"===e.playerState})).length>0})),p.current.playerState=e}}),[a,o]),r.a.useEffect((function(){if(a.length===c.length){var t;switch(n){case"moonrise":h.showVisuals?(t=new W(d.current,c,(function(){return l({type:"setIsLoading",payload:!1})})),p.current=t):l({type:"setIsLoading",payload:!1});break;case"mornings":h.showVisuals?(t=new ie(d.current,c,(function(){return l({type:"setIsLoading",payload:!1})}),{spectrumFunction:e,bpm:i}),p.current=t):l({type:"setIsLoading",payload:!1});break;case"swamp":h.showVisuals&&(t=new se(d.current,null,(function(){return l({type:"setIsLoading",payload:!1})}),{}),p.current=t);break;default:throw new Error("Song not found")}return h.showVisuals&&(window.addEventListener("resize",p.current.onWindowResize),window.addEventListener("orientationchange",p.current.onWindowResize),window.addEventListener("fullscreenchange",p.current.onWindowResize),window.visualViewport&&window.visualViewport.addEventListener("scroll",p.current.onWindowResize),window.visualViewport&&window.visualViewport.addEventListener("resize",p.current.onWindowResize)),function(){h.showVisuals&&(t.stop(),t.disposeAll(t.scene),window.removeEventListener("resize",p.current.onWindowResize),window.removeEventListener("orientationchange",p.current.onWindowResize),window.removeEventListener("fullscreenchange",p.current.onWindowResize),window.visualViewport&&window.visualViewport.removeEventListener("scroll",p.current.onWindowResize),window.visualViewport&&window.visualViewport.removeEventListener("resize",p.current.onWindowResize))}}}),[i,a,e,h.showVisuals,n,c,l]),r.a.createElement(r.a.Fragment,null,u&&r.a.createElement(de,null),r.a.createElement("canvas",{id:"canvas-viz",className:"fullscreen",ref:d}))}),fe=(n(70),function(e){var t=r.a.useRef(),n=r.a.useRef(),a=r.a.useRef(),i=r.a.useRef(),s=r.a.useContext(f),c=s.audioCtx,l=s.dispatch,u=s.randomizeEffects,m=s.scheduler,h=s.highpass,d=s.lowpass,p=s.ambience,g=r.a.useState(!1),b=Object(o.a)(g,2),y=b[0],v=(b[1],r.a.useCallback((function(){t.current.value=1,l({type:"setHighpass",payload:{value:1}}),n.current.value=100,l({type:"setLowpass",payload:{value:100}}),a.current.value=1,l({type:"setAmbience",payload:{value:1}})}),[l]));r.a.useEffect((function(){return v()}),[v]);var w=r.a.useCallback((function(){var e,r,i;e=h<25?2*Math.random():h>75?-2*Math.random():2*Math.random()-1,r=d<25?2*Math.random():d>75?-2*Math.random():2*Math.random()-1,i=p<25?2*Math.random():p>75?-2*Math.random():2*Math.random()-1,l({type:"setHighpass",payload:{value:h+e}}),l({type:"setLowpass",payload:{value:d+r}}),l({type:"setAmbience",payload:{value:p+i}}),t.current.value=h+e,n.current.value=d+e,a.current.value=p+e}),[l,h,d,p]);return r.a.useEffect((function(){y&&!m.repeatingQueue.find((function(e){return e.id===i.current}))?i.current=m.scheduleRepeating(c.currentTime+.5,1,w):y?m.updateCallback(i.current,w):y||m.cancel(i.current)}),[y,m,c,w]),r.a.createElement("div",{id:"effects-panel",className:"flex-panel"},r.a.createElement("h2",null,"Background Mode"),r.a.createElement("p",null,"Automatically varies the music over time. Ideal for extended listening."),r.a.createElement("div",{className:"flex-row slider-row"},r.a.createElement("div",{className:"flex-col",style:{justifyContent:"flex-end"}},r.a.createElement("label",{className:"switch"},r.a.createElement("input",{type:"checkbox",onInput:function(e){var t=e.target.checked;l({type:"setBackgroundMode",payload:t})}}),r.a.createElement("span",{className:"slider round"}))),r.a.createElement("div",{className:"flex-col"},r.a.createElement("span",null,r.a.createElement("h3",{style:{marginLeft:"1rem"}},"Voices")))),r.a.createElement("h2",{id:"effects-controls-row"},"Visuals"),r.a.createElement("p",null,"Change visual settings to improve performance and save power."),r.a.createElement("div",{className:"flex-row slider-row"},r.a.createElement("div",{className:"flex-col",style:{justifyContent:"flex-end"}},r.a.createElement("label",{className:"switch"},r.a.createElement("input",{type:"checkbox",onInput:function(e){var t=e.target.checked;l({type:"setPauseVisuals",payload:t})}}),r.a.createElement("span",{className:"slider round"}))),r.a.createElement("div",{className:"flex-col"},r.a.createElement("span",null,r.a.createElement("h3",{style:{marginLeft:"1rem"}},"Pause Visuals")))),r.a.createElement("div",{id:"effects-controls-row",className:"flex-row",style:{justifyContent:"space-between"}},r.a.createElement("div",{className:"flex-col"},r.a.createElement("h2",null,"Effects")),r.a.createElement("div",{className:"flex-col"},y&&r.a.createElement("p",{className:"hot-green"},"background mode: on"))),r.a.createElement("div",{className:"flex-row"},r.a.createElement("button",{className:"button-white grouped-buttons",id:"effects-panel-reset",onClick:function(){return v()}},"Reset"),r.a.createElement("button",{className:"button-white grouped-buttons",id:"effects-panel-randomize",onClick:function(){var e=1+99*Math.random(),r=1+99*Math.random(),i=1+99*Math.random();l({type:"setHighpass",payload:{value:e}}),l({type:"setLowpass",payload:{value:r}}),l({type:"setAmbience",payload:{value:i}}),t.current.value=e,n.current.value=r,a.current.value=i}},"Randomize")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("h3",{className:"slider-label"},"highpass filter")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("input",{type:"range",min:"1",max:"100",disabled:u,id:"hp-slider",ref:t,onInput:function(e){l({type:"setHighpass",payload:{value:parseInt(e.target.value)}})}})),r.a.createElement("div",{className:"flex-row"},r.a.createElement("h3",{className:"slider-label"},"lowpass filter")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("input",{type:"range",min:"1",max:"100",disabled:u,id:"lp-slider",ref:n,onInput:function(e){l({type:"setLowpass",payload:{value:parseInt(e.target.value)}})}})),r.a.createElement("div",{className:"flex-row"},r.a.createElement("h3",{className:"slider-label"},"ambience")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("input",{type:"range",min:"1",max:"100",disabled:u,id:"spaciousness-slider",ref:a,onInput:function(e){l({type:"setAmbience",payload:{value:parseInt(e.target.value)}})}})))}),ge=function(e){var t=r.a.useRef(),n=r.a.useRef();r.a.useEffect((function(){return t.current=window.requestAnimationFrame((function a(r){if(void 0!==n.current){var i=r-n.current;e({delta:i,time:r})}n.current=r,t.current=window.requestAnimationFrame(a)})),function(){return window.cancelAnimationFrame(t.current)}}),[e])},be=n(126),ye=function(){function e(t,n,a){Object(w.a)(this,e),this.input=n,this.context=t;var r={id:null,power:13,minDecibels:-130,maxDecibels:0,minFrequency:20,maxFrequency:16500,smoothingTimeConstant:.8,numBuckets:10,split:!1,xEasing:void 0,yEasing:void 0,binMethod:"center"};if(Object.assign(this,Object(m.a)({},r,{},a)),this.fftSize=Math.pow(2,this.power),this.frequencyBinCount=this.fftSize/2,this.nyquist=this.context.sampleRate/2,this.binSize=this.nyquist/this.frequencyBinCount,this.adj="center"===this.binMethod?.5:"start"===this.binMethod?0:"end"===this.binMethod?1:.5,this.binMin=Math.floor(this.minFrequency/this.binSize),this.binMax=this.frequencyBinCount-Math.floor((this.nyquist-this.maxFrequency)/this.binSize),this.bucketCounts=new Array(this.numBuckets).fill(0,0,this.numBuckets),this.bucketData=new Array(this.numBuckets).fill(0,0,this.numBuckets),this.minFrequency=(this.binMin+this.adj)*this.binSize,this.maxFrequency=(this.binMax+this.adj)*this.binSize,"string"===typeof this.xEasing)switch(this.xEasing){case"polyIn":this.xEasing=be.a.exponent(this.xExponent);break;case"polyOut":this.xEasing=be.c.exponent(this.xExponent);break;case"polyInOut":this.xEasing=be.b.exponent(this.xExponent);break;default:this.xEasing=function(e){return e}}if("string"===typeof this.yEasing)switch(this.yEasing){case"polyIn":this.yEasing=be.a.exponent(this.yExponent);break;case"polyOut":this.yEasing=be.c.exponent(this.yExponent);break;case"polyInOut":this.yEasing=be.b.exponent(this.yExponent);break;default:this.yEasing=function(e){return e}}this.createAudioNodes(),this.createDataStructure()}return Object(E.a)(e,[{key:"createAudioNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.split;if(e){var t=this.context.createChannelSplitter(2);this.input.connect(t),this.analyser={},this.analyser.left=this.context.createAnalyser(),this.analyser.right=this.context.createAnalyser(),t.connect(this.analyser.left,0),t.connect(this.analyser.right,1),this.analyser.left.fftSize=Math.pow(2,this.power),this.analyser.left.minDecibels=this.minDecibels,this.analyser.left.maxDecibels=this.maxDecibels,this.analyser.left.smoothingTimeConstant=this.smoothingTimeConstant,this.analyser.right.fftSize=Math.pow(2,this.power),this.analyser.right.minDecibels=this.minDecibels,this.analyser.right.maxDecibels=this.maxDecibels,this.analyser.right.smoothingTimeConstant=this.smoothingTimeConstant}else this.analyser=this.context.createAnalyser(),this.analyser.fftSize=Math.pow(2,this.power),this.analyser.minDecibels=this.minDecibels,this.analyser.maxDecibels=this.maxDecibels,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,this.input.connect(this.analyser)}},{key:"createDataStructure",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.split;e?(this.fftData={},this.timeData={},this.fftData.left=new Uint8Array(this.analyser.left.frequencyBinCount),this.fftData.right=new Uint8Array(this.analyser.right.frequencyBinCount),this.timeData.left=new Uint8Array(this.analyser.left.fftSize),this.timeData.right=new Uint8Array(this.analyser.right.fftSize)):(this.fftData=new Uint8Array(this.analyser.frequencyBinCount),this.timeData=new Uint8Array(this.analyser.fftSize))}},{key:"getFrequencyData",value:function(e){var t=this;"left"===e||"right"===e?(this.analyser[e].getByteFrequencyData(this.fftData[e]),this.yEasing&&this.fftData[e].forEach((function(e,n,a){return a[n]=255*t.yEasing(e/255)}))):(this.analyser.getByteFrequencyData(this.fftData),this.yEasing&&this.fftData.forEach((function(e,n,a){return a[n]=255*t.yEasing(e/255)})))}},{key:"getFrequencyBins",value:function(e){var t=this,n=[];return this.getFrequencyData(e).slice(this.binMin,this.binMax+1).forEach((function(e,a){n.push({data:e,freq:(t.binMin+a+t.adj)*t.binSize})})),n}},{key:"getFrequencyBuckets",value:function(e){var t=this;this.getFrequencyData(e),this.bucketData.forEach((function(e,n,a){a[n]=0,t.bucketCounts[n]=0}));for(var n=this.binMin;n<=this.binMax;n++){var a=this.xEasing?Math.floor(this.xEasing(n/(this.binMax-this.binMin+1))*this.numBuckets):Math.floor(n/(this.binMax-this.binMin+1)*this.numBuckets);this.bucketData[a]+=this.fftData[n],this.bucketCounts[a]+=1}this.bucketData.forEach((function(e,n,a){return a[n]=e/t.bucketCounts[n]}))}},{key:"getTimeData",value:function(e){return"left"===e||"right"===e?(this.analyser[e].getByteTimeDomainData(this.timeData[e]),this.timeData[e]):(this.analyser.getByteTimeDomainData(this.timeData),this.timeData)}},{key:"reconnect",value:function(e){this.input.disconnect(),e.connect(this.analyser)}}]),e}(),ve=(n(71),function(){var e=r.a.useContext(f),t=e.audioCtx,n=e.premaster,a=r.a.useContext(b).spectrumFunction,i=r.a.useContext(y),s=60/i.bpm*i.timeSignature,o=r.a.useRef(null),c=r.a.useRef(null),l=r.a.useRef(new ye(t,n,{power:6,minDecibels:-120,maxDecibels:0,smoothingTimeConstanct:.25})),u=r.a.useCallback((function(e,t,n){var r=e.height/2-e.height/l.current.frequencyBinCount,i=n/1e3/(4*s);t.clearRect(0,0,e.height,e.height),l.current.getFrequencyData(),l.current.fftData.forEach((function(n,s){var o=n/255,c=e.width/2+r*Math.cos(s/l.current.frequencyBinCount*2*Math.PI+i*Math.PI*2),u=e.height/2+r*Math.sin(s/l.current.frequencyBinCount*2*Math.PI+i*Math.PI*2);t.beginPath(),t.fillStyle=a(s/l.current.frequencyBinCount),t.globalAlphs=o,t.moveTo(c,u),t.arc(c,u,e.height/l.current.frequencyBinCount*o,0,2*Math.PI),t.fill()}))}),[a,s]);return ge((function(e){return u(o.current,c.current,e.time)})),r.a.useMemo((function(){return r.a.createElement("div",{id:"freq-bands"},r.a.createElement(oe,{id:"freq-bands-canvas",onLoad:function(e){o.current=e,c.current=e.getContext("2d")}}))}),[])}),we=(n(34),function(e){var t=Object(a.useContext)(p),n=t.vw,i=t.vh,s=Object(a.useContext)(b).contentPanelColor;return r.a.createElement("div",{className:"menu-button-content",style:{visibility:!e.parentIsOpen&&"hidden",background:s,top:e.marginTop,minWidth:e.minWidth,maxHeight:82*i,maxWidth:95*n,padding:4*i}},e.content)}),Ee=n(30),xe=n.n(Ee),ke=(n(26),function(e){var t=r.a.useRef(null);return e.handleAddIconRef&&e.handleAddIconRef(t),r.a.createElement("div",{className:e.divClassList},e.link?r.a.createElement("a",{href:e.link},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:e.svgClassList,style:e.style,id:e.name},r.a.createElement("use",{ref:t,xlinkHref:"".concat(xe.a,"#").concat(e.name)}))):r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:e.svgClassList,style:e.style,id:e.name},r.a.createElement("use",{ref:t,xlinkHref:"".concat(xe.a,"#").concat(e.name)})))}),je=(n(72),function(e){var t=r.a.useContext(b),n=t.buttonColor,a=t.openButtonColor,i=t.contentPanelColor,s=r.a.useState(e.autoOpen),c=Object(o.a)(s,2),l=c[0],u=c[1],m=r.a.useRef(),h=e.parentIsOpen?(e.parentWidth+e.width)/2+e.separation+2*e.separation*(e.index-1):0;return function(e,t,n){var a=r.a.useCallback((function(a){e.current.contains(a.target)?t&&t():n&&n()}),[t,n,e]);r.a.useEffect((function(){return document.addEventListener("mousedown",a),function(){document.removeEventListener("mousedown",a)}}),[a])}(m,r.a.useCallback((function(){l||u(!0)}),[l]),r.a.useCallback((function(){l&&u(!1)}),[l])),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"test",ref:m},r.a.createElement("button",{id:"menu-button-child",className:"menu-button-child",style:{background:l?a:n,opacity:e.parentIsOpen?1:0,width:e.width,height:e.height,top:(e.parentHeight-e.height)/2,left:h+(e.parentWidth-e.width)/2,zIndex:e.zIndex}},r.a.createElement(ke,{divClassList:"icon scale-div",svgClassList:"icon menu-button-icon icon-white",name:e.iconName})),r.a.createElement("div",{className:"arrow",style:{borderBottomColor:i,display:!l&&"none",top:e.height+(e.parentHeight-e.height)/2,left:h+(e.parentWidth-e.width)/2,borderWidth:e.width/2,borderTop:0}}),r.a.createElement(we,{content:e.content,config:e.config,minWidth:e.menuWidth+e.width,marginTop:e.height/2+e.height+(e.parentHeight-e.height)/2,parentIsOpen:l})))}),Me=(n(73),function(e){var t=Object(a.useContext)(p).vh,n=Object(a.useContext)(b).buttonColor,i=Object(a.useContext)(f).isLoading,s=7*t,c=s,l=2.5*t,u=l,m=.7*s,h=m,d=h,g=Object(a.useState)(!0),y=Object(o.a)(g,2),v=y[0],w=y[1],E=e.childButtonProps.length;return r.a.createElement("div",{className:"menu-button",style:{top:l,left:u,visibility:i?"hidden":"visible"}},r.a.createElement("button",{className:v?"menu-button-parent menu-button-parent-open":"menu-button-parent",style:{zIndex:E+1,width:c,height:s,background:n},onClick:function(e){e.preventDefault(),w(!v)}},r.a.createElement(ke,{divClassList:"scale-div menu-button-icon icon-white ".concat(v?"rotate45":""),svgClassList:"icon menu-button-icon icon-white",name:"icon-plus"})),e.childButtonProps.map((function(t,n){return r.a.createElement(je,{id:t.id,key:t.id,content:e.childButtonProps[n].content,index:n+1,parentIsOpen:v,iconName:t.iconName,icon:t.icon,zIndex:E-n,separation:d,width:h,height:m,parentWidth:c,parentHeight:s,menuWidth:c+(h+d)*(E-1)})})))}),Ce=function(e){return r.a.createElement("div",{id:"social-icons",className:"icon-row flex-row "+e.divClassList},r.a.createElement(ke,{divClassList:"icon-row-child",svgClassList:e.svgClassList||"icon-white",name:"icon-envelope",link:"mailto:mark@soundscape.world"}),r.a.createElement(ke,{divClassList:"icon-row-child",svgClassList:e.svgClassList||"icon-white",name:"icon-twitter",link:"https://twitter.com/markracette"}),r.a.createElement(ke,{divClassList:"icon-row-child",svgClassList:e.svgClassList||"icon-white",name:"icon-instagram",link:"https://instagram.com/rgb.ig"}),r.a.createElement(ke,{divClassList:"icon-row-child",svgClassList:e.svgClassList||"icon-white",name:"icon-github",link:"https://github.com/mracette"}))},Le=function(e){var t="https://soundscape.world",n="Soundscape: the immersive music visualizer that lets you build your own beats.";return r.a.createElement("div",{id:"sharing-icons",className:"icon-row flex-row "+e.divClassList},r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{className:"sharing-link",href:"https://twitter.com/share?url=".concat(t,";text=").concat(n,";via=markracette"),target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"https://simplesharebuttons.com/images/somacro/twitter.png",alt:"Twitter"})),r.a.createElement("a",{className:"sharing-link",href:"http://www.facebook.com/sharer.php?u=".concat(t),target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"https://simplesharebuttons.com/images/somacro/facebook.png",alt:"Facebook"})),r.a.createElement("a",{className:"sharing-link",href:"http://reddit.com/submit?url=".concat(t),target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"https://simplesharebuttons.com/images/somacro/reddit.png",alt:"Reddit"})),r.a.createElement("a",{className:"sharing-link",href:"http://pinterest.com/pin/create/link/?url=".concat(t),target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"https://simplesharebuttons.com/images/somacro/pinterest.png",alt:"Pinterest"})),r.a.createElement("a",{className:"sharing-link",href:"https://www.tumblr.com/widgets/share/tool?canonicalUrl=".concat(t,"&title=Soundscape&caption=").concat(n),target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"https://simplesharebuttons.com/images/somacro/tumblr.png",alt:"Tumblr"}))))},Oe=(n(74),function(e){var t=r.a.useContext(y).name,n=r.a.useContext(v).credits;return r.a.createElement("div",{id:"song-info-panel"},r.a.createElement("h2",null,'"',t,'"'),n.map((function(e){return r.a.createElement("p",{key:e.type},r.a.createElement("u",null,e.type),"\xa0",e.content)})),r.a.createElement("h2",{className:"padded-row"},"Share"),r.a.createElement(Le,null),r.a.createElement("h2",{className:"padded-row"},"Connect"),r.a.createElement("p",{className:"flex-row"},"We are seeking",r.a.createElement("span",{className:"hot-green"},"\xa03D artists\xa0"),"to collaborate with on new content. Please get in touch if you have any leads!"),r.a.createElement(Ce,{divClassList:"info-panel-icon-row",svgClassList:"icon icon-white"}))}),De=n(19),Se={lpFilter:{minFreq:320,maxFreq:2e4,minQ:.71,maxQ:3,expFreqParams:D(1,320,100,2e4),expQParams:D(1,.71,100,3)},hpFilter:{minFreq:20,maxFreq:4500,minQ:.71,maxQ:1.5,expFreqParams:D(1,20,100,4500),expQParams:D(1,.71,100,1.5)},ambience:{minWet:0,maxWet:.55}},Pe=function(e,t){var n=e.createGain();return n.gain.value=t,n},Re=function(){function e(t,n,a){Object(w.a)(this,e),this.context=t,this.bufferSource=n,this.buffer=this.bufferSource.buffer;var r={destination:t.destination,loop:!0};Object.assign(this,Object(m.a)({},r,{},a)),this.bufferSource.loop=this.loop,this.bufferSource.loopStart=0,this.bufferSource.loopEnd=n.buffer.duration,this.bufferSource.connect(this.destination)}return Object(E.a)(e,[{key:"disconnect",value:function(){this.bufferSource.disconnect()}},{key:"start",value:function(e){try{this.bufferSource.start(e)}catch(t){this.reload(),this.bufferSource.start(e)}}},{key:"stop",value:function(e){try{this.bufferSource.stop(e)}catch(t){console.log(t)}}},{key:"reload",value:function(){this.disconnect();var e=this.context.createBufferSource();e.buffer=this.buffer,e.loop=this.loop,e.loopStart=0,e.loopEnd=this.buffer.duration,e.connect(this.destination),this.bufferSource=e}}]),e}(),Ne=function(){function e(t){Object(w.a)(this,e),this.audioCtx=t,this.queue=[],this.repeatingQueue=[],this.eventId=0}return Object(E.a)(e,[{key:"scheduleOnce",value:function(e,t,n){this.eventId++;var a=this.eventId,r=this.audioCtx.createBuffer(1,1,44100),i=this.audioCtx.createBufferSource();if(i.buffer=r,this.queue.push({id:a,name:t||null,time:e,type:"single",source:i}),n)return i.onended=n,i.start(e-r.duration),a;var s=new Promise((function(e){return i.onended=function(){e(a)}}));return i.start(e-r.duration),s}},{key:"scheduleRepeating",value:function(e,t,n){var a=this;this.eventId++;var r=this.eventId,i=this.audioCtx.createBuffer(1,1,44100),s=this.audioCtx.createBufferSource();return s.buffer=i,s.onended=function(){n();var e=a.getEvent(r),t=e.time,i=e.frequency;a.scheduleRepeating(t+i,i,n)},s.start(Math.max(0,e-i.duration)),this.repeatingQueue.push({id:r,time:e,type:"repeating",frequency:t,source:s}),r}},{key:"updateCallback",value:function(e,t){var n;(n=this.queue.find((function(t){return t.id===e})))||(n=this.repeatingQueue.find((function(t){return t.id===e}))),n&&(n.source.onended=t)}},{key:"updateQueue",value:function(){for(var e=this.repeatingQueue.length-1;e>=0;e--){var t=this.repeatingQueue[e];if(t.time<this.audioCtx.currentTime){this.repeatingQueue.splice(e,1);var n=this.audioCtx.createBuffer(1,1,44100),a=this.audioCtx.createBufferSource();a.buffer=n,a.onended=t.source.onended,a.start(Math.max(0,t.time+t.frequency-n.duration)),this.repeatingQueue.push({id:t.id,time:t.time+t.frequency,type:"repeating",frequency:t.frequency,source:a})}}}},{key:"getEvent",value:function(e){var t=this.queue.find((function(t){return t.id===e}));if(t)return t;var n=this.repeatingQueue.find((function(t){return t.id===e}));return n||!1}},{key:"clear",value:function(){this.queue.forEach((function(e){e.source.onended=null,e.source.stop()})),this.repeatingQueue.forEach((function(e){e.source.onended=null,e.source.stop()})),this.queue=[],this.repeatingQueue=[]}},{key:"cancel",value:function(e){if("undefined"!==typeof e){var t=this.getEvent(e);t&&(t.source.onended=null,t.source.stop(),this.queue=this.queue.filter((function(e){return e.id!==t.id})),this.repeatingQueue=this.repeatingQueue.filter((function(e){return e.id!==t.id})))}}}]),e}(),qe=(n(75),function(e){var t=r.a.useRef(),a=r.a.useRef(),i=r.a.useRef(),s=r.a.useContext(p).vh,c=r.a.useContext(y),l=c.id,u=c.timeSignature,m=c.bpm,h=r.a.useContext(f),d=h.audioCtx,b=h.dispatch,v=r.a.useContext(g).flags,w=e.handleUpdatePlayerOrder,E=e.handleUpdateOverrides,x=e.name,k=e.groupName,j=e.groupNode,M=e.override,C=e.length,L=r.a.useState("stopped"),O=Object(o.a)(L,2),D=O[0],P=O[1],R=r.a.useState(null),N=Object(o.a)(R,2),q=N[0],z=N[1],A=v.quantizeSamples?4*u:1,B=s?3.5*s:0,I=s?3.5*s/15:0,F=r.a.useCallback((function(e){if("pending-stop"!==D){i.current.clear();var t="active"===e?"pending-start":"pending-stop";b({type:"updatePlayerState",payload:{id:x,newState:t}}),P(t),w(x,t);var n=function(e,t,n){var a=e.currentTime/(60/t),r=(Math.floor(a/n)+1)*n*(60/t);return r}(d,m,A);switch(e){case"active":q.start(n);break;case"stopped":q.stop(n)}i.current.scheduleOnce(n).then((function(){P(e),b({type:"updatePlayerState",payload:{id:x,newState:e}})}));var r=1e3*(n-d.currentTime);!function(e,t){var n,r,i,s;De.a.remove(a.current.circleSvg),De.a.remove(a.current.iconPoly),De.a.remove(a.current.iconDiv),De.a.remove(a.current.iconDiv.children),De.a.remove(a.current.button),"start"===e?(s="-180",i="rgba(255, 255, 255, .3)",n=[0,2*Math.PI*(B-I/2)],r=[{value:"6.69872981 6.69872981 93.01270188 6.69872981 93.01270188 50 93.01270188 93.01270188 6.69872981 93.01270188"}]):"stop"===e&&(s="0",i="rgba(255, 255, 255, 0)",n=[a.current.circleSvg.style.strokeDashoffset,0],r=[{value:"6.69872981 0 6.69872981 0 93.01270188 50 6.69872981 100 6.69872981 100"}]),Object(De.a)({targets:a.current.circleSvg,strokeDashoffset:n,duration:t,easing:"linear"}),Object(De.a)({targets:a.current.iconPoly,points:r,duration:t,easing:"linear"}),Object(De.a)({targets:[a.current.iconDiv,a.current.iconDiv.children],rotateZ:s,duration:t,easing:"linear"}),Object(De.a)({targets:a.current.button,backgroundColor:i,duration:t,easing:"easeInCubic"})}("stopped"===e?"stop":"start",r)}}),[D,q,d,m,I,B,b,A,w,x]);return r.a.useEffect((function(){i.current=new Ne(d,x);var e=n(76)("./".concat(l,"/").concat(x,".mp3"));Object(S.d)(d,e,{offlineRendering:!0,renderLength:d.sampleRate*parseInt(C)*u*60/m,fade:!0,fadeLength:.025}).then((function(e){z(new Re(d,e,{destination:j,loop:!0})),b({type:"addPlayer",payload:{player:{id:x,groupName:k,playerState:D,buttonRef:t.current}}})})),a.current={button:t.current,circleSvg:t.current.children[0],iconDiv:t.current.children[1],iconSvg:t.current.children[1].children[0],iconPoly:t.current.children[1].children[0].children[0]}}),[]),r.a.useEffect((function(){!M||"active"!==D&&"pending-start"!==D||(F("stopped"),E(x))}),[D,F,E,x,M]),r.a.useEffect((function(){if(q)return function(){q.stop(),q.disconnect()}}),[q]),r.a.createElement("button",{className:"toggle-button",ref:t,onClick:function(e){switch(D){case"stopped":F("active");break;case"active":case"pending-start":F("stopped")}},style:{cursor:"pointer",height:2*B,width:2*B}},r.a.createElement("svg",{className:"svg",width:2*B,height:2*B,style:{strokeDashoffset:"active"===D?2*Math.PI*(B-I/2):0}},r.a.createElement("circle",{className:"svg-circle",cx:B,cy:B,r:B-I/2,style:{strokeWidth:I,strokeDasharray:2*Math.PI*(B-I/2)}})),r.a.createElement("div",{className:"scale-div-morph toggle-icon"},r.a.createElement("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:"toggle-icon icon-white"},r.a.createElement("polygon",{id:"icon-play3-poly",className:"icon icon-white",points:"6.69872981 0 46.650635094 25 93.01270188 50 46.650635094 75 6.69872981 100"}))))}),ze=(n(37),function(e){var t=r.a.useContext(f).audioCtx,n=r.a.useRef(function(){var n=t.createBiquadFilter();return n.type="lowshelf",n.frequency.value=120,n.gain.value=-12,e.input.connect(n),n}()),a=r.a.useRef(null),i=r.a.useRef(null),s=r.a.useRef(new ye(t,n.current,{id:"".concat(e.name,"-oscilloscope-analyser"),power:5,minDecibels:-120,maxDecibels:0,smoothingTimeConstant:0})),o=r.a.useContext(b).spectrumFunction,c=r.a.useCallback((function(t,n){i.current.lineWidth=t.height/20,n.clearRect(0,0,t.width,t.height);var a,r,c=s.current.getTimeData(),l=t.width/(c.length-1),u=0;c.forEach((function(i,s){n.beginPath(),e.gradient&&(n.strokeStyle=o(e.index/e.groupCount+s/(c.length*e.groupCount)));var m=i/128*t.height/2;0===u?n.moveTo(u,m):n.moveTo(a,r),n.lineTo(u,m),a=u,r=m,u+=l,n.stroke()}))}),[e,o]);return ge((function(){return c(a.current,i.current)})),r.a.useMemo((function(){return r.a.createElement("div",{id:"oscilloscope"},r.a.createElement(oe,{id:"oscilloscope-canvas",onLoad:function(e){a.current=e,i.current=e.getContext("2d")}}))}),[])}),Ae=(n(111),function(e){var t=r.a.useContext(b),a=t.groupMuteButton,i=t.groupSoloButton,s=r.a.useContext(f),c=s.audioCtx,l=s.premaster,u=s.dispatch,h=s.lowpass,d=s.highpass,p=s.ambience,g=r.a.useRef(Pe(c,1)),y=r.a.useRef(Pe(c,1)),v=r.a.useRef(Pe(c,1)),w=r.a.useRef(function(e){var t=e.createBiquadFilter();return t.type="highpass",t.frequency.value=2e4,t.Q.value=.71,t}(c)),E=r.a.useRef(function(e){var t=e.createBiquadFilter();return t.type="lowpass",t.frequency.value=2e4,t.Q.value=.71,t}(c)),x=r.a.useRef(Pe(c,1)),k=r.a.useRef(Pe(c,0)),j=r.a.useRef(c.createConvolver()),M=r.a.useState(!1),C=Object(o.a)(M,2),L=C[0],O=C[1],D=r.a.useState(!1),P=Object(o.a)(D,2),R=P[0],N=P[1],q=r.a.useState([]),z=Object(o.a)(q,2),A=z[0],B=z[1],I=r.a.useState([]),F=Object(o.a)(I,2),T=F[0],W=F[1];r.a.useEffect((function(){var t=n(112);Object(S.e)(t).then((function(e){c.decodeAudioData(e,(function(e){j.current.buffer=e,u({type:"impulseResponse",payload:{name:"standard",buffer:e}})}))})),g.current.connect(y.current),y.current.connect(E.current),E.current.connect(w.current),w.current.connect(x.current),w.current.connect(k.current),x.current.connect(v.current),k.current.connect(j.current),j.current.connect(v.current),v.current.connect(l);var a=new ye(c,v.current,Object(m.a)({id:"".concat(e.name,"-analyser")},e.analyserParams));u({type:"addAnalyser",payload:{analyser:a}})}),[c,u,e.analyserParams,e.name,l]),r.a.useEffect((function(){var e=Se.hpFilter.expFreqParams,t=Se.hpFilter.expQParams;w.current.frequency.value=e.a*Math.pow(e.b,d),w.current.Q.value=t.a*Math.pow(t.b,d)}),[d]),r.a.useEffect((function(){var e=Se.lpFilter.expFreqParams,t=Se.lpFilter.expQParams;E.current.frequency.value=e.a*Math.pow(e.b,h),E.current.Q.value=t.a*Math.pow(t.b,h)}),[h]),r.a.useEffect((function(){var e=Se.ambience.minWet+(Se.ambience.maxWet-Se.ambience.minWet)*(p-1)/99;x.current.gain.value=1-e,k.current.gain.value=e}),[p]),r.a.useEffect((function(){R&&!L?g.current.gain.value=0:R||e.soloOverride||(g.current.gain.value=1),L&&(e.handleAddSolo(e.name),g.current.gain.value=1),e.soloOverride!==e.name||L||(e.handleAddSolo(!1),R&&(g.current.gain.value=0))}),[R,L,e]),r.a.useEffect((function(){e.soloOverride&&e.soloOverride!==e.name&&(O(!1),g.current.gain.value=0),e.soloOverride||R||(g.current.gain.value=1)}),[e.soloOverride,R,e.name]);var V=r.a.useCallback((function(t,n){"pending-start"===n?e.currentPolyphony<e.polyphony||-1===e.polyphony?B(A.concat([t])):(W(T.concat(A[0])),B(A.slice(1).concat([t]))):"pending-stop"===n&&B(A.filter((function(e){return e!==t})))}),[e.currentPolyphony,e.polyphony,A,T]),_=r.a.useCallback((function(e){W(T.filter((function(t){return t!==e})))}),[T]);return r.a.createElement("div",{className:"toggle-button-group flex-col"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("h3",null,e.name," (",e.currentPolyphony," / ",-1===e.polyphony?e.voices.length:e.polyphony,")"),r.a.createElement(ze,{input:v.current,index:e.index,groupCount:e.groupCount,gradient:!0,name:e.name}),r.a.createElement("button",{className:"solo-button",style:L?{background:i}:void 0,onClick:function(){return O(!L)}},"S"),r.a.createElement("button",{className:"mute-button",style:R?{background:a}:void 0,onClick:function(){return N(!R)}},"M")),r.a.createElement("div",{className:"toggle-buttons flex-row"},e.voices.map((function(t){return r.a.createElement(qe,{key:t.name,name:t.name,groupName:e.name,length:t.length,quantizeLength:t.quantizeLength,handleUpdatePlayerOrder:V,handleUpdateOverrides:_,override:-1!==T.indexOf(t.name),groupNode:g.current})}))))}),Be=(n(113),function(e){var t=r.a.useContext(b).panelMuteButton,n=r.a.useContext(f),a=n.dispatch,i=n.mute,s=n.backgroundMode,c=r.a.useContext(y).groups,l=r.a.useState(!1),u=Object(o.a)(l,2),m=u[0],h=u[1],d=r.a.useCallback((function(e){h(e)}),[]);return r.a.createElement("div",{id:"toggle-button-panel",className:"flex-panel"},r.a.createElement("div",{className:"flex-row",style:{justifyContent:"space-between"}},r.a.createElement("div",{className:"flex-col"},r.a.createElement("h2",null,"Voices")),r.a.createElement("div",{className:"flex-col"},s&&r.a.createElement("p",{className:"hot-green"},"background mode: on"))),r.a.createElement("div",{className:"flex-row"},r.a.createElement("button",{className:"button-white grouped-buttons",id:"toggle-button-panel-reset",onClick:e.handleReset},"Reset"),r.a.createElement("button",{id:"toggle-button-panel-randomize",className:"button-white grouped-buttons",onClick:e.handleRandomize},"Randomize"),r.a.createElement("button",{id:"toggle-button-panel-mute",className:"button-white grouped-buttons",style:i?{background:t}:void 0,onClick:function(){return a(i?{type:"stopMute"}:{type:"startMute"})}},"Mute")),c.map((function(t,n){return r.a.createElement(Ae,{index:n,handleAddSolo:d,soloOverride:m,key:t.name,name:t.name,groupCount:c.length,currentPolyphony:e.players.filter((function(e){return e.groupName===t.name&&("active"===e.playerState||"pending-start"===e.playerState)})).length,polyphony:t.polyphony,voices:t.voices,analyserParams:t.analyser})})))}),Ie=function(e){return r.a.createElement("div",{id:"home-panel",className:"flex-panel"},r.a.createElement("h2",null,"Return Home?"),r.a.createElement("p",null,"This will stop your current session."),r.a.createElement("div",{className:"flex-row"},r.a.createElement(h.b,{to:"/"},r.a.createElement("button",{style:{width:"20rem"},className:"grouped-buttons button-white"},"Proceed"))))},Fe=n(18),Te=function(e,t){switch(t.type){case"setIsLoading":return Object(m.a)({},e,{isLoading:t.payload});case"startBackgroundMode":return Object(m.a)({},e,{backgroundMode:!0});case"stopBackgroundMode":return Object(m.a)({},e,{backgroundMode:!1});case"setBackgroundMode":return Object(m.a)({},e,{backgroundMode:t.payload});case"addPlayer":return e.players.find((function(e){return e.id===t.payload.player.id}))?e:Object(m.a)({},e,{players:[].concat(Object(Fe.a)(e.players),[t.payload.player])});case"addAnalyser":return e.analysers.find((function(e){return e.id===t.payload.analyser.id}))?e:Object(m.a)({},e,{analysers:[].concat(Object(Fe.a)(e.analysers),[t.payload.analyser])});case"updatePlayerState":return Object(m.a)({},e,{players:[].concat(Object(Fe.a)(e.players.filter((function(e){return e.id!==t.payload.id}))),[Object(m.a)({},e.players.find((function(e){return e.id===t.payload.id})),{playerState:t.payload.newState})])});case"startMute":return Object(m.a)({},e,{mute:!0});case"stopMute":return Object(m.a)({},e,{mute:!1});case"addImpulseResponse":return Object(m.a)({},e,{impulseResponses:[].concat(Object(Fe.a)(e.impulseResponses),[t.payload.impulseResponse])});case"incrementHighpass":return Object(m.a)({},e,{highpass:e.highpass+t.payload.value});case"incrementLowpass":return Object(m.a)({},e,{lowpass:e.lowpass+t.payload.value});case"incrementAmbience":return Object(m.a)({},e,{ambience:e.ambience+t.payload.value});case"setHighpass":return Object(m.a)({},e,{highpass:t.payload.value});case"setLowpass":return Object(m.a)({},e,{lowpass:t.payload.value});case"setAmbience":return Object(m.a)({},e,{ambience:t.payload.value});case"setPauseVisuals":return Object(m.a)({},e,{pauseVisuals:t.payload});default:return e}},We=(n(119),function(e){var t=r.a.useContext(g).flags,a=r.a.useContext(y),i=a.id,s=a.timeSignature,c=a.bpm,l=a.groups,u=a.ambientTrack,h=a.ambientTrackLength,d=r.a.useReducer(Te,{audioCtx:e.audioCtx,scheduler:e.scheduler,premaster:e.premaster,isLoading:!0,backgroundMode:!1,randomizeEffects:!1,pauseVisuals:!1,mute:!1,players:[],analysers:[],highpass:1,lowpass:100,ambience:1}),p=Object(o.a)(d,2),b=p[0],v=p[1],w=r.a.useRef(null),E=r.a.useCallback((function(){var e=[];l.forEach((function(t){for(var n=-1===t.polyphony?t.voices.length:t.polyphony,a=Math.ceil(Math.random()*n),r=[];r.length<a;){var i=Math.floor(Math.random()*t.voices.length),s=t.voices[i].name;-1===r.indexOf(s)&&(r.push(s),e.push(s))}})),b.players.forEach((function(t){-1!==e.indexOf(t.id)?"stopped"===t.playerState&&t.buttonRef.click():"stopped"!==t.playerState&&t.buttonRef.click()}))}),[b.players,l]),x=r.a.useCallback((function(){b.players.filter((function(e){return"active"===e.playerState||"pending-start"===e.playerState})).forEach((function(e){return e.buttonRef.click()}))}),[b.players]),k=r.a.useCallback((function(){var e=b.players.filter((function(e){return!e.playerState.includes("pending")})),t=Math.floor(Math.random()*e.length);if(b.players[t].buttonRef.click(),e.length>=b.players.length){var n=e.filter((function(e,n){return n!==t&&e.groupName!==t.groupName})),a=Math.floor(Math.random()*n.length);b.players[a].buttonRef.click()}}),[b.players]);return r.a.useEffect((function(){var e;if(t.playAmbientTrack&&u){var a=n(120)("./".concat(i,"/ambient-track.mp3"));Object(S.d)(b.audioCtx,a,{offlineRendering:!0,renderLength:b.sampleRate*parseInt(h)*s*60/c,fade:!0,fadeLength:.01}).then((function(t){e=new Re(b.audioCtx,t,{destination:b.premaster,loop:!0}),b.audioCtx.resume(),e.start()}))}return function(){b.scheduler.clear(),b.audioCtx.suspend(),t.playAmbientTrack&&e.stop()}}),[c,i,t.playAmbientTrack,u,h,s,b.scheduler,b.audioCtx,b.premaster,b.sampleRate]),r.a.useEffect((function(){b.backgroundMode&&!b.scheduler.repeatingQueue.find((function(e){return e.id===w.current}))?w.current=b.scheduler.scheduleRepeating(b.audioCtx.currentTime+60/c,1920/c,k):b.backgroundMode?b.scheduler.updateCallback(w.current,k):b.backgroundMode||b.scheduler.cancel(w.current)}),[c,b.backgroundMode,k,b.audioCtx,b.scheduler]),r.a.useEffect((function(){b.mute?b.premaster.gain.value=0:b.premaster.gain.value=1}),[b.mute,b.premaster]),r.a.createElement(f.Provider,{value:Object(m.a)({},b,{dispatch:v})},r.a.createElement(ve,null),r.a.createElement(Me,{name:"Menu",direction:"right",separation:"6rem",parentSize:"5rem",childButtonProps:[{id:"home",iconName:"icon-home",content:r.a.useMemo((function(){return r.a.createElement(Ie,null)}),[])},{autoOpen:!0,id:"toggles",iconName:"icon-music",content:r.a.useMemo((function(){return r.a.createElement(Be,{handleRandomize:E,handleReset:x,players:b.players})}),[E,x,b.players])},{id:"effects",iconName:"icon-equalizer",content:r.a.useMemo((function(){return r.a.createElement(fe,{impulseResponse:b.impulseResponse,dispatch:v})}),[b.impulseResponse,v])},{id:"song-info",iconName:"icon-info",content:r.a.useMemo((function(){return r.a.createElement(Oe,null)}),[])}]}),r.a.createElement(pe,null))}),Ve=function(e,t,n){for(var a=0;a<5;a++)e.beginPath(),e.arc(n.nx(Object(S.g)(.2,0,0,0,t+S.b*a/5).x),n.ny(Object(S.g)(.2,0,0,0,t+S.b*a/5).y),n.getWidth()/4,0,S.b),e.stroke()};function _e(e){return r.a.createElement(ce,{dispatch:e.dispatch,name:e.name,id:"custom-moonrise-icon",animate:Ve,listen:!0})}var He=Object(S.c)(2,0,1,-1.5),Ge=function(e,t,n){for(var a=n.getWidth()/8,r=n.nx(0)-a/2,i=0;i<5;i++){var s=n.getHeight()*(.6-.1*Math.abs(2-i));e.beginPath(),e.strokeRect(r-(2-i)*a*He(t),n.ny(.1*Math.abs(2-i)-.6),a,s)}};function Ue(e){return r.a.createElement(ce,{dispatch:e.dispatch,name:e.name,id:"custom-mornings-icon",animate:Ge,listen:!0})}var Qe=function(e,t,n){for(var a=n.getWidth()/2.5,r=0;r<3;r++)for(var i=0;i<3;i++){var s=-1*(1-.8)+2*(1-.8)*(i+.5)/3,o=-1*(1-.8)+2*(1-.8)*(r+.5)/3,c=1-(i+r)%2*2,l=Object(S.g)(s,o,0,0,0+c*t+S.b);e.beginPath(),e.rect(n.nx(l.x)-a/2,n.ny(l.y)-a/2,a,a),e.stroke()}};function Ke(e){return r.a.createElement(ce,{dispatch:e.dispatch,name:e.name,id:"coming-soon-icon",animate:Qe,listen:!0})}for(var Ye=function(){function e(t,n,a,r){Object(w.a)(this,e),this.scene=t,this.center=n,this.number=a,Object.assign(this,{color:16777215,colorPalette:null,intensityMap:[[0,1,1,1]],radiusSpread:0,minOrbitRadius:500,maxOrbitRadius:1e3,orbitSpeed:.1,rotateVector:new L.tb(1,1,1)},r),this.group=new L.r,this.starField=this.createSpheres(this.number),this.group.position.copy(this.center),this.scene.add(this.group)}return Object(E.a)(e,[{key:"guassianRand",value:function(){for(var e=0,t=0;t<6;t+=1)e+=Math.random();return e/6}},{key:"normalize",value:function(e,t,n,a){return{x:a*e/Math.sqrt(e*e+t*t+n*n),y:a*t/Math.sqrt(e*e+t*t+n*n),z:a*n/Math.sqrt(e*e+t*t+n*n)}}},{key:"createSpheres",value:function(e){for(var t,n=new L.f,a=[],r=[],i=[],s=0;s<e;s++){var o=this.normalize(2*this.guassianRand()-1,2*this.guassianRand()-1,2*this.guassianRand()-1,this.minOrbitRadius+Math.random()*(this.maxOrbitRadius-this.minOrbitRadius));a.push(o.x),a.push(o.y),a.push(o.z),r.push(1),t=this.colorPalette?new L.j(this.colorPalette(Math.random())):new L.j(this.color),i.push(t.r,t.g,t.b,1)}n.addAttribute("position",new L.o(a,3)),n.addAttribute("color",new L.o(i,4)),n.addAttribute("intensity",new L.o(r,1)),n.setDrawRange(0,e);var c=new L.Z({vertexColors:L.vb,transparent:!0,opacity:1}),l=new L.Y(n,c);return l.geometry.attributes.position.needsUpdate=!0,this.group.add(l),l}},{key:"update",value:function(e){this.group.rotateOnAxis(this.rotateVector.normalize(),e*this.orbitSpeed*2*Math.PI/60)}},{key:"lerp",value:function(e,t,n){return e*(1-n)+t*n}}]),e}(),Xe=function(e){function t(e){var n;return Object(w.a)(this,t),(n=Object(x.a)(this,Object(M.a)(t).call(this,e))).DPRMax=2.5,n}return Object(j.a)(t,e),Object(E.a)(t,[{key:"initScene",value:function(){var e=new L.fb;return e.background=new L.j("#1f262f"),e}},{key:"initCamera",value:function(){var e,t=this.screenDimensions.width/this.screenDimensions.height;return(e=new L.V(60,1,1,1e3)).aspect=t,e.position.set(0,0,0),e.lookAt(new L.tb(0,1,0)),e.updateProjectionMatrix(),e}},{key:"initSubjects",value:function(){var e=new u.a('{"type":"arc","overflow":"clamp","reverse":false,"translation":{"x":-0.182,"y":-0.138},"scale":{"x":1,"y":1},"rotation":0,"angleStart":2.105,"angleEnd":6.283,"angleOffset":0,"radius":0.5}','{"type":"linear","overflow":"clamp","reverse":false,"translation":{"x":-0.003,"y":0.758},"scale":{"x":1.053,"y":-0.13},"rotation":0}','{"start":0,"end":1}'),t={};return t.stars=new Ye(this.scene,new L.tb(0,0,0),1600,{colorPalette:function(t){return e.rgbValueAt(t)},minOrbitRadius:300,maxOrbitRadius:600}),t}},{key:"render",value:function(){this.subjects.stars.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera)}}]),t}(z),Je=function(e,t){switch(t.type){case"moonrise":return{name:"Moonrise",bpm:"120",key:"G Minor"};case"mornings":return{name:"Mornings",bpm:"92",key:"Eb Major"};case"coming-soon":return{name:"The future of Soundscape...",bpm:null,key:null};default:return{name:null,bpm:null,key:null}}},Ze=function(){var e=r.a.useReducer(Je,{name:null,bpm:null,key:null}),t=Object(o.a)(e,2),n=t[0],a=t[1],i=r.a.useRef(null),s=r.a.useContext(p).isMobile;return r.a.useEffect((function(){var e;return i.current&&((e=new Xe(i.current)).init().then((function(){return e.animate()})),window.addEventListener("resize",e.onWindowResize),window.addEventListener("orientationchange",e.onWindowResize),window.addEventListener("fullscreenchange",e.onWindowResize),window.visualViewport&&window.visualViewport.addEventListener("scroll",e.onWindowResize),window.visualViewport&&window.visualViewport.addEventListener("resize",e.onWindowResize)),function(){e.stop(),e.disposeAll(e.scene),window.removeEventListener("resize",e.onWindowResize),window.removeEventListener("orientationchange",e.onWindowResize),window.removeEventListener("fullscreenchange",e.onWindowResize),window.visualViewport&&window.visualViewport.removeEventListener("scroll",e.onWindowResize),window.visualViewport&&window.visualViewport.removeEventListener("resize",e.onWindowResize)}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("canvas",{id:"star-canvas",className:"fullscreen",ref:i}),r.a.createElement("div",{id:"landing-page",className:"fullscreen transparent"},r.a.createElement("div",{className:"landing-page-header"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("h1",{id:"landing-page-soundscape-title"},"Soundscape")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",null,"This application uses audio.")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",null,"Use speakers or headphones for the best experience.")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("p",null,s?r.a.createElement("span",{id:"choose-a-song"},"Choose a song to begin."):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{id:n.name?"landing-page-song-title":"choose-a-song"},n.name||"Choose a song to begin."),n.bpm&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"\xa0|\xa0")," ",r.a.createElement("span",{id:"landing-page-bpm"}," ".concat(n.bpm," bpm"))),n.key&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"\xa0|\xa0")," ",r.a.createElement("span",{id:"landing-page-key"},n.key)))))),r.a.createElement("div",{id:"song-selection-panel"},r.a.createElement(h.b,{className:"song-link",id:"song-link-mornings",to:"/play/mornings"},s&&r.a.createElement("div",{className:"landing-page-header"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",{id:"landing-page-song-title"},"Mornings"),"\xa0|\xa0",r.a.createElement("span",{id:"landing-page-bpm"},"92"),"\xa0|\xa0",r.a.createElement("span",{id:"landing-page-key"},"Eb Major"))),r.a.createElement(Ue,{name:"mornings",dispatch:a})),r.a.createElement(h.b,{className:"song-link",id:"song-link-moonrise",to:"/play/moonrise"},s&&r.a.createElement("div",{className:"landing-page-header"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",{id:"landing-page-song-title"},"Moonrise"),"\xa0|\xa0",r.a.createElement("span",{id:"landing-page-bpm"},"120"),"\xa0|\xa0",r.a.createElement("span",{id:"landing-page-key"},"G Minor"))),r.a.createElement(_e,{name:"moonrise",dispatch:a})),r.a.createElement(h.b,{className:"song-link",id:"song-link-coming-soon",to:"/coming-soon"},s&&r.a.createElement("div",{className:"landing-page-header"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",{id:"landing-page-song-title"},"The future of Soundscape..."))),r.a.createElement(Ke,{name:"coming-soon",dispatch:a})),r.a.createElement("div",{className:"filler"}))))},$e=(n(121),function(){return r.a.createElement("div",{id:"coming-soon",className:"fullscreen off-black"},r.a.createElement("div",{className:"landing-page-header"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("h1",{id:"landing-page-soundscape-title"},"Soundscape")),r.a.createElement("div",{id:"coming-soon-panel",className:"flex-col"},r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",null,"Additional content is coming to Soundscape.")),r.a.createElement("div",{className:"flex-row"},r.a.createElement("span",null,"To stay in the loop, sign up for",r.a.createElement("span",{className:"hot-pink"},"\xa0email updates\xa0"),"below.")),r.a.createElement("div",{id:"mc_embed_signup"},r.a.createElement("form",{action:"https://world.us4.list-manage.com/subscribe/post?u=4d5488d441c94ac4c98944eb9&id=f3e8462184",method:"post",id:"mc-embedded-subscribe-form",name:"mc-embedded-subscribe-form",className:"validate",target:"_blank",noValidate:!0},r.a.createElement("div",{id:"mc_embed_signup_scroll",className:"flex-row"},r.a.createElement("input",{type:"email",name:"EMAIL",className:"email",id:"mce-EMAIL",placeholder:"email address",required:!0}),r.a.createElement("div",{style:{position:"absolute",left:"-5000px"},"aria-hidden":"true"},r.a.createElement("input",{type:"text",name:"b_4d5488d441c94ac4c98944eb9_f3e8462184",tabIndex:"-1",value:"",onChange:function(){return null}})),r.a.createElement("div",{className:"clear"},r.a.createElement("input",{type:"submit",value:"Subscribe",name:"subscribe",id:"mc-embedded-subscribe",className:"button"}))))),r.a.createElement("span",{className:"flex-row"},"We are also seeking",r.a.createElement("span",{className:"hot-pink"},"\xa03D artists\xa0")," to collaborate with."),r.a.createElement("span",{className:"flex-row"},"Please\xa0",r.a.createElement("a",{className:"hot-blue",href:"mailto:mark@soundscape.world"},"get in touch"),"\xa0if you have any leads!"),r.a.createElement(Ce,{divClassList:"coming-soon-icon-row",svgClassList:"icon icon-moon"})),r.a.createElement("div",null,r.a.createElement(h.b,{to:"/"},r.a.createElement("button",{className:"button-white"},"Return Home")))))}),et=function(e){return r.a.createElement(h.a,null,r.a.createElement(d.d,null,r.a.createElement(d.b,{exact:!0,path:"/",component:Ze}),r.a.createElement(d.b,{exact:!0,path:"/coming-soon",component:$e}),r.a.createElement(d.b,{exact:!0,path:"/play/:songId",render:function(t){return r.a.createElement(b.Provider,{value:Object(m.a)({id:t.match.params.songId,spectrumFunction:e.spectrumFunctions[t.match.params.songId]},e.appConfig.find((function(e){return e.id===t.match.params.songId})).themes)},r.a.createElement(y.Provider,{value:Object(m.a)({id:t.match.params.songId},e.appConfig.find((function(e){return e.id===t.match.params.songId})).audio)},r.a.createElement(v.Provider,{value:Object(m.a)({id:t.match.params.songId},e.appConfig.find((function(e){return e.id===t.match.params.songId})).info)},r.a.createElement(We,{audioCtx:e.audioCtx,scheduler:e.scheduler,premaster:e.premaster}))))}}),r.a.createElement(d.a,{to:"/"})))},tt=new u.a('{"type":"arc","overflow":"clamp","reverse":false,"translation":{"x":-0.125,"y":-0.081},"scale":{"x":1,"y":1},"rotation":0,"angleStart":0,"angleEnd":3.142,"angleOffset":5.781,"radius":0.5}','{"type":"arc","overflow":"clamp","reverse":false,"translation":{"x":0.5,"y":0.5},"scale":{"x":1,"y":1},"rotation":0,"angleStart":0,"angleEnd":3.424,"angleOffset":0.628,"radius":0.25}','{"start":0,"end":1}'),nt=[],at=[],rt=0;rt<=255;rt++)nt.push(tt.rgbValueAt(rt/255)),at.push(new l.e(c.a(rt/255)).brighter(1.5));var it=n(122),st={quantizeSamples:!0,showVisuals:!0,playAmbientTrack:!0},ot={moonrise:function(e){return at[Math.round(255*e)]},mornings:function(e){return nt[Math.round(255*e)]},swamp:function(e){return"#000000"}},ct=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"balanced"}),lt=Pe(ct,1);lt.connect(ct.destination);var ut=new Ne(ct),mt=function(){var e=window.innerWidth,t=window.innerHeight;document.documentElement.style.setProperty("--vw","".concat(e/100,"px")),document.documentElement.style.setProperty("--vh","".concat(t/100,"px"));var n=r.a.useState(e/100),a=Object(o.a)(n,2),i=a[0],s=a[1],c=r.a.useState(t/100),l=Object(o.a)(c,2),u=l[0],m=l[1],h=r.a.useState(e<=760),d=Object(o.a)(h,2),f=d[0],b=d[1],y=function(){"suspended"===ct.state&&ct.resume()};return r.a.useEffect((function(){var e=function(){var e=window.innerWidth,t=window.innerHeight;document.documentElement.style.setProperty("--vw","".concat(e/100,"px")),document.documentElement.style.setProperty("--vh","".concat(t/100,"px")),s(e/100),m(t/100),b(e<=760)};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),window.addEventListener("fullscreenchange",e),window.visualViewport&&window.visualViewport.addEventListener("scroll",e),window.visualViewport&&window.visualViewport.addEventListener("resize",e),document.body.addEventListener("touchstart",y),document.body.addEventListener("click",y),function(){window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e),window.removeEventListener("fullscreenchange",e),window.visualViewport&&window.visualViewport.removeEventListener("scroll",e),window.visualViewport&&window.visualViewport.removeEventListener("resize",e),document.body.removeEventListener("touchstart",y),document.body.removeEventListener("click",y)}}),[]),r.a.createElement(g.Provider,{value:{flags:st}},r.a.createElement(p.Provider,{value:{vw:i,vh:u,isMobile:f}},r.a.createElement(et,{appConfig:it,spectrumFunctions:ot,audioCtx:ct,scheduler:ut,premaster:lt})))},ht=function(){var e=window.WebGLRenderingContext?"graphics card":"browser";return r.a.createElement("div",null,r.a.createElement("p",null,"Your ",e," does not seem to support ",r.a.createElement("a",{href:"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation"},"WebGL"),"."),r.a.createElement("p",null,"In order to access this application, you will need to use a supported device."))},dt=n(50);n(123);s.a.render(r.a.createElement((function(){return dt.a.isWebGLAvailable()?r.a.createElement("div",{id:"app-container",className:"fullscreen"},r.a.createElement(mt,null)):r.a.createElement(ht,null)}),null),document.getElementById("app"))}]),[[53,1,2]]]);
//# sourceMappingURL=main.28fc8634.chunk.js.map